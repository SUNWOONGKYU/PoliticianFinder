# 프로덕션 사이트 장애 원인 및 해결 보고서

**작성일:** 2026-02-01
**작성자:** Claude Opus 4.5
**대상 사이트:** https://www.politicianfinder.ai.kr/

---

## 1. 장애 현상

- 페이지 레이아웃 깨짐 (네비게이션 텍스트 세로 표시)
- JavaScript 실행 차단으로 데이터 로딩 불가
- CSS 미적용
- 브라우저 콘솔에 다수의 CSP 위반 에러 발생

---

## 2. 원인

### CSP(Content Security Policy) 인라인 스크립트 차단

**파일:** `1_Frontend/src/middleware.ts`

CSP의 `script-src`와 `style-src`에 `'unsafe-inline'`이 누락되어 Next.js의 인라인 스크립트가 전부 차단됨.

```
# 문제가 있던 설정
script-src 'self' https://www.googletagmanager.com https://www.google-analytics.com;
style-src 'self' https://fonts.googleapis.com;
```

Next.js는 `__NEXT_DATA__`, Hydration 스크립트, 테마 초기화 등 인라인 스크립트를 필수적으로 사용하는데, 이것들이 모두 차단되면서 사이트 전체가 동작하지 않았음.

---

## 3. 해결

```
# 수정된 설정
script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com;
style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
```

---

## 4. 추가 수정 사항

| 항목 | 문제 | 해결 |
|------|------|------|
| PWA manifest | Chrome "앱에서 열기" 프롬프트 발생 | manifest.ts 삭제 |
| 로그인 체크박스 | min-h/w 44px로 비정상 크기 | h-4 w-4로 수정 |
| 나의 활동 로그인 버튼 | 비로그인 시 불필요한 로그인 버튼 | 버튼 제거, 안내 문구만 유지 |
| 점수 소수점 | 홈 화면 점수에 소수점 표시 | Math.round() 적용 |
| 알림 벨 위치 | 네비게이션 링크 사이에 위치 | 로그인 버튼 옆으로 이동 |
| 불필요한 커밋 | 다른 프로젝트 커밋 혼입 | git reset + force push로 제거 |

---

## 5. 커밋 이력

| 커밋 | 내용 |
|------|------|
| `b2d66c6` | CSP에 unsafe-inline 추가 (핵심 수정) |
| `59bd4aa` | PWA manifest 제거 |
| `01caa61` | 홈 화면 3가지 수정 (로그인 버튼, 소수점, 알림 위치) |
| `55d513b` | 로그인 체크박스 크기 정상화 |
