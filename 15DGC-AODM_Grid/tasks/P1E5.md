# P1E5 - notifications RLS 정책

## 작업 ID
P1E5

## 담당 영역
RLS Policies

## 작업 개요
notifications 테이블에 대한 Row Level Security 정책을 설정합니다.

## 상세 설명
사용자는 자신의 알림만 조회/수정/삭제할 수 있도록 RLS 정책을 설정합니다. 알림 생성은 시스템(서버)에서만 가능합니다.

## 기술 스택
- Supabase RLS
- PostgreSQL Security

## 구현 사항
1. RLS 활성화
2. SELECT 정책 (본인 알림만 조회)
3. INSERT 정책 (서비스 역할만 생성 가능)
4. UPDATE 정책 (본인 알림만 수정 - 읽음 처리)
5. DELETE 정책 (본인 알림만 삭제)

## RLS 정책 SQL
```sql
-- RLS 활성화
ALTER TABLE notifications ENABLE ROW LEVEL SECURITY;

-- SELECT: 본인 알림만 조회
CREATE POLICY "Users can view own notifications"
ON notifications FOR SELECT
USING (auth.uid() = user_id);

-- INSERT: 서비스 역할만 알림 생성 (일반 사용자 차단)
CREATE POLICY "Service role can insert notifications"
ON notifications FOR INSERT
WITH CHECK (false); -- 클라이언트에서는 생성 불가

-- UPDATE: 본인 알림만 수정 (읽음 처리)
CREATE POLICY "Users can update own notifications"
ON notifications FOR UPDATE
USING (auth.uid() = user_id);

-- DELETE: 본인 알림만 삭제
CREATE POLICY "Users can delete own notifications"
ON notifications FOR DELETE
USING (auth.uid() = user_id);
```

## 성공 기준
- [ ] RLS가 활성화됨
- [ ] 4개 정책이 모두 생성됨
- [ ] 본인 알림 조회 테스트 성공
- [ ] 타인 알림 조회 차단 테스트 성공
- [ ] 읽음 처리 테스트 성공
- [ ] 클라이언트에서 알림 생성 차단 테스트 성공

## 의존 작업
- P1D9 (notifications 테이블)

## 예상 소요 시간
30분

## 참고 사항
- 알림 생성은 서버 사이드 함수나 트리거로 처리
- service_role 키를 사용한 서버 사이드 알림 생성 구현 필요
