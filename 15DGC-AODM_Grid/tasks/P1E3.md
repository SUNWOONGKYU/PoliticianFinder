# P1E3 - comments RLS 정책

## 작업 ID
P1E3

## 담당 영역
RLS Policies

## 작업 개요
comments 테이블에 대한 Row Level Security 정책을 설정합니다.

## 상세 설명
모든 사용자가 댓글을 조회할 수 있지만, 자신의 댓글만 수정/삭제할 수 있도록 RLS 정책을 설정합니다.

## 기술 스택
- Supabase RLS
- PostgreSQL Security

## 구현 사항
1. RLS 활성화
2. SELECT 정책 (모든 댓글 조회 가능)
3. INSERT 정책 (로그인 사용자만 댓글 생성)
4. UPDATE 정책 (본인 댓글만 수정)
5. DELETE 정책 (본인 댓글만 삭제)

## RLS 정책 SQL
```sql
-- RLS 활성화
ALTER TABLE comments ENABLE ROW LEVEL SECURITY;

-- SELECT: 모든 댓글 조회 가능
CREATE POLICY "Comments are viewable by everyone"
ON comments FOR SELECT
USING (true);

-- INSERT: 로그인한 사용자만 댓글 생성
CREATE POLICY "Authenticated users can create comments"
ON comments FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- UPDATE: 본인 댓글만 수정
CREATE POLICY "Users can update own comments"
ON comments FOR UPDATE
USING (auth.uid() = user_id);

-- DELETE: 본인 댓글만 삭제
CREATE POLICY "Users can delete own comments"
ON comments FOR DELETE
USING (auth.uid() = user_id);
```

## 성공 기준
- [ ] RLS가 활성화됨
- [ ] 4개 정책이 모두 생성됨
- [ ] 댓글 생성 테스트 성공
- [ ] 타인 댓글 수정/삭제 차단 테스트 성공
- [ ] 대댓글 생성 테스트 성공

## 의존 작업
- P1D6 (comments 테이블)

## 예상 소요 시간
30분

## 참고 사항
- parent_id를 통한 대댓글 구조 보안 검토
- 신고된 댓글에 대한 관리자 권한 정책 추가 고려
