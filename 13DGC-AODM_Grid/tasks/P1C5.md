# P1C5 - 이메일 변경 확인

## 작업 ID
P1C5

## 담당 영역
Authentication

## 작업 개요
사용자가 이메일을 변경할 때 새 이메일로 확인 링크를 발송하고 인증하는 기능을 구현합니다.

## 상세 설명
보안을 위해 이메일 변경 시 기존 이메일과 새 이메일 모두에 확인 절차를 거치도록 구현합니다.

## 기술 스택
- Supabase Auth
- Email Verification
- React Hook Form

## 구현 사항
1. 이메일 변경 요청 페이지
2. 새 이메일로 확인 링크 발송
3. 기존 이메일로 알림 발송
4. 이메일 변경 확인 및 업데이트
5. 변경 완료 후 세션 갱신

## 주요 코드
```javascript
// 이메일 변경 요청
const handleEmailChange = async (newEmail) => {
  const { data, error } = await supabase.auth.updateUser({
    email: newEmail
  })
  
  if (error) {
    console.error('Error:', error.message)
  } else {
    alert('새 이메일로 확인 링크를 발송했습니다. 링크를 클릭하여 변경을 완료하세요.')
  }
}

// 이메일 확인 콜백 처리
useEffect(() => {
  const handleEmailConfirmation = async () => {
    const { data: { user } } = await supabase.auth.getUser()
    
    if (user && user.email_confirmed_at) {
      alert('이메일이 성공적으로 변경되었습니다.')
      router.push('/profile')
    }
  }
  
  handleEmailConfirmation()
}, [])
```

## 보안 고려사항
- 이메일 변경은 로그인 상태에서만 가능
- 새 이메일로 확인 링크 발송
- 기존 이메일로 변경 알림 발송
- 확인 링크 유효 시간 제한 (1시간)
- 중복 이메일 방지

## 성공 기준
- [ ] 이메일 변경 요청 기능 구현
- [ ] 새 이메일로 확인 링크 발송
- [ ] 기존 이메일로 알림 발송
- [ ] 확인 링크 클릭 시 이메일 업데이트
- [ ] 중복 이메일 검증
- [ ] 변경 후 세션 정보 업데이트

## 의존 작업
- P1C1 (Email 인증 설정)
- P1F5 (프로필 페이지)

## 예상 소요 시간
1.5시간

## 참고 사항
- Supabase는 기본적으로 Secure Email Change 활성화
- 이메일 변경 시 기존 세션 유지 여부 설정
- 이메일 형식 검증 필수
