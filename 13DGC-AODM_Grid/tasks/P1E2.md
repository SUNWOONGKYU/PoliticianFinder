# P1E2 - ratings RLS 정책

## 작업 ID
P1E2

## 담당 영역
RLS Policies

## 작업 개요
ratings 테이블에 대한 Row Level Security 정책을 설정합니다.

## 상세 설명
모든 사용자가 평가를 조회할 수 있지만, 자신의 평가만 생성/수정/삭제할 수 있도록 RLS 정책을 설정합니다.

## 기술 스택
- Supabase RLS
- PostgreSQL Security

## 구현 사항
1. RLS 활성화
2. SELECT 정책 (모든 평가 조회 가능)
3. INSERT 정책 (로그인 사용자만 평가 생성)
4. UPDATE 정책 (본인 평가만 수정)
5. DELETE 정책 (본인 평가만 삭제)

## RLS 정책 SQL
```sql
-- RLS 활성화
ALTER TABLE ratings ENABLE ROW LEVEL SECURITY;

-- SELECT: 모든 평가 조회 가능
CREATE POLICY "Ratings are viewable by everyone"
ON ratings FOR SELECT
USING (true);

-- INSERT: 로그인한 사용자만 평가 생성
CREATE POLICY "Authenticated users can create ratings"
ON ratings FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- UPDATE: 본인 평가만 수정
CREATE POLICY "Users can update own ratings"
ON ratings FOR UPDATE
USING (auth.uid() = user_id);

-- DELETE: 본인 평가만 삭제
CREATE POLICY "Users can delete own ratings"
ON ratings FOR DELETE
USING (auth.uid() = user_id);
```

## 성공 기준
- [ ] RLS가 활성화됨
- [ ] 4개 정책이 모두 생성됨
- [ ] 평가 생성 테스트 성공
- [ ] 타인 평가 수정 차단 테스트 성공
- [ ] 정치인당 1인 1평가 제약 작동

## 의존 작업
- P1D3 (ratings 테이블)

## 예상 소요 시간
30분

## 참고 사항
- user_id와 politician_id 복합 UNIQUE 제약으로 중복 평가 방지
- 평가 수정은 제한된 시간 내에만 허용하도록 추가 정책 고려
