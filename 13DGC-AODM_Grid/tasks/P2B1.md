# P2B1 - ì •ì¹˜ì¸ ëª©ë¡ API Route

**Phase**: Phase 2 - ì •ì¹˜ì¸ ëª©ë¡/ìƒì„¸
**ì˜ì—­**: Backend (Supabase)
**ë‹´ë‹¹ AI**: fullstack-developer
**ìƒíƒœ**: ëŒ€ê¸°
**ì§„ë„**: 0%

---

## ğŸ“‹ ì‘ì—… ê°œìš”

ì •ì¹˜ì¸ ëª©ë¡ì„ ì¡°íšŒí•˜ëŠ” Next.js API Routeë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. ê²€ìƒ‰, í•„í„°ë§, ì •ë ¬, í˜ì´ì§€ë„¤ì´ì…˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ë©°, Supabaseì™€ í†µì‹ í•˜ì—¬ ë°ì´í„°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

---

## ğŸ¯ ì‘ì—… ëª©í‘œ

- [ ] API Route ìƒì„± (GET /api/politicians)
- [ ] ê²€ìƒ‰ ê¸°ëŠ¥ (ì´ë¦„)
- [ ] í•„í„°ë§ (ì •ë‹¹, ì§€ì—­, ì§ê¸‰)
- [ ] ì •ë ¬ (ì´ë¦„, í‰ì , ë“±ë¡ì¼)
- [ ] í˜ì´ì§€ë„¤ì´ì…˜
- [ ] ì—ëŸ¬ í•¸ë“¤ë§
- [ ] TypeScript íƒ€ì… ì •ì˜
- [ ] Response í˜•ì‹ í‘œì¤€í™”

---

## ğŸ“ ê¸°ìˆ  ì‚¬ì–‘

### Backend
- Framework: Next.js 14 API Routes
- Database: Supabase (PostgreSQL)
- Language: TypeScript

### íŒŒì¼ êµ¬ì¡°
```
frontend/
  src/
    app/
      api/
        politicians/
          route.ts
    types/
      api.types.ts
```

### API ìŠ¤í™

**Endpoint**: `GET /api/politicians`

**Query Parameters**:
```typescript
interface PoliticiansQuery {
  page?: number          // ê¸°ë³¸ê°’: 1
  limit?: number         // ê¸°ë³¸ê°’: 10, ìµœëŒ€: 100
  search?: string        // ì´ë¦„ ê²€ìƒ‰
  party?: string         // ì •ë‹¹ í•„í„° (ì‰¼í‘œ êµ¬ë¶„: "ë¯¼ì£¼ë‹¹,êµ­ë¯¼ì˜í˜")
  region?: string        // ì§€ì—­ í•„í„°
  position?: string      // ì§ê¸‰ í•„í„°
  sort?: string          // ì •ë ¬ í•„ë“œ (name, avg_rating, created_at)
  order?: 'asc' | 'desc' // ì •ë ¬ ë°©í–¥
}
```

**Response**:
```typescript
interface PoliticiansResponse {
  data: Politician[]
  pagination: {
    page: number
    limit: number
    total: number
    totalPages: number
  }
}
```

---

## ğŸ”— ì˜ì¡´ ì‘ì—…

**ì„ í–‰ ì‘ì—…**: P1B1 (Supabase Client ì´ˆê¸°í™”)
**í›„ì† ì‘ì—…**: P2F7 (ì •ì¹˜ì¸ ëª©ë¡ í˜ì´ì§€)

---

## âœ… ì™„ë£Œ ê¸°ì¤€

1. API Route êµ¬í˜„ ì™„ë£Œ
2. ê²€ìƒ‰ ê¸°ëŠ¥ ë™ì‘
3. í•„í„°ë§ ê¸°ëŠ¥ ë™ì‘
4. ì •ë ¬ ê¸°ëŠ¥ ë™ì‘
5. í˜ì´ì§€ë„¤ì´ì…˜ ë™ì‘
6. ì—ëŸ¬ í•¸ë“¤ë§ (400, 500)
7. TypeScript íƒ€ì… ì•ˆì •ì„±
8. Response í˜•ì‹ ì¼ê´€ì„±

---

## ğŸ’» êµ¬í˜„ ìƒì„¸

```typescript
// app/api/politicians/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { supabase } from '@/lib/supabase'

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url)

    // Query íŒŒë¼ë¯¸í„° íŒŒì‹±
    const page = Number(searchParams.get('page')) || 1
    const limit = Math.min(Number(searchParams.get('limit')) || 10, 100)
    const search = searchParams.get('search') || ''
    const party = searchParams.get('party')?.split(',').filter(Boolean) || []
    const region = searchParams.get('region')?.split(',').filter(Boolean) || []
    const position = searchParams.get('position')?.split(',').filter(Boolean) || []
    const sort = searchParams.get('sort') || 'name'
    const order = (searchParams.get('order') as 'asc' | 'desc') || 'asc'

    // Supabase ì¿¼ë¦¬ ìƒì„±
    let query = supabase
      .from('politicians')
      .select('*', { count: 'exact' })
      .range((page - 1) * limit, page * limit - 1)

    // ê²€ìƒ‰
    if (search) {
      query = query.ilike('name', `%${search}%`)
    }

    // í•„í„°ë§
    if (party.length > 0) {
      query = query.in('party', party)
    }

    if (region.length > 0) {
      query = query.in('region', region)
    }

    if (position.length > 0) {
      query = query.in('position', position)
    }

    // ì •ë ¬
    const validSortFields = ['name', 'avg_rating', 'created_at', 'total_ratings']
    if (validSortFields.includes(sort)) {
      query = query.order(sort, { ascending: order === 'asc' })
    }

    const { data, error, count } = await query

    if (error) {
      console.error('Supabase error:', error)
      return NextResponse.json(
        { error: 'Failed to fetch politicians' },
        { status: 500 }
      )
    }

    return NextResponse.json({
      data: data || [],
      pagination: {
        page,
        limit,
        total: count || 0,
        totalPages: Math.ceil((count || 0) / limit)
      }
    })
  } catch (error) {
    console.error('API error:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}
```

---

## ğŸ“ í…ŒìŠ¤íŠ¸ ê³„íš

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] ê¸°ë³¸ ì¡°íšŒ í…ŒìŠ¤íŠ¸
- [ ] ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] í•„í„°ë§ í…ŒìŠ¤íŠ¸
- [ ] ì •ë ¬ í…ŒìŠ¤íŠ¸
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ í…ŒìŠ¤íŠ¸

### í†µí•© í…ŒìŠ¤íŠ¸
- [ ] ë‹¤ì¤‘ í•„í„° ì¡°í•© í…ŒìŠ¤íŠ¸
- [ ] ì—ëŸ¬ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸
- [ ] Response í˜•ì‹ ê²€ì¦

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- SQL Injection ë°©ì§€ (Supabase ìë™ ì²˜ë¦¬)
- Query Parameter ê²€ì¦
- Rate Limiting (í–¥í›„ ì¶”ê°€)
- RLS ì •ì±… ì¤€ìˆ˜

---

## ğŸ“Œ ì°¸ê³ ì‚¬í•­

**ì‘ì—… ì™„ë£Œ ì¼ì‹œ**: ëŒ€ê¸°ì¤‘
**í…ŒìŠ¤íŠ¸/ê²€í†  ê²°ê³¼**: ëŒ€ê¸°
**ìë™í™” ë°©ì‹**: AI-only
**ë¸”ë¡œì»¤**: ì—†ìŒ
**ë¹„ê³ **: -

---

**ì‘ì„± ë°©ë²•ë¡ **: 13DGC-AODM v1.1
**AI-Only ì›ì¹™ ì¤€ìˆ˜**: âœ…
