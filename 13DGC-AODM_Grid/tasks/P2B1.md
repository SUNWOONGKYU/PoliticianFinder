# P2B1 - 정치인 목록 API Route

**Phase**: Phase 2 - 정치인 목록/상세
**영역**: Backend (Supabase)
**담당 AI**: fullstack-developer
**상태**: 대기
**진도**: 0%

---

## 📋 작업 개요

정치인 목록을 조회하는 Next.js API Route를 구현합니다. 검색, 필터링, 정렬, 페이지네이션 기능을 지원하며, Supabase와 통신하여 데이터를 반환합니다.

---

## 🎯 작업 목표

- [ ] API Route 생성 (GET /api/politicians)
- [ ] 검색 기능 (이름)
- [ ] 필터링 (정당, 지역, 직급)
- [ ] 정렬 (이름, 평점, 등록일)
- [ ] 페이지네이션
- [ ] 에러 핸들링
- [ ] TypeScript 타입 정의
- [ ] Response 형식 표준화

---

## 📐 기술 사양

### Backend
- Framework: Next.js 14 API Routes
- Database: Supabase (PostgreSQL)
- Language: TypeScript

### 파일 구조
```
frontend/
  src/
    app/
      api/
        politicians/
          route.ts
    types/
      api.types.ts
```

### API 스펙

**Endpoint**: `GET /api/politicians`

**Query Parameters**:
```typescript
interface PoliticiansQuery {
  page?: number          // 기본값: 1
  limit?: number         // 기본값: 10, 최대: 100
  search?: string        // 이름 검색
  party?: string         // 정당 필터 (쉼표 구분: "민주당,국민의힘")
  region?: string        // 지역 필터
  position?: string      // 직급 필터
  sort?: string          // 정렬 필드 (name, avg_rating, created_at)
  order?: 'asc' | 'desc' // 정렬 방향
}
```

**Response**:
```typescript
interface PoliticiansResponse {
  data: Politician[]
  pagination: {
    page: number
    limit: number
    total: number
    totalPages: number
  }
}
```

---

## 🔗 의존 작업

**선행 작업**: P1B1 (Supabase Client 초기화)
**후속 작업**: P2F7 (정치인 목록 페이지)

---

## ✅ 완료 기준

1. API Route 구현 완료
2. 검색 기능 동작
3. 필터링 기능 동작
4. 정렬 기능 동작
5. 페이지네이션 동작
6. 에러 핸들링 (400, 500)
7. TypeScript 타입 안정성
8. Response 형식 일관성

---

## 💻 구현 상세

```typescript
// app/api/politicians/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { supabase } from '@/lib/supabase'

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url)

    // Query 파라미터 파싱
    const page = Number(searchParams.get('page')) || 1
    const limit = Math.min(Number(searchParams.get('limit')) || 10, 100)
    const search = searchParams.get('search') || ''
    const party = searchParams.get('party')?.split(',').filter(Boolean) || []
    const region = searchParams.get('region')?.split(',').filter(Boolean) || []
    const position = searchParams.get('position')?.split(',').filter(Boolean) || []
    const sort = searchParams.get('sort') || 'name'
    const order = (searchParams.get('order') as 'asc' | 'desc') || 'asc'

    // Supabase 쿼리 생성
    let query = supabase
      .from('politicians')
      .select('*', { count: 'exact' })
      .range((page - 1) * limit, page * limit - 1)

    // 검색
    if (search) {
      query = query.ilike('name', `%${search}%`)
    }

    // 필터링
    if (party.length > 0) {
      query = query.in('party', party)
    }

    if (region.length > 0) {
      query = query.in('region', region)
    }

    if (position.length > 0) {
      query = query.in('position', position)
    }

    // 정렬
    const validSortFields = ['name', 'avg_rating', 'created_at', 'total_ratings']
    if (validSortFields.includes(sort)) {
      query = query.order(sort, { ascending: order === 'asc' })
    }

    const { data, error, count } = await query

    if (error) {
      console.error('Supabase error:', error)
      return NextResponse.json(
        { error: 'Failed to fetch politicians' },
        { status: 500 }
      )
    }

    return NextResponse.json({
      data: data || [],
      pagination: {
        page,
        limit,
        total: count || 0,
        totalPages: Math.ceil((count || 0) / limit)
      }
    })
  } catch (error) {
    console.error('API error:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}
```

---

## 📝 테스트 계획

### 단위 테스트
- [ ] 기본 조회 테스트
- [ ] 검색 기능 테스트
- [ ] 필터링 테스트
- [ ] 정렬 테스트
- [ ] 페이지네이션 테스트

### 통합 테스트
- [ ] 다중 필터 조합 테스트
- [ ] 에러 케이스 테스트
- [ ] Response 형식 검증

---

## 🔒 보안 고려사항

- SQL Injection 방지 (Supabase 자동 처리)
- Query Parameter 검증
- Rate Limiting (향후 추가)
- RLS 정책 준수

---

## 📌 참고사항

**작업 완료 일시**: 대기중
**테스트/검토 결과**: 대기
**자동화 방식**: AI-only
**블로커**: 없음
**비고**: -

---

**작성 방법론**: 13DGC-AODM v1.1
**AI-Only 원칙 준수**: ✅
