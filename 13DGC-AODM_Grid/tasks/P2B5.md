# P2B5 - 정치인 상세 API

**Phase**: Phase 2 - 정치인 목록/상세
**영역**: Backend (Supabase)
**담당 AI**: fullstack-developer
**상태**: 대기
**진도**: 0%

---

## 📋 작업 개요

개별 정치인의 상세 정보를 조회하는 API Route를 구현합니다. 프로필, 평가 통계, AI 점수 등을 포함한 완전한 정보를 제공합니다.

---

## 🎯 작업 목표

- [ ] GET /api/politicians/[id] 구현
- [ ] 정치인 기본 정보 조회
- [ ] AI 평가 점수 포함
- [ ] 평가 통계 (평균, 개수, 분포)
- [ ] 관련 게시글 수
- [ ] 404 에러 처리
- [ ] 캐싱 최적화

---

## 📐 기술 사양

### Backend
- Framework: Next.js 14 API Routes
- Database: Supabase (PostgreSQL)
- Language: TypeScript

### 파일 구조
```
frontend/
  src/
    app/
      api/
        politicians/
          [id]/
            route.ts
```

### API 스펙

**GET /api/politicians/[id]**

```typescript
// Response
interface PoliticianDetailResponse {
  id: number
  name: string
  party: string
  region: string
  position: string
  profile_image_url: string
  biography: string
  official_website: string
  avg_rating: number
  total_ratings: number
  ai_scores: {
    claude: number
    // 향후: gpt, gemini, perplexity, grok
  }
  rating_distribution: {
    5: number
    4: number
    3: number
    2: number
    1: number
  }
  total_posts: number
  created_at: string
  updated_at: string
}
```

---

## 🔗 의존 작업

**선행 작업**: P2B1 (정치인 목록 API Route)
**후속 작업**: P2F6 (정치인 상세 페이지)

---

## ✅ 완료 기준

1. API Route 구현
2. 정치인 정보 조회
3. AI 점수 조인
4. 평가 통계 계산
5. 404 처리
6. 에러 핸들링
7. TypeScript 타입 안정성

---

## 💻 구현 상세

```typescript
// app/api/politicians/[id]/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { supabase } from '@/lib/supabase'

export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const politicianId = parseInt(params.id)

    if (isNaN(politicianId)) {
      return NextResponse.json(
        { error: 'Invalid politician ID' },
        { status: 400 }
      )
    }

    // 정치인 기본 정보 + AI 점수
    const { data: politician, error } = await supabase
      .from('politicians')
      .select(\`
        *,
        ai_scores (
          ai_name,
          score,
          details
        )
      \`)
      .eq('id', politicianId)
      .single()

    if (error || !politician) {
      return NextResponse.json(
        { error: 'Politician not found' },
        { status: 404 }
      )
    }

    // 평가 통계 (분포)
    const { data: ratings } = await supabase
      .from('ratings')
      .select('score')
      .eq('politician_id', politicianId)

    const distribution = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 }
    ratings?.forEach(r => {
      distribution[r.score as keyof typeof distribution]++
    })

    // 관련 게시글 수
    const { count: postsCount } = await supabase
      .from('posts')
      .select('*', { count: 'exact', head: true })
      .eq('politician_id', politicianId)

    // AI 점수 포맷팅
    const ai_scores: Record<string, number> = {}
    politician.ai_scores?.forEach((score: any) => {
      ai_scores[score.ai_name] = score.score
    })

    const response: PoliticianDetailResponse = {
      ...politician,
      ai_scores,
      rating_distribution: distribution,
      total_posts: postsCount || 0
    }

    return NextResponse.json(response, {
      headers: {
        'Cache-Control': 'public, s-maxage=60, stale-while-revalidate=300'
      }
    })
  } catch (error) {
    console.error('API error:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}
```

---

## 📝 테스트 계획

### 단위 테스트
- [ ] 정상 조회 테스트
- [ ] 404 에러 테스트
- [ ] 잘못된 ID 테스트

### 통합 테스트
- [ ] AI 점수 조인 테스트
- [ ] 평가 통계 계산 테스트
- [ ] 캐싱 동작 테스트

---

## 🔒 보안 고려사항

- SQL Injection 방지
- RLS 정책 준수
- 캐싱 전략

---

## 📌 참고사항

**작업 완료 일시**: 대기중
**테스트/검토 결과**: 대기
**자동화 방식**: AI-only
**블로커**: 없음
**비고**: -

---

**작성 방법론**: 13DGC-AODM v1.1
**AI-Only 원칙 준수**: ✅
