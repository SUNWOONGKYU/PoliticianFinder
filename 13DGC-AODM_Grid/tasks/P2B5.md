# P2B5 - ì •ì¹˜ì¸ ìƒì„¸ API

**Phase**: Phase 2 - ì •ì¹˜ì¸ ëª©ë¡/ìƒì„¸
**ì˜ì—­**: Backend (Supabase)
**ë‹´ë‹¹ AI**: fullstack-developer
**ìƒíƒœ**: ëŒ€ê¸°
**ì§„ë„**: 0%

---

## ğŸ“‹ ì‘ì—… ê°œìš”

ê°œë³„ ì •ì¹˜ì¸ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” API Routeë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. í”„ë¡œí•„, í‰ê°€ í†µê³„, AI ì ìˆ˜ ë“±ì„ í¬í•¨í•œ ì™„ì „í•œ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ¯ ì‘ì—… ëª©í‘œ

- [ ] GET /api/politicians/[id] êµ¬í˜„
- [ ] ì •ì¹˜ì¸ ê¸°ë³¸ ì •ë³´ ì¡°íšŒ
- [ ] AI í‰ê°€ ì ìˆ˜ í¬í•¨
- [ ] í‰ê°€ í†µê³„ (í‰ê· , ê°œìˆ˜, ë¶„í¬)
- [ ] ê´€ë ¨ ê²Œì‹œê¸€ ìˆ˜
- [ ] 404 ì—ëŸ¬ ì²˜ë¦¬
- [ ] ìºì‹± ìµœì í™”

---

## ğŸ“ ê¸°ìˆ  ì‚¬ì–‘

### Backend
- Framework: Next.js 14 API Routes
- Database: Supabase (PostgreSQL)
- Language: TypeScript

### íŒŒì¼ êµ¬ì¡°
```
frontend/
  src/
    app/
      api/
        politicians/
          [id]/
            route.ts
```

### API ìŠ¤í™

**GET /api/politicians/[id]**

```typescript
// Response
interface PoliticianDetailResponse {
  id: number
  name: string
  party: string
  region: string
  position: string
  profile_image_url: string
  biography: string
  official_website: string
  avg_rating: number
  total_ratings: number
  ai_scores: {
    claude: number
    // í–¥í›„: gpt, gemini, perplexity, grok
  }
  rating_distribution: {
    5: number
    4: number
    3: number
    2: number
    1: number
  }
  total_posts: number
  created_at: string
  updated_at: string
}
```

---

## ğŸ”— ì˜ì¡´ ì‘ì—…

**ì„ í–‰ ì‘ì—…**: P2B1 (ì •ì¹˜ì¸ ëª©ë¡ API Route)
**í›„ì† ì‘ì—…**: P2F6 (ì •ì¹˜ì¸ ìƒì„¸ í˜ì´ì§€)

---

## âœ… ì™„ë£Œ ê¸°ì¤€

1. API Route êµ¬í˜„
2. ì •ì¹˜ì¸ ì •ë³´ ì¡°íšŒ
3. AI ì ìˆ˜ ì¡°ì¸
4. í‰ê°€ í†µê³„ ê³„ì‚°
5. 404 ì²˜ë¦¬
6. ì—ëŸ¬ í•¸ë“¤ë§
7. TypeScript íƒ€ì… ì•ˆì •ì„±

---

## ğŸ’» êµ¬í˜„ ìƒì„¸

```typescript
// app/api/politicians/[id]/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { supabase } from '@/lib/supabase'

export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const politicianId = parseInt(params.id)

    if (isNaN(politicianId)) {
      return NextResponse.json(
        { error: 'Invalid politician ID' },
        { status: 400 }
      )
    }

    // ì •ì¹˜ì¸ ê¸°ë³¸ ì •ë³´ + AI ì ìˆ˜
    const { data: politician, error } = await supabase
      .from('politicians')
      .select(\`
        *,
        ai_scores (
          ai_name,
          score,
          details
        )
      \`)
      .eq('id', politicianId)
      .single()

    if (error || !politician) {
      return NextResponse.json(
        { error: 'Politician not found' },
        { status: 404 }
      )
    }

    // í‰ê°€ í†µê³„ (ë¶„í¬)
    const { data: ratings } = await supabase
      .from('ratings')
      .select('score')
      .eq('politician_id', politicianId)

    const distribution = { 5: 0, 4: 0, 3: 0, 2: 0, 1: 0 }
    ratings?.forEach(r => {
      distribution[r.score as keyof typeof distribution]++
    })

    // ê´€ë ¨ ê²Œì‹œê¸€ ìˆ˜
    const { count: postsCount } = await supabase
      .from('posts')
      .select('*', { count: 'exact', head: true })
      .eq('politician_id', politicianId)

    // AI ì ìˆ˜ í¬ë§·íŒ…
    const ai_scores: Record<string, number> = {}
    politician.ai_scores?.forEach((score: any) => {
      ai_scores[score.ai_name] = score.score
    })

    const response: PoliticianDetailResponse = {
      ...politician,
      ai_scores,
      rating_distribution: distribution,
      total_posts: postsCount || 0
    }

    return NextResponse.json(response, {
      headers: {
        'Cache-Control': 'public, s-maxage=60, stale-while-revalidate=300'
      }
    })
  } catch (error) {
    console.error('API error:', error)
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}
```

---

## ğŸ“ í…ŒìŠ¤íŠ¸ ê³„íš

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] ì •ìƒ ì¡°íšŒ í…ŒìŠ¤íŠ¸
- [ ] 404 ì—ëŸ¬ í…ŒìŠ¤íŠ¸
- [ ] ì˜ëª»ëœ ID í…ŒìŠ¤íŠ¸

### í†µí•© í…ŒìŠ¤íŠ¸
- [ ] AI ì ìˆ˜ ì¡°ì¸ í…ŒìŠ¤íŠ¸
- [ ] í‰ê°€ í†µê³„ ê³„ì‚° í…ŒìŠ¤íŠ¸
- [ ] ìºì‹± ë™ì‘ í…ŒìŠ¤íŠ¸

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- SQL Injection ë°©ì§€
- RLS ì •ì±… ì¤€ìˆ˜
- ìºì‹± ì „ëµ

---

## ğŸ“Œ ì°¸ê³ ì‚¬í•­

**ì‘ì—… ì™„ë£Œ ì¼ì‹œ**: ëŒ€ê¸°ì¤‘
**í…ŒìŠ¤íŠ¸/ê²€í†  ê²°ê³¼**: ëŒ€ê¸°
**ìë™í™” ë°©ì‹**: AI-only
**ë¸”ë¡œì»¤**: ì—†ìŒ
**ë¹„ê³ **: -

---

**ì‘ì„± ë°©ë²•ë¡ **: 13DGC-AODM v1.1
**AI-Only ì›ì¹™ ì¤€ìˆ˜**: âœ…
