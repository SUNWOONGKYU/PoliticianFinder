# P1D3 - ratings 테이블

**Phase**: Phase 1 - Supabase 기반 인증 시스템
**영역**: Database (Supabase)
**담당 AI**: fullstack-developer
**상태**: 완료 (2025-10-16 14:30)
**진도**: 100%

---

## 📋 작업 개요

사용자가 정치인에게 부여한 평가 점수를 저장하는 ratings 테이블을 생성합니다. 10개 분야별 점수와 전체 평균 점수를 관리합니다.

---

## 🎯 작업 목표

- [x] ratings 테이블 스키마 정의
- [x] FK 관계 설정 (politicians, profiles)
- [x] 평가 점수 컬럼 정의
- [x] 인덱스 및 제약조건 설정

---

## 📐 기술 사양

### Database
- DBMS: PostgreSQL (Supabase)

### 테이블 구조
```sql
CREATE TABLE ratings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  politician_id UUID REFERENCES politicians(id) ON DELETE CASCADE,
  user_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
  integrity_score INT CHECK (integrity_score BETWEEN 0 AND 100),
  competence_score INT CHECK (competence_score BETWEEN 0 AND 100),
  communication_score INT CHECK (communication_score BETWEEN 0 AND 100),
  leadership_score INT CHECK (leadership_score BETWEEN 0 AND 100),
  accountability_score INT CHECK (accountability_score BETWEEN 0 AND 100),
  transparency_score INT CHECK (transparency_score BETWEEN 0 AND 100),
  responsiveness_score INT CHECK (responsiveness_score BETWEEN 0 AND 100),
  vision_score INT CHECK (vision_score BETWEEN 0 AND 100),
  public_interest_score INT CHECK (public_interest_score BETWEEN 0 AND 100),
  ethics_score INT CHECK (ethics_score BETWEEN 0 AND 100),
  average_score NUMERIC(5,2),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(politician_id, user_id)
);
```

### 인덱스
```sql
CREATE INDEX idx_ratings_politician ON ratings(politician_id);
CREATE INDEX idx_ratings_user ON ratings(user_id);
CREATE INDEX idx_ratings_average ON ratings(average_score DESC);
```

---

## 🔗 의존 작업

**선행 작업**: P1D2 (politicians 테이블)
**후속 작업**: P1E2 (ratings RLS)

---

## ✅ 완료 기준

1. ratings 테이블 생성됨
2. FK 관계 정상 동작
3. CHECK 제약조건 동작 확인
4. UNIQUE 제약조건으로 중복 평가 방지

---

## 📝 테스트 계획

### 단위 테스트
- [x] 테이블 생성 확인
- [x] FK CASCADE 동작 확인
- [x] CHECK 제약조건 테스트

### 통합 테스트
- [x] 평가 등록/수정 시나리오
- [x] 중복 평가 방지 테스트
- [x] 평균 점수 계산 검증

---

## 🔒 보안 고려사항

- RLS로 본인 평가만 수정 가능
- 다른 사용자 평가는 조회만 가능
- 평가 조작 방지

---

## 📌 참고사항

**작업 완료 일시**: 2025-10-16 14:30
**테스트/검토 결과**: 통과
**자동화 방식**: AI-only
**블로커**: 없음
**비고**: -

---

**작성 방법론**: 15DGC-AODM v3.0
**AI-Only 원칙 준수**: ✅
