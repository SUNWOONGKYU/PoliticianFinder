# P1C4 - 세션 관리 및 토큰 갱신

## 작업 ID
P1C4

## 담당 영역
Authentication

## 작업 개요
사용자 세션을 관리하고 액세스 토큰을 자동으로 갱신하는 기능을 구현합니다.

## 상세 설명
Supabase의 JWT 토큰 기반 인증에서 세션 유지 및 만료된 토큰의 자동 갱신을 처리합니다.

## 기술 스택
- Supabase Auth
- JWT (JSON Web Token)
- React Context API

## 구현 사항
1. 세션 상태 관리 (AuthContext)
2. 액세스 토큰 자동 갱신
3. 리프레시 토큰 처리
4. 세션 만료 시 처리
5. 로그아웃 시 세션 정리

## 주요 코드
```javascript
// AuthContext에서 세션 관리
useEffect(() => {
  // 초기 세션 확인
  supabase.auth.getSession().then(({ data: { session } }) => {
    setSession(session)
    setUser(session?.user ?? null)
  })

  // 세션 변경 감지
  const {
    data: { subscription },
  } = supabase.auth.onAuthStateChange((_event, session) => {
    setSession(session)
    setUser(session?.user ?? null)
  })

  return () => subscription.unsubscribe()
}, [])

// 토큰 자동 갱신 (Supabase가 자동 처리)
// 액세스 토큰 만료 5분 전에 자동으로 갱신

// 수동 세션 갱신
const refreshSession = async () => {
  const { data: { session }, error } = await supabase.auth.refreshSession()
  if (error) console.error('Session refresh error:', error)
  return session
}
```

## 세션 타임아웃 설정
- 액세스 토큰 유효 시간: 1시간 (기본값)
- 리프레시 토큰 유효 시간: 30일
- 자동 갱신: 만료 5분 전

## 성공 기준
- [ ] 로그인 시 세션 생성 확인
- [ ] 페이지 새로고침 시 세션 유지
- [ ] 토큰 자동 갱신 작동
- [ ] 세션 만료 시 로그인 페이지 리다이렉트
- [ ] 로그아웃 시 세션 완전 삭제

## 의존 작업
- P1F1 (AuthContext 생성)
- P1B6 (세션 관리)

## 예상 소요 시간
2시간

## 참고 사항
- Supabase는 자동으로 토큰 갱신 처리
- localStorage에 세션 정보 저장 (기본 동작)
- 민감한 작업 전 세션 유효성 재확인 권장
