# P2T3 - 상세 페이지 E2E

**Phase**: Phase 2 - 정치인 목록/상세
**영역**: Test (E2E)
**담당 AI**: devops-troubleshooter
**상태**: 대기
**진도**: 0%

---

## 📋 작업 개요

정치인 상세 페이지의 End-to-End 테스트를 작성합니다. 프로필 정보, AI 점수, 시민 평가 등의 표시 및 상호작용을 테스트합니다.

---

## 🎯 작업 목표

- [ ] 상세 페이지 렌더링 테스트
- [ ] 프로필 정보 표시 테스트
- [ ] AI 점수 표시 테스트
- [ ] 평가 통계 표시 테스트
- [ ] 평가 목록 표시 테스트
- [ ] SEO 메타데이터 테스트
- [ ] 404 에러 처리 테스트
- [ ] 공유 기능 테스트

---

## 📐 기술 사양

### Testing
- Framework: Playwright
- Language: TypeScript

---

## 🔗 의존 작업

**선행 작업**: P2F6 (정치인 상세 페이지)
**후속 작업**: P2V2 (CI/CD 파이프라인)

---

## ✅ 완료 기준

1. 8개 이상의 E2E 테스트 작성
2. 모든 테스트 통과
3. SEO 테스트 완료
4. 에러 처리 테스트 완료

---

## 💻 구현 상세

```typescript
// tests/e2e/politician-detail.spec.ts
import { test, expect } from '@playwright/test'

test.describe('정치인 상세 페이지', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/politicians/1')
  })

  test('프로필 정보 표시', async ({ page }) => {
    // 이름
    await expect(page.locator('h1[data-testid="politician-name"]')).toBeVisible()

    // 프로필 이미지
    await expect(page.locator('[data-testid="profile-image"]')).toBeVisible()

    // 기본 정보
    await expect(page.locator('[data-testid="politician-party"]')).toBeVisible()
    await expect(page.locator('[data-testid="politician-region"]')).toBeVisible()
    await expect(page.locator('[data-testid="politician-position"]')).toBeVisible()

    // 약력
    await expect(page.locator('[data-testid="politician-biography"]')).toBeVisible()

    // 공식 웹사이트
    const website = page.locator('[data-testid="official-website"]')
    if (await website.isVisible()) {
      await expect(website).toHaveAttribute('href', /https?:\/\//)
      await expect(website).toHaveAttribute('target', '_blank')
    }
  })

  test('AI 점수 표시', async ({ page }) => {
    // AI 점수 섹션
    await expect(page.locator('[data-testid="ai-scores-section"]')).toBeVisible()

    // Claude 점수
    const claudeScore = page.locator('[data-testid="ai-score-claude"]')
    await expect(claudeScore).toBeVisible()

    const score = await claudeScore.textContent()
    expect(parseFloat(score!)).toBeGreaterThanOrEqual(0)
    expect(parseFloat(score!)).toBeLessThanOrEqual(100)
  })

  test('평가 통계 표시', async ({ page }) => {
    // 평균 평점
    const avgRating = page.locator('[data-testid="avg-rating"]')
    await expect(avgRating).toBeVisible()

    // 평가 개수
    const totalRatings = page.locator('[data-testid="total-ratings"]')
    await expect(totalRatings).toBeVisible()

    // 평가 분포 차트
    await expect(page.locator('[data-testid="rating-distribution"]')).toBeVisible()

    // 각 별점별 개수
    for (let i = 1; i <= 5; i++) {
      await expect(page.locator(`[data-testid="rating-dist-${i}"]`)).toBeVisible()
    }
  })

  test('SEO 메타데이터', async ({ page }) => {
    // 페이지 타이틀
    const title = await page.title()
    expect(title).toContain('홍길동') // 정치인 이름 포함

    // Open Graph 메타 태그
    const ogTitle = await page.locator('meta[property="og:title"]').getAttribute('content')
    expect(ogTitle).toBeTruthy()

    const ogDescription = await page
      .locator('meta[property="og:description"]')
      .getAttribute('content')
    expect(ogDescription).toBeTruthy()

    const ogImage = await page.locator('meta[property="og:image"]').getAttribute('content')
    expect(ogImage).toMatch(/https?:\/\//)
  })

  test('404 에러 처리', async ({ page }) => {
    // 존재하지 않는 정치인 ID
    const response = await page.goto('/politicians/999999')

    // 404 응답 또는 에러 페이지
    if (response) {
      expect(response.status()).toBe(404)
    }

    // 에러 메시지 표시
    await expect(page.locator('[data-testid="not-found"]')).toBeVisible()
    await expect(page.locator('[data-testid="not-found"]')).toContainText(
      '정치인을 찾을 수 없습니다'
    )

    // 홈으로 돌아가기 버튼
    await expect(page.locator('[data-testid="back-to-home"]')).toBeVisible()
  })

  test('공유 기능', async ({ page }) => {
    // 공유 버튼 클릭
    await page.locator('[data-testid="share-button"]').click()

    // 공유 모달/메뉴 표시
    await expect(page.locator('[data-testid="share-menu"]')).toBeVisible()

    // URL 복사 버튼
    await page.locator('[data-testid="copy-url"]').click()

    // 복사 완료 메시지
    await expect(page.locator('[data-testid="toast-success"]')).toContainText('링크가 복사되었습니다')
  })

  test('뒤로 가기 버튼', async ({ page }) => {
    // 목록 페이지에서 진입
    await page.goto('/politicians')
    await page.locator('[data-testid="politician-card"]').first().click()

    // 뒤로 가기 버튼 클릭
    await page.locator('[data-testid="back-button"]').click()

    // 목록 페이지로 복귀
    await expect(page).toHaveURL('/politicians')
  })
})
```

---

## 📝 테스트 실행

```bash
npx playwright test politician-detail.spec.ts
```

---

## 📌 참고사항

**작업 완료 일시**: 대기중
**테스트/검토 결과**: 대기
**자동화 방식**: AI-only
**블로커**: 없음
**비고**: SEO 메타데이터 테스트로 검색 엔진 최적화 확인

---

**작성 방법론**: 15DGC-AODM v3.0
**AI-Only 원칙 준수**: ✅
