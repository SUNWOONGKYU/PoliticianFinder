# P2V1 - Vercel 배포

**Phase**: Phase 2 - 정치인 목록/상세
**영역**: DevOps
**담당 AI**: devops-troubleshooter
**상태**: 대기
**진도**: 0%

---

## 📋 작업 개요

Next.js 애플리케이션을 Vercel에 배포합니다. 스테이징 및 프로덕션 환경을 구성하고, 환경변수를 설정하며, 도메인을 연결합니다.

---

## 🎯 작업 목표

- [ ] Vercel 프로젝트 생성
- [ ] GitHub 연동
- [ ] 환경변수 설정
- [ ] 자동 배포 설정
- [ ] 프리뷰 배포 설정
- [ ] 도메인 연결 (선택)
- [ ] 성능 최적화 설정

---

## 📐 기술 사양

### Platform
- Hosting: Vercel
- Framework: Next.js 14
- Git: GitHub

---

## 🔗 의존 작업

**선행 작업**: P1T5 (통합 테스트 완료)
**후속 작업**: P2V2 (CI/CD 파이프라인)

---

## ✅ 완료 기준

1. Vercel 프로젝트 생성 완료
2. GitHub 연동 완료
3. 환경변수 설정 완료
4. 자동 배포 동작 확인
5. 프리뷰 URL 생성 확인
6. 프로덕션 URL 접속 가능

---

## 💻 구현 상세

### 1. Vercel CLI 설치

```bash
npm install -g vercel
```

### 2. Vercel 프로젝트 생성

**웹 대시보드 방식:**

1. https://vercel.com 접속 및 로그인
2. "Add New" > "Project"
3. GitHub 저장소 Import
4. 프로젝트 설정:
   - Framework Preset: Next.js
   - Root Directory: `frontend/` (또는 루트)
   - Build Command: `npm run build`
   - Output Directory: `.next`
   - Install Command: `npm install`

**CLI 방식:**

```bash
cd frontend
vercel login
vercel

# 프롬프트 응답:
# - Set up and deploy? Y
# - Which scope? [your-account]
# - Link to existing project? N
# - What's your project's name? politician-finder
# - In which directory is your code located? ./
# - Want to modify settings? N
```

### 3. 환경변수 설정

**Vercel Dashboard > Settings > Environment Variables:**

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://[project-id].supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Google OAuth (P2C1)
NEXT_PUBLIC_GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# Site URL
NEXT_PUBLIC_SITE_URL=https://politician-finder.vercel.app

# 환경별 설정
# Production: 프로덕션 환경
# Preview: PR 프리뷰 환경
# Development: 로컬 개발 환경
```

**vercel.json (선택사항):**

```json
{
  "build": {
    "env": {
      "NEXT_PUBLIC_SUPABASE_URL": "@supabase-url",
      "NEXT_PUBLIC_SUPABASE_ANON_KEY": "@supabase-anon-key"
    }
  },
  "env": {
    "SUPABASE_SERVICE_ROLE_KEY": "@supabase-service-role-key"
  }
}
```

### 4. Git 연동 및 자동 배포

**자동 배포 설정:**

1. Vercel Dashboard > Settings > Git
2. Production Branch: `main`
3. Enable automatic deployments

**배포 트리거:**

- `main` 브랜치 푸시 → 프로덕션 배포
- PR 생성/업데이트 → 프리뷰 배포
- 다른 브랜치 푸시 → 프리뷰 배포 (선택)

### 5. 배포 스크립트

```json
// package.json
{
  "scripts": {
    "deploy": "vercel --prod",
    "deploy:preview": "vercel",
    "deploy:local": "vercel dev"
  }
}
```

### 6. 배포 확인

```bash
# 프로덕션 배포
git push origin main

# Vercel CLI로 배포 상태 확인
vercel ls

# 로그 확인
vercel logs [deployment-url]
```

### 7. 도메인 연결 (선택)

**Vercel Dashboard > Settings > Domains:**

1. "Add Domain" 클릭
2. 도메인 입력 (예: `politician-finder.com`)
3. DNS 레코드 설정:
   ```
   Type: A
   Name: @
   Value: 76.76.21.21

   Type: CNAME
   Name: www
   Value: cname.vercel-dns.com
   ```
4. SSL 인증서 자동 발급 (Let's Encrypt)

### 8. 성능 최적화 설정

**next.config.js:**

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  // 이미지 최적화
  images: {
    domains: ['[your-supabase-project].supabase.co'],
    formats: ['image/avif', 'image/webp']
  },

  // 컴파일 최적화
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production'
  },

  // 헤더 설정
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'X-DNS-Prefetch-Control',
            value: 'on'
          },
          {
            key: 'Strict-Transport-Security',
            value: 'max-age=31536000; includeSubDomains'
          }
        ]
      }
    ]
  }
}

module.exports = nextConfig
```

### 9. 프리뷰 배포 테스트

```bash
# PR 생성
git checkout -b feature/test-deployment
git push origin feature/test-deployment

# GitHub에서 PR 생성
# → Vercel Bot이 자동으로 프리뷰 URL 코멘트
```

---

## 📝 배포 체크리스트

- [ ] Vercel 프로젝트 생성 완료
- [ ] GitHub 저장소 연동 완료
- [ ] 환경변수 모두 설정 완료
- [ ] 프로덕션 배포 성공
- [ ] 프로덕션 URL 접속 가능
- [ ] 프리뷰 배포 동작 확인
- [ ] 환경변수 암호화 확인
- [ ] SSL 인증서 발급 확인
- [ ] 빌드 시간 최적화 확인

---

## 🔒 보안 고려사항

- 환경변수는 Vercel 대시보드에서만 관리
- Service Role Key는 Production 환경에만 설정
- .env 파일은 .gitignore에 추가
- 프리뷰 배포는 민감 정보 제외

---

## 📌 참고사항

**작업 완료 일시**: 대기중
**테스트/검토 결과**: 대기
**자동화 방식**: AI-only
**블로커**: 없음
**비고**:
- Vercel은 Next.js 최적화 자동 적용
- 프리뷰 배포는 무제한 제공
- 빌드 시간은 약 2-3분

---

**작성 방법론**: 15DGC-AODM v3.0
**AI-Only 원칙 준수**: ✅
