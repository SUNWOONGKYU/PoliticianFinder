# P4B3: Edge Function 캐싱

## 작업 정보
- **Phase**: Phase 4
- **영역**: Backend (Supabase)
- **담당 AI**: general-purpose
- **의존 작업**: P1D1
- **자동화 방식**: AI-only


## 자동화 방식
- **AI-only**: 이 작업은 Claude Code가 직접 구현합니다.
- 담당 서브에이전트가 자동으로 작업을 완료합니다.


## 작업 목표
Next.js API Routes와 Supabase 쿼리에 캐싱 전략을 적용하여 응답 속도를 개선합니다.

## 상세 요구사항

### 1. 현재 상황 파악
- `app/api/` 디렉토리의 모든 API Routes 확인
- 자주 호출되는 엔드포인트 식별 (정치인 목록, 상세, 평가 등)
- 현재 응답 시간 측정

### 2. 캐싱 전략 수립
다음 우선순위로 캐싱 적용:

**정적 데이터 (긴 캐싱)**:
- 정치인 기본 정보: `Cache-Control: public, max-age=3600, s-maxage=7200` (1-2시간)
- 정치인 목록: `Cache-Control: public, max-age=600, s-maxage=1200` (10-20분)

**동적 데이터 (짧은 캐싱)**:
- 평가 집계 데이터: `Cache-Control: public, max-age=60, s-maxage=120` (1-2분)
- 댓글/게시글: `Cache-Control: public, max-age=30, s-maxage=60` (30초-1분)

**사용자 데이터 (private 캐싱)**:
- 프로필, 알림: `Cache-Control: private, max-age=60` (1분)

### 3. 구현 세부사항

#### 3.1 Next.js API Routes 캐싱 헤더 추가
주요 API Routes에 응답 헤더 추가:
```typescript
export async function GET(request: Request) {
  // ... 데이터 조회 로직

  return NextResponse.json(data, {
    headers: {
      'Cache-Control': 'public, max-age=600, s-maxage=1200',
      'CDN-Cache-Control': 'max-age=1200',
      'Vercel-CDN-Cache-Control': 'max-age=1200'
    }
  });
}
```

#### 3.2 ETag 지원 구현 (선택사항)
- 데이터 변경 감지를 위한 ETag 생성
- 304 Not Modified 응답 처리

#### 3.3 Supabase 쿼리 최적화
- `select()` 쿼리에 필요한 필드만 요청
- 인덱스가 있는 컬럼으로 필터링 확인

### 4. 테스트 방법
- 브라우저 DevTools Network 탭에서 캐싱 헤더 확인
- 동일 요청 반복 시 캐시 히트 확인
- Lighthouse 성능 점수 측정 (before/after)
- 응답 시간 개선율 측정 (목표: 최소 30% 개선)

## 완료 기준
- [ ] 기능이 정상적으로 동작
- [ ] 타입스크립트 타입 안정성 확보
- [ ] 에러 처리 구현
- [ ] 테스트 작성 (해당 시)
- [ ] 코드 리뷰 통과

## 의존성
- **선행 작업**: P1D1
- **후행 작업**: 이 작업에 의존하는 작업은 프로젝트 그리드 참조

## 참고사항
- 15DGC-AODM v3.0 방법론 준수
- Phase 4 목표에 부합하는 구현
- 기존 코드베이스와의 일관성 유지

## 작업 진행 방식
1. 프로젝트 구조 파악
2. 관련 파일 검토
3. 구현 계획 수립
4. 코드 작성
5. 테스트 및 검증
6. 문서화

---
**생성일**: 2025-10-17
**방법론**: 15DGC-AODM v3.0
**담당**: general-purpose
