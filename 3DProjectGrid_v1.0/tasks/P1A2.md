# P1A2 - 환경 변수 관리

## 작업 ID
P1A2

## 담당 영역
DevOps

## 작업 개요
개발, 스테이징, 프로덕션 환경별로 환경 변수를 안전하게 관리하는 체계를 구축합니다.

## 상세 설명
`.env` 파일을 환경별로 분리하고, 민감한 정보를 안전하게 관리하며, 팀원들이 쉽게 설정할 수 있도록 문서화합니다.

## 기술 스택
- dotenv
- Vercel Environment Variables
- Git

## 구현 사항
1. 환경별 `.env` 파일 구조 설계
2. `.env.example` 템플릿 생성
3. `.gitignore` 설정
4. 환경 변수 검증 스크립트
5. 문서화 (README)

## 파일 구조
```
.env.local           # 로컬 개발 환경 (gitignore)
.env.development     # 개발 환경 기본값
.env.production      # 프로덕션 기본값
.env.example         # 템플릿 (Git에 포함)
```

## .env.example
```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# App
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_APP_NAME=PoliticianFinder

# Analytics (선택)
NEXT_PUBLIC_GA_ID=
```

## .env.local (로컬 개발)
```bash
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGci...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGci...
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

## .env.production (Vercel)
```bash
NEXT_PUBLIC_SUPABASE_URL=https://prod-xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGci...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGci...
NEXT_PUBLIC_APP_URL=https://politicianfinder.com
```

## .gitignore 업데이트
```
# Environment variables
.env.local
.env*.local
.env.development.local
.env.production.local

# Keep these
!.env.example
```

## 환경 변수 검증 스크립트
```javascript
// scripts/check-env.js
const requiredEnvVars = [
  'NEXT_PUBLIC_SUPABASE_URL',
  'NEXT_PUBLIC_SUPABASE_ANON_KEY',
]

const missingEnvVars = requiredEnvVars.filter(
  (envVar) => !process.env[envVar]
)

if (missingEnvVars.length > 0) {
  console.error('❌ Missing required environment variables:')
  missingEnvVars.forEach((envVar) => console.error(`  - ${envVar}`))
  console.error('\nPlease copy .env.example to .env.local and fill in the values.')
  process.exit(1)
}

console.log('✅ All required environment variables are set')
```

## package.json 스크립트
```json
{
  "scripts": {
    "check-env": "node scripts/check-env.js",
    "predev": "npm run check-env",
    "prebuild": "npm run check-env"
  }
}
```

## README 문서화
```markdown
## 환경 설정

1. `.env.example`을 복사하여 `.env.local` 생성:
   ```bash
   cp .env.example .env.local
   ```

2. Supabase 프로젝트 생성 후 API 키 발급

3. `.env.local`에 실제 값 입력

4. 개발 서버 실행:
   ```bash
   npm run dev
   ```
```

## Vercel 환경 변수 설정 방법
1. Vercel Dashboard → 프로젝트 선택
2. Settings → Environment Variables
3. 각 환경(Production, Preview, Development)별로 변수 추가
4. 저장 후 재배포

## 보안 체크리스트
- [ ] `.env.local`이 `.gitignore`에 포함됨
- [ ] Service Role Key는 서버 사이드에서만 사용
- [ ] Public 키와 Private 키 구분
- [ ] 프로덕션과 개발 환경 분리
- [ ] `.env.example`에는 실제 값 없음

## 성공 기준
- [ ] `.env.example` 생성 완료
- [ ] `.gitignore` 업데이트 완료
- [ ] 환경 변수 검증 스크립트 작동
- [ ] README 문서화 완료
- [ ] Vercel 환경 변수 설정 완료
- [ ] 팀원이 `.env.example`로 쉽게 설정 가능

## 의존 작업
- P1B1 (Supabase Client)
- P1B2 (환경 변수 설정)

## 예상 소요 시간
1시간

## 참고 사항
- `NEXT_PUBLIC_` 접두사: 클라이언트에서 접근 가능
- 접두사 없음: 서버 사이드에서만 접근 가능
- Vercel은 Git 커밋 SHA를 자동으로 환경 변수로 제공
