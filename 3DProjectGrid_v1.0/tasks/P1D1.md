# P1D1 - profiles 테이블 생성

**Phase**: Phase 1 - Supabase 기반 인증 시스템
**영역**: Database (Supabase)
**담당 AI**: fullstack-developer
**상태**: 완료 (2025-10-16 14:30)
**진도**: 100%

---

## 📋 작업 개요

사용자 프로필 정보를 저장하는 profiles 테이블을 생성합니다. auth.users 테이블과 1:1 관계를 맺으며, 사용자의 추가 정보를 저장합니다.

---

## 🎯 작업 목표

- [x] profiles 테이블 스키마 정의
- [x] auth.users와 FK 관계 설정
- [x] 기본 컬럼 및 제약조건 설정
- [x] 인덱스 생성
- [x] Trigger 함수 생성 (자동 프로필 생성)

---

## 📐 기술 사양

### Database
- DBMS: PostgreSQL (Supabase)
- Schema: public

### 테이블 구조
```sql
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  username TEXT UNIQUE,
  email TEXT NOT NULL,
  avatar_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 인덱스
```sql
CREATE INDEX idx_profiles_username ON profiles(username);
CREATE INDEX idx_profiles_email ON profiles(email);
```

### Trigger (자동 프로필 생성)
```sql
CREATE OR REPLACE FUNCTION handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, email)
  VALUES (NEW.id, NEW.email);
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW
  EXECUTE FUNCTION handle_new_user();
```

---

## 🔗 의존 작업

**선행 작업**: P1A1 (Supabase 프로젝트)
**후속 작업**: P1D2, P1E1, 모든 프로필 관련 기능

---

## ✅ 완료 기준

1. profiles 테이블이 생성됨
2. auth.users와 FK 관계가 설정됨
3. 인덱스가 생성됨
4. Trigger가 정상 동작함
5. 신규 사용자 가입 시 프로필 자동 생성됨

---

## 📝 테스트 계획

### 단위 테스트
- [x] 테이블 생성 확인
- [x] FK 제약조건 확인
- [x] Trigger 동작 확인

### 통합 테스트
- [x] 신규 사용자 가입 시 프로필 자동 생성
- [x] 사용자 삭제 시 프로필 CASCADE 삭제
- [x] username 중복 검증

---

## 🔒 보안 고려사항

- RLS 정책 설정 (P1E1에서 처리)
- 본인의 프로필만 조회/수정 가능
- username은 고유해야 함
- 민감한 정보는 별도 테이블로 분리

---

## 📌 참고사항

**작업 완료 일시**: 2025-10-16 14:30
**테스트/검토 결과**: 통과
**자동화 방식**: AI-only
**블로커**: 없음
**비고**: -

---

**작성 방법론**: 15DGC-AODM v3.0
**AI-Only 원칙 준수**: ✅
