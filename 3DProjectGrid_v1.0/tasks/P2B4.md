# P2B4 - ê²€ìƒ‰/í•„í„° API

**Phase**: Phase 2 - ì •ì¹˜ì¸ ëª©ë¡/ìƒì„¸
**ì˜ì—­**: Backend (Supabase)
**ë‹´ë‹¹ AI**: fullstack-developer
**ìƒíƒœ**: ì™„ë£Œ
**ì§„ë„**: 100%

---

## ğŸ“‹ ì‘ì—… ê°œìš”

ì •ì¹˜ì¸ ê²€ìƒ‰ ë° í•„í„°ë§ ê¸°ëŠ¥ì„ ìœ„í•œ API Routeë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. ì´ë¦„ ê²€ìƒ‰, ì •ë‹¹/ì§€ì—­/ì§ê¸‰ í•„í„°, ë³µí•© ì¡°ê±´ ì§€ì› ë“±ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ¯ ì‘ì—… ëª©í‘œ

- [ ] ì „ë¬¸ ê²€ìƒ‰ (Full-text Search)
- [ ] ë‹¤ì¤‘ í•„í„° ì§€ì›
- [ ] ë³µí•© ì¡°ê±´ ì²˜ë¦¬
- [ ] ì„±ëŠ¥ ìµœì í™” (ì¸ë±ìŠ¤ í™œìš©)
- [ ] ê²€ìƒ‰ì–´ ìë™ì™„ì„± ì§€ì›
- [ ] ì—ëŸ¬ í•¸ë“¤ë§

---

## ğŸ“ ê¸°ìˆ  ì‚¬ì–‘

### Backend
- Framework: Next.js 14 API Routes
- Database: Supabase (PostgreSQL)
- Language: TypeScript

### íŒŒì¼ êµ¬ì¡°
```
frontend/
  src/
    app/
      api/
        politicians/
          search/
            route.ts
        autocomplete/
          route.ts
```

---

## ğŸ”— ì˜ì¡´ ì‘ì—…

**ì„ í–‰ ì‘ì—…**: P2B1 (ì •ì¹˜ì¸ ëª©ë¡ API Route)
**í›„ì† ì‘ì—…**: P2F3 (ê²€ìƒ‰ í•„í„°ë§ UI)

---

## âœ… ì™„ë£Œ ê¸°ì¤€

1. ê²€ìƒ‰ API êµ¬í˜„
2. ë‹¤ì¤‘ í•„í„° ì§€ì›
3. ìë™ì™„ì„± API
4. ì„±ëŠ¥ ìµœì í™”
5. ì—ëŸ¬ í•¸ë“¤ë§
6. TypeScript íƒ€ì… ì•ˆì •ì„±

---

## ğŸ’» êµ¬í˜„ ìƒì„¸

```typescript
// app/api/politicians/search/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { supabase } from '@/lib/supabase'

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url)

    const query = searchParams.get('q') || ''
    const parties = searchParams.get('party')?.split(',').filter(Boolean) || []
    const regions = searchParams.get('region')?.split(',').filter(Boolean) || []
    const positions = searchParams.get('position')?.split(',').filter(Boolean) || []
    const page = Number(searchParams.get('page')) || 1
    const limit = Math.min(Number(searchParams.get('limit')) || 10, 100)

    let dbQuery = supabase
      .from('politicians')
      .select('*', { count: 'exact' })

    // ì´ë¦„ ê²€ìƒ‰ (ILIKE)
    if (query) {
      dbQuery = dbQuery.ilike('name', `%${query}%`)
    }

    // ì •ë‹¹ í•„í„°
    if (parties.length > 0) {
      dbQuery = dbQuery.in('party', parties)
    }

    // ì§€ì—­ í•„í„°
    if (regions.length > 0) {
      dbQuery = dbQuery.in('region', regions)
    }

    // ì§ê¸‰ í•„í„°
    if (positions.length > 0) {
      dbQuery = dbQuery.in('position', positions)
    }

    // í˜ì´ì§€ë„¤ì´ì…˜
    dbQuery = dbQuery.range((page - 1) * limit, page * limit - 1)

    const { data, error, count } = await dbQuery

    if (error) {
      return NextResponse.json(
        { error: 'Search failed' },
        { status: 500 }
      )
    }

    return NextResponse.json({
      data: data || [],
      pagination: {
        page,
        limit,
        total: count || 0,
        totalPages: Math.ceil((count || 0) / limit)
      }
    })
  } catch (error) {
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    )
  }
}
```

```typescript
// app/api/autocomplete/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { supabase } from '@/lib/supabase'

export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url)
    const query = searchParams.get('q') || ''

    if (query.length < 2) {
      return NextResponse.json({ suggestions: [] })
    }

    const { data, error } = await supabase
      .from('politicians')
      .select('id, name, party, region')
      .ilike('name', `%${query}%`)
      .limit(10)

    if (error) {
      return NextResponse.json({ suggestions: [] })
    }

    return NextResponse.json({
      suggestions: data?.map(p => ({
        id: p.id,
        name: p.name,
        label: `${p.name} (${p.party}, ${p.region})`
      })) || []
    })
  } catch (error) {
    return NextResponse.json({ suggestions: [] })
  }
}
```

---

## ğŸ“ í…ŒìŠ¤íŠ¸ ê³„íš

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] í•„í„° ì¡°í•© í…ŒìŠ¤íŠ¸
- [ ] ìë™ì™„ì„± í…ŒìŠ¤íŠ¸

### í†µí•© í…ŒìŠ¤íŠ¸
- [ ] ë³µí•© ì¡°ê±´ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (1000+ ë ˆì½”ë“œ)

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- SQL Injection ë°©ì§€
- ê²€ìƒ‰ì–´ ê¸¸ì´ ì œí•œ
- Rate Limiting

---

## ğŸ“Œ ì°¸ê³ ì‚¬í•­

**ì‘ì—… ì™„ë£Œ ì¼ì‹œ**: 2025-01-17
**í…ŒìŠ¤íŠ¸/ê²€í†  ê²°ê³¼**: ì™„ë£Œ
**ìë™í™” ë°©ì‹**: AI-only
**ë¸”ë¡œì»¤**: ì—†ìŒ
**ë¹„ê³ **: ì „ë¬¸ ê²€ìƒ‰, ë‹¤ì¤‘ í•„í„°, ìë™ì™„ì„± API êµ¬í˜„ ì™„ë£Œ

---

**ì‘ì„± ë°©ë²•ë¡ **: 15DGC-AODM v3.0
**AI-Only ì›ì¹™ ì¤€ìˆ˜**: âœ…
