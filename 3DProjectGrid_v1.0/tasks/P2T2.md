# P2T2 - í‰ê°€ ì‹œìŠ¤í…œ E2E

**Phase**: Phase 2 - ì •ì¹˜ì¸ ëª©ë¡/ìƒì„¸
**ì˜ì—­**: Test (E2E)
**ë‹´ë‹¹ AI**: devops-troubleshooter
**ìƒíƒœ**: ëŒ€ê¸°
**ì§„ë„**: 0%

---

## ğŸ“‹ ì‘ì—… ê°œìš”

ì‹œë¯¼ í‰ê°€ ì‹œìŠ¤í…œì˜ End-to-End í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. í‰ê°€ ìƒì„±, ìˆ˜ì •, ì‚­ì œ ë° 1ì¸ 1í‰ê°€ ì œí•œ ë“±ì˜ ê¸°ëŠ¥ì„ Playwrightë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

---

## ğŸ¯ ì‘ì—… ëª©í‘œ

- [ ] í‰ê°€ ìƒì„± í…ŒìŠ¤íŠ¸
- [ ] í‰ê°€ ìˆ˜ì • í…ŒìŠ¤íŠ¸
- [ ] í‰ê°€ ì‚­ì œ í…ŒìŠ¤íŠ¸
- [ ] 1ì¸ 1í‰ê°€ ì œí•œ í…ŒìŠ¤íŠ¸
- [ ] í‰ê°€ ëª©ë¡ ì¡°íšŒ í…ŒìŠ¤íŠ¸
- [ ] í‰ê·  í‰ì  ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] ê¶Œí•œ í™•ì¸ í…ŒìŠ¤íŠ¸
- [ ] ì¸ì¦ í•„ìˆ˜ í…ŒìŠ¤íŠ¸

---

## ğŸ“ ê¸°ìˆ  ì‚¬ì–‘

### Testing
- Framework: Playwright
- Language: TypeScript
- Auth: Supabase Test Users

---

## ğŸ”— ì˜ì¡´ ì‘ì—…

**ì„ í–‰ ì‘ì—…**: P2B2 (ì‹œë¯¼ í‰ê°€ API)
**í›„ì† ì‘ì—…**: P2V2 (CI/CD íŒŒì´í”„ë¼ì¸)

---

## âœ… ì™„ë£Œ ê¸°ì¤€

1. 8ê°œ ì´ìƒì˜ E2E í…ŒìŠ¤íŠ¸ ì‘ì„±
2. ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼
3. ì¸ì¦ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ì™„ë£Œ
4. 1ì¸ 1í‰ê°€ ì œì•½ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
5. ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

## ğŸ’» êµ¬í˜„ ìƒì„¸

### 1. í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹° (ì¸ì¦ í—¬í¼)

```typescript
// tests/e2e/helpers/auth.ts
import { Page } from '@playwright/test'

export async function loginAsTestUser(page: Page) {
  // í…ŒìŠ¤íŠ¸ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
  await page.goto('/login')
  await page.locator('[data-testid="email-input"]').fill('test@example.com')
  await page.locator('[data-testid="password-input"]').fill('testpass123')
  await page.locator('[data-testid="login-button"]').click()

  // ë¡œê·¸ì¸ ì™„ë£Œ ëŒ€ê¸°
  await page.waitForURL('/')
  await page.waitForSelector('[data-testid="user-menu"]')
}

export async function logoutUser(page: Page) {
  await page.locator('[data-testid="user-menu"]').click()
  await page.locator('[data-testid="logout-button"]').click()
  await page.waitForURL('/login')
}

export async function createTestRating(
  page: Page,
  politicianId: number,
  score: number,
  comment?: string
) {
  await page.goto(`/politicians/${politicianId}`)

  // í‰ê°€ ì‘ì„± ë²„íŠ¼ í´ë¦­
  await page.locator('[data-testid="write-rating-button"]').click()

  // í‰ì  ì„ íƒ
  await page.locator(`[data-testid="rating-star-${score}"]`).click()

  // ì½”ë©˜íŠ¸ ì…ë ¥ (ì„ íƒ)
  if (comment) {
    await page.locator('[data-testid="rating-comment"]').fill(comment)
  }

  // ì œì¶œ
  await page.locator('[data-testid="submit-rating"]').click()

  // ì„±ê³µ ë©”ì‹œì§€ ëŒ€ê¸°
  await page.waitForSelector('[data-testid="rating-success"]')
}
```

### 2. í‰ê°€ ìƒì„± í…ŒìŠ¤íŠ¸

```typescript
// tests/e2e/rating-create.spec.ts
import { test, expect } from '@playwright/test'
import { loginAsTestUser } from './helpers/auth'

test.describe('í‰ê°€ ìƒì„±', () => {
  test.beforeEach(async ({ page }) => {
    await loginAsTestUser(page)
  })

  test('ì •ì¹˜ì¸ í‰ê°€ ì‘ì„±', async ({ page }) => {
    await page.goto('/politicians/1')

    // í‰ê°€ ì‘ì„± ë²„íŠ¼ í´ë¦­
    await page.locator('[data-testid="write-rating-button"]').click()

    // í‰ê°€ ëª¨ë‹¬/í¼ í‘œì‹œ í™•ì¸
    await expect(page.locator('[data-testid="rating-modal"]')).toBeVisible()

    // í‰ì  ì„ íƒ (5ì )
    await page.locator('[data-testid="rating-star-5"]').click()

    // ë³„ í‘œì‹œ í™•ì¸
    const stars = page.locator('[data-testid^="rating-star-"]')
    for (let i = 1; i <= 5; i++) {
      await expect(stars.nth(i - 1)).toHaveClass(/filled/)
    }

    // ì½”ë©˜íŠ¸ ì…ë ¥
    const comment = 'í›Œë¥­í•œ ì •ì¹˜ì¸ì…ë‹ˆë‹¤'
    await page.locator('[data-testid="rating-comment"]').fill(comment)

    // ì œì¶œ
    await page.locator('[data-testid="submit-rating"]').click()

    // ì„±ê³µ ë©”ì‹œì§€ í™•ì¸
    await expect(page.locator('[data-testid="toast-success"]')).toBeVisible()
    await expect(page.locator('[data-testid="toast-success"]')).toContainText(
      'í‰ê°€ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤'
    )

    // í‰ê°€ ëª©ë¡ì— í‘œì‹œ í™•ì¸
    await expect(page.locator('[data-testid="my-rating"]')).toBeVisible()
    await expect(page.locator('[data-testid="my-rating"]')).toContainText(comment)

    // í‰ê·  í‰ì  ì—…ë°ì´íŠ¸ í™•ì¸
    const avgRating = await page.locator('[data-testid="avg-rating"]').textContent()
    expect(parseFloat(avgRating!)).toBeGreaterThan(0)
  })

  test('ì½”ë©˜íŠ¸ ì—†ì´ í‰ê°€ ì‘ì„±', async ({ page }) => {
    await page.goto('/politicians/1')
    await page.locator('[data-testid="write-rating-button"]').click()

    // í‰ì ë§Œ ì„ íƒ
    await page.locator('[data-testid="rating-star-4"]').click()

    // ì œì¶œ
    await page.locator('[data-testid="submit-rating"]').click()

    // ì„±ê³µ í™•ì¸
    await expect(page.locator('[data-testid="toast-success"]')).toBeVisible()
  })

  test('í‰ì  ì„ íƒ ì—†ì´ ì œì¶œ ì‹œ ì—ëŸ¬', async ({ page }) => {
    await page.goto('/politicians/1')
    await page.locator('[data-testid="write-rating-button"]').click()

    // í‰ì  ì„ íƒ ì—†ì´ ì œì¶œ
    await page.locator('[data-testid="submit-rating"]').click()

    // ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
    await expect(page.locator('[data-testid="rating-error"]')).toBeVisible()
    await expect(page.locator('[data-testid="rating-error"]')).toContainText(
      'í‰ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”'
    )
  })
})
```

### 3. 1ì¸ 1í‰ê°€ ì œí•œ í…ŒìŠ¤íŠ¸

```typescript
// tests/e2e/rating-constraint.spec.ts
import { test, expect } from '@playwright/test'
import { loginAsTestUser, createTestRating } from './helpers/auth'

test.describe('1ì¸ 1í‰ê°€ ì œí•œ', () => {
  test.beforeEach(async ({ page }) => {
    await loginAsTestUser(page)
  })

  test('ì´ë¯¸ í‰ê°€í•œ ì •ì¹˜ì¸ì—ê²Œ ì¤‘ë³µ í‰ê°€ ë¶ˆê°€', async ({ page }) => {
    const politicianId = 1

    // ì²« ë²ˆì§¸ í‰ê°€ ì‘ì„±
    await createTestRating(page, politicianId, 5, 'ì²« ë²ˆì§¸ í‰ê°€')

    // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
    await page.reload()

    // í‰ê°€ ì‘ì„± ë²„íŠ¼ì´ "ìˆ˜ì •í•˜ê¸°"ë¡œ ë³€ê²½ë¨
    await expect(page.locator('[data-testid="write-rating-button"]')).not.toBeVisible()
    await expect(page.locator('[data-testid="edit-rating-button"]')).toBeVisible()
  })

  test('ì´ë¯¸ í‰ê°€í•œ ê²½ìš° í‰ê°€ ì‘ì„± í¼ ëŒ€ì‹  ìˆ˜ì • í¼ í‘œì‹œ', async ({ page }) => {
    await page.goto('/politicians/1')

    // ì´ë¯¸ í‰ê°€ê°€ ìˆëŠ” ê²½ìš°
    const hasRating = await page.locator('[data-testid="my-rating"]').isVisible()

    if (hasRating) {
      // ìˆ˜ì • ë²„íŠ¼ë§Œ í‘œì‹œ
      await expect(page.locator('[data-testid="edit-rating-button"]')).toBeVisible()
      await expect(page.locator('[data-testid="write-rating-button"]')).not.toBeVisible()
    } else {
      // ì‘ì„± ë²„íŠ¼ë§Œ í‘œì‹œ
      await expect(page.locator('[data-testid="write-rating-button"]')).toBeVisible()
      await expect(page.locator('[data-testid="edit-rating-button"]')).not.toBeVisible()
    }
  })
})
```

### 4. í‰ê°€ ìˆ˜ì • í…ŒìŠ¤íŠ¸

```typescript
// tests/e2e/rating-update.spec.ts
import { test, expect } from '@playwright/test'
import { loginAsTestUser, createTestRating } from './helpers/auth'

test.describe('í‰ê°€ ìˆ˜ì •', () => {
  test.beforeEach(async ({ page }) => {
    await loginAsTestUser(page)
  })

  test('ë³¸ì¸ í‰ê°€ ìˆ˜ì •', async ({ page }) => {
    const politicianId = 1

    // í‰ê°€ ì‘ì„± (ì—†ëŠ” ê²½ìš°)
    await page.goto(`/politicians/${politicianId}`)
    const hasRating = await page.locator('[data-testid="my-rating"]').isVisible()

    if (!hasRating) {
      await createTestRating(page, politicianId, 3, 'ì´ˆê¸° í‰ê°€')
    }

    // ìˆ˜ì • ë²„íŠ¼ í´ë¦­
    await page.locator('[data-testid="edit-rating-button"]').click()

    // ê¸°ì¡´ í‰ì  ë° ì½”ë©˜íŠ¸ í‘œì‹œ í™•ì¸
    await expect(page.locator('[data-testid="rating-star-3"]')).toHaveClass(/filled/)

    // í‰ì  ë³€ê²½ (5ì )
    await page.locator('[data-testid="rating-star-5"]').click()

    // ì½”ë©˜íŠ¸ ë³€ê²½
    const newComment = 'ìˆ˜ì •ëœ í‰ê°€ì…ë‹ˆë‹¤'
    await page.locator('[data-testid="rating-comment"]').clear()
    await page.locator('[data-testid="rating-comment"]').fill(newComment)

    // ìˆ˜ì • ì œì¶œ
    await page.locator('[data-testid="update-rating"]').click()

    // ì„±ê³µ ë©”ì‹œì§€
    await expect(page.locator('[data-testid="toast-success"]')).toContainText(
      'í‰ê°€ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤'
    )

    // ë³€ê²½ ì‚¬í•­ í™•ì¸
    await expect(page.locator('[data-testid="my-rating"]')).toContainText(newComment)

    // í‰ê·  í‰ì  ì¬ê³„ì‚° í™•ì¸
    const avgRating = await page.locator('[data-testid="avg-rating"]').textContent()
    expect(avgRating).toBeDefined()
  })

  test('í‰ê°€ ìˆ˜ì • ì·¨ì†Œ', async ({ page }) => {
    await page.goto('/politicians/1')

    // ìˆ˜ì • ë²„íŠ¼ í´ë¦­
    await page.locator('[data-testid="edit-rating-button"]').click()

    // ì›ë³¸ ì½”ë©˜íŠ¸ ì €ì¥
    const originalComment = await page
      .locator('[data-testid="rating-comment"]')
      .inputValue()

    // ì½”ë©˜íŠ¸ ë³€ê²½
    await page.locator('[data-testid="rating-comment"]').fill('ë³€ê²½í•  ë‚´ìš©')

    // ì·¨ì†Œ ë²„íŠ¼ í´ë¦­
    await page.locator('[data-testid="cancel-edit"]').click()

    // ëª¨ë‹¬ ë‹«í˜ í™•ì¸
    await expect(page.locator('[data-testid="rating-modal"]')).not.toBeVisible()

    // ì›ë³¸ ì½”ë©˜íŠ¸ ìœ ì§€ í™•ì¸
    await expect(page.locator('[data-testid="my-rating"]')).toContainText(originalComment)
  })
})
```

### 5. í‰ê°€ ì‚­ì œ í…ŒìŠ¤íŠ¸

```typescript
// tests/e2e/rating-delete.spec.ts
import { test, expect } from '@playwright/test'
import { loginAsTestUser, createTestRating } from './helpers/auth'

test.describe('í‰ê°€ ì‚­ì œ', () => {
  test.beforeEach(async ({ page }) => {
    await loginAsTestUser(page)
  })

  test('ë³¸ì¸ í‰ê°€ ì‚­ì œ', async ({ page }) => {
    const politicianId = 1

    // í‰ê°€ ì‘ì„± (ì—†ëŠ” ê²½ìš°)
    await page.goto(`/politicians/${politicianId}`)
    const hasRating = await page.locator('[data-testid="my-rating"]').isVisible()

    if (!hasRating) {
      await createTestRating(page, politicianId, 4, 'ì‚­ì œí•  í‰ê°€')
    }

    // ì‚­ì œ ë²„íŠ¼ í´ë¦­
    await page.locator('[data-testid="delete-rating-button"]').click()

    // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
    await expect(page.locator('[data-testid="confirm-dialog"]')).toBeVisible()
    await expect(page.locator('[data-testid="confirm-dialog"]')).toContainText(
      'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
    )

    // í™•ì¸ ë²„íŠ¼ í´ë¦­
    await page.locator('[data-testid="confirm-delete"]').click()

    // ì„±ê³µ ë©”ì‹œì§€
    await expect(page.locator('[data-testid="toast-success"]')).toContainText(
      'í‰ê°€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤'
    )

    // í‰ê°€ ì œê±° í™•ì¸
    await expect(page.locator('[data-testid="my-rating"]')).not.toBeVisible()

    // í‰ê°€ ì‘ì„± ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ
    await expect(page.locator('[data-testid="write-rating-button"]')).toBeVisible()

    // í‰ê·  í‰ì  ì¬ê³„ì‚°
    const avgRating = await page.locator('[data-testid="avg-rating"]').textContent()
    expect(avgRating).toBeDefined()
  })

  test('ì‚­ì œ ì·¨ì†Œ', async ({ page }) => {
    await page.goto('/politicians/1')

    // ì‚­ì œ ë²„íŠ¼ í´ë¦­
    await page.locator('[data-testid="delete-rating-button"]').click()

    // ì·¨ì†Œ ë²„íŠ¼ í´ë¦­
    await page.locator('[data-testid="cancel-delete"]').click()

    // ë‹¤ì´ì–¼ë¡œê·¸ ë‹«í˜
    await expect(page.locator('[data-testid="confirm-dialog"]')).not.toBeVisible()

    // í‰ê°€ ìœ ì§€
    await expect(page.locator('[data-testid="my-rating"]')).toBeVisible()
  })
})
```

### 6. ì¸ì¦ í•„ìˆ˜ í…ŒìŠ¤íŠ¸

```typescript
// tests/e2e/rating-auth.spec.ts
import { test, expect } from '@playwright/test'

test.describe('í‰ê°€ ì‹œìŠ¤í…œ ì¸ì¦ ìš”êµ¬', () => {
  test('ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œ í‰ê°€ ì‘ì„± ë¶ˆê°€', async ({ page }) => {
    await page.goto('/politicians/1')

    // í‰ê°€ ì‘ì„± ë²„íŠ¼ í´ë¦­
    await page.locator('[data-testid="write-rating-button"]').click()

    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
    await expect(page).toHaveURL(/\/login/)

    // ë˜ëŠ” ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
    await expect(page.locator('[data-testid="login-modal"]')).toBeVisible()
    await expect(page.locator('[data-testid="login-modal"]')).toContainText(
      'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤'
    )
  })

  test('ë¹„ë¡œê·¸ì¸ ìƒíƒœì—ì„œ í‰ê°€ ëª©ë¡ì€ ì¡°íšŒ ê°€ëŠ¥', async ({ page }) => {
    await page.goto('/politicians/1')

    // í‰ê°€ ëª©ë¡ì€ ë³´ì„
    const ratings = page.locator('[data-testid="rating-item"]')
    await expect(ratings).toBeVisible()

    // í‰ê·  í‰ì ë„ ë³´ì„
    await expect(page.locator('[data-testid="avg-rating"]')).toBeVisible()
  })
})
```

### 7. í‰ê°€ ëª©ë¡ ì¡°íšŒ í…ŒìŠ¤íŠ¸

```typescript
// tests/e2e/rating-list.spec.ts
import { test, expect } from '@playwright/test'

test.describe('í‰ê°€ ëª©ë¡ ì¡°íšŒ', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/politicians/1')
  })

  test('í‰ê°€ ëª©ë¡ í‘œì‹œ', async ({ page }) => {
    // í‰ê°€ ëª©ë¡ ì„¹ì…˜ í‘œì‹œ
    await expect(page.locator('[data-testid="ratings-section"]')).toBeVisible()

    // í‰ê°€ ì•„ì´í…œ í‘œì‹œ
    const ratings = page.locator('[data-testid="rating-item"]')
    const count = await ratings.count()
    expect(count).toBeGreaterThan(0)

    // ì²« ë²ˆì§¸ í‰ê°€ ë‚´ìš© í™•ì¸
    const firstRating = ratings.first()
    await expect(firstRating.locator('[data-testid="rating-author"]')).toBeVisible()
    await expect(firstRating.locator('[data-testid="rating-score"]')).toBeVisible()
    await expect(firstRating.locator('[data-testid="rating-date"]')).toBeVisible()
  })

  test('í‰ê°€ í˜ì´ì§€ë„¤ì´ì…˜', async ({ page }) => {
    // ì²« í˜ì´ì§€ í‰ê°€ ìˆ˜ í™•ì¸
    const ratings = page.locator('[data-testid="rating-item"]')
    const firstPageCount = await ratings.count()

    // ë‹¤ìŒ í˜ì´ì§€
    await page.locator('[data-testid="ratings-next-page"]').click()

    // ìƒˆë¡œìš´ í‰ê°€ ë¡œë“œ í™•ì¸
    await page.waitForTimeout(500)
    const firstRatingId = await ratings.first().getAttribute('data-rating-id')

    expect(firstRatingId).toBeDefined()
  })

  test('í‰ê°€ ì •ë ¬ (ìµœì‹ ìˆœ)', async ({ page }) => {
    // ì •ë ¬ ì˜µì…˜ ì„ íƒ
    await page.locator('[data-testid="rating-sort"]').selectOption('created_at_desc')

    // ë‚ ì§œ ìˆœì„œ í™•ì¸
    const dates = await page
      .locator('[data-testid="rating-date"]')
      .allTextContents()
      .then(texts => texts.map(t => new Date(t)))

    // ë‚´ë¦¼ì°¨ìˆœ í™•ì¸
    for (let i = 0; i < dates.length - 1; i++) {
      expect(dates[i].getTime()).toBeGreaterThanOrEqual(dates[i + 1].getTime())
    }
  })
})
```

---

## ğŸ“ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# í‰ê°€ ì‹œìŠ¤í…œ E2E í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰
npx playwright test rating

# íŠ¹ì • íŒŒì¼ ì‹¤í–‰
npx playwright test rating-create.spec.ts

# ë””ë²„ê·¸ ëª¨ë“œ
npx playwright test rating-create.spec.ts --debug
```

---

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- í…ŒìŠ¤íŠ¸ ê³„ì •ì€ ë³„ë„ ê²©ë¦¬ëœ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©
- í…ŒìŠ¤íŠ¸ í›„ ìƒì„±ëœ ë°ì´í„° ìë™ ì •ë¦¬ (cleanup)
- RLS ì •ì±… ë™ì‘ í™•ì¸

---

## ğŸ“Œ ì°¸ê³ ì‚¬í•­

**ì‘ì—… ì™„ë£Œ ì¼ì‹œ**: ëŒ€ê¸°ì¤‘
**í…ŒìŠ¤íŠ¸/ê²€í†  ê²°ê³¼**: ëŒ€ê¸°
**ìë™í™” ë°©ì‹**: AI-only
**ë¸”ë¡œì»¤**: ì—†ìŒ
**ë¹„ê³ **:
- 1ì¸ 1í‰ê°€ ì œì•½ì€ UIì™€ DB ì–‘ì¸¡ì—ì„œ ê²€ì¦
- í‰ê·  í‰ì ì€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¬ê³„ì‚°ë˜ì–´ í‘œì‹œ
- í…ŒìŠ¤íŠ¸ ë°ì´í„°ëŠ” ê° í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬ ê¶Œì¥

---

**ì‘ì„± ë°©ë²•ë¡ **: 15DGC-AODM v3.0
**AI-Only ì›ì¹™ ì¤€ìˆ˜**: âœ…
