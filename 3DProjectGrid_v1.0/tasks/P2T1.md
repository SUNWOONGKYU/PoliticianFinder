# P2T1 - 정치인 목록 E2E

**Phase**: Phase 2 - 정치인 목록/상세
**영역**: Test (E2E)
**담당 AI**: devops-troubleshooter
**상태**: 대기
**진도**: 0%

---

## 📋 작업 개요

정치인 목록 페이지의 End-to-End 테스트를 작성합니다. Playwright를 사용하여 사용자 시나리오를 자동화하고, 목록 조회, 검색, 필터링, 페이지네이션 등의 기능을 테스트합니다.

---

## 🎯 작업 목표

- [ ] Playwright 설정
- [ ] 목록 조회 테스트
- [ ] 검색 기능 테스트
- [ ] 필터링 테스트 (정당, 지역, 직급)
- [ ] 정렬 기능 테스트
- [ ] 페이지네이션 테스트
- [ ] 반응형 디자인 테스트
- [ ] CI/CD 통합

---

## 📐 기술 사양

### Testing
- Framework: Playwright
- Language: TypeScript
- Runner: npm scripts
- CI: GitHub Actions (P2V2)

---

## 🔗 의존 작업

**선행 작업**: P2F7 (정치인 목록 페이지)
**후속 작업**: P2V2 (CI/CD 파이프라인)

---

## ✅ 완료 기준

1. Playwright 설정 완료
2. 10개 이상의 E2E 테스트 작성
3. 모든 테스트 통과
4. 테스트 커버리지 80% 이상
5. CI/CD 통합 완료
6. 스크린샷 및 비디오 녹화 설정

---

## 💻 구현 상세

### 1. Playwright 설치 및 설정

```bash
# Playwright 설치
npm install -D @playwright/test
npx playwright install

# 브라우저 설치
npx playwright install chromium firefox webkit
```

**playwright.config.ts**

```typescript
import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',

  use: {
    baseURL: process.env.BASE_URL || 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure'
  },

  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] }
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] }
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] }
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] }
    }
  ],

  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
    timeout: 120 * 1000
  }
})
```

### 2. 목록 조회 테스트

```typescript
// tests/e2e/politicians-list.spec.ts
import { test, expect } from '@playwright/test'

test.describe('정치인 목록 페이지', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/politicians')
  })

  test('정치인 목록이 표시된다', async ({ page }) => {
    // 페이지 제목 확인
    await expect(page).toHaveTitle(/정치인 목록/)

    // 정치인 카드가 표시되는지 확인
    const cards = page.locator('[data-testid="politician-card"]')
    await expect(cards).toHaveCount(10) // 첫 페이지 10개

    // 첫 번째 카드 내용 확인
    const firstCard = cards.first()
    await expect(firstCard.locator('[data-testid="politician-name"]')).toBeVisible()
    await expect(firstCard.locator('[data-testid="politician-party"]')).toBeVisible()
    await expect(firstCard.locator('[data-testid="politician-rating"]')).toBeVisible()
  })

  test('정치인 카드 클릭 시 상세 페이지로 이동', async ({ page }) => {
    const firstCard = page.locator('[data-testid="politician-card"]').first()
    const politicianName = await firstCard.locator('[data-testid="politician-name"]').textContent()

    await firstCard.click()

    // URL 변경 확인
    await expect(page).toHaveURL(/\/politicians\/\d+/)

    // 상세 페이지 제목 확인
    await expect(page.locator('h1')).toContainText(politicianName!)
  })
})
```

### 3. 검색 기능 테스트

```typescript
// tests/e2e/politicians-search.spec.ts
import { test, expect } from '@playwright/test'

test.describe('정치인 검색', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/politicians')
  })

  test('이름으로 검색', async ({ page }) => {
    const searchInput = page.locator('[data-testid="search-input"]')
    await searchInput.fill('홍길동')
    await searchInput.press('Enter')

    // URL 쿼리 파라미터 확인
    await expect(page).toHaveURL(/search=홍길동/)

    // 검색 결과 확인
    const cards = page.locator('[data-testid="politician-card"]')
    await expect(cards).toHaveCountGreaterThan(0)

    // 모든 카드에 "홍길동" 포함 확인
    const names = await cards.locator('[data-testid="politician-name"]').allTextContents()
    names.forEach(name => {
      expect(name).toContain('홍길동')
    })
  })

  test('검색 결과 없음 메시지', async ({ page }) => {
    const searchInput = page.locator('[data-testid="search-input"]')
    await searchInput.fill('존재하지않는정치인')
    await searchInput.press('Enter')

    await expect(page.locator('[data-testid="no-results"]')).toBeVisible()
    await expect(page.locator('[data-testid="no-results"]')).toContainText('검색 결과가 없습니다')
  })

  test('검색어 디바운싱', async ({ page }) => {
    const searchInput = page.locator('[data-testid="search-input"]')

    // 빠르게 타이핑
    await searchInput.type('홍', { delay: 50 })
    await searchInput.type('길', { delay: 50 })
    await searchInput.type('동', { delay: 50 })

    // 500ms 대기 (디바운스 시간)
    await page.waitForTimeout(600)

    // 검색 실행 확인
    await expect(page).toHaveURL(/search=홍길동/)
  })
})
```

### 4. 필터링 테스트

```typescript
// tests/e2e/politicians-filter.spec.ts
import { test, expect } from '@playwright/test'

test.describe('정치인 필터링', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/politicians')
  })

  test('정당 필터', async ({ page }) => {
    // 정당 드롭다운 열기
    await page.locator('[data-testid="party-filter"]').click()

    // "더불어민주당" 선택
    await page.locator('[data-testid="filter-option-더불어민주당"]').click()

    // URL 확인
    await expect(page).toHaveURL(/party=더불어민주당/)

    // 필터링 결과 확인
    const parties = await page.locator('[data-testid="politician-party"]').allTextContents()
    parties.forEach(party => {
      expect(party).toBe('더불어민주당')
    })

    // 필터 뱃지 표시 확인
    await expect(page.locator('[data-testid="filter-badge"]')).toContainText('더불어민주당')
  })

  test('다중 필터 (정당 + 지역)', async ({ page }) => {
    // 정당 필터
    await page.locator('[data-testid="party-filter"]').click()
    await page.locator('[data-testid="filter-option-더불어민주당"]').click()

    // 지역 필터
    await page.locator('[data-testid="region-filter"]').click()
    await page.locator('[data-testid="filter-option-서울"]').click()

    // URL 확인
    await expect(page).toHaveURL(/party=더불어민주당/)
    await expect(page).toHaveURL(/region=서울/)

    // 결과 확인
    const cards = page.locator('[data-testid="politician-card"]')
    const count = await cards.count()
    expect(count).toBeGreaterThan(0)

    // 2개의 필터 뱃지 표시
    await expect(page.locator('[data-testid="filter-badge"]')).toHaveCount(2)
  })

  test('필터 초기화', async ({ page }) => {
    // 필터 적용
    await page.locator('[data-testid="party-filter"]').click()
    await page.locator('[data-testid="filter-option-더불어민주당"]').click()

    // 초기화 버튼 클릭
    await page.locator('[data-testid="reset-filters"]').click()

    // URL 확인 (필터 제거됨)
    await expect(page).toHaveURL('/politicians')

    // 필터 뱃지 제거됨
    await expect(page.locator('[data-testid="filter-badge"]')).toHaveCount(0)
  })
})
```

### 5. 정렬 테스트

```typescript
// tests/e2e/politicians-sort.spec.ts
import { test, expect } from '@playwright/test'

test.describe('정치인 정렬', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/politicians')
  })

  test('평점순 정렬', async ({ page }) => {
    // 정렬 드롭다운 열기
    await page.locator('[data-testid="sort-dropdown"]').click()

    // "평점 높은순" 선택
    await page.locator('[data-testid="sort-option-rating-desc"]').click()

    // URL 확인
    await expect(page).toHaveURL(/sort=avg_rating&order=desc/)

    // 정렬 결과 확인
    const ratings = await page
      .locator('[data-testid="politician-rating"]')
      .allTextContents()
      .then(texts => texts.map(t => parseFloat(t)))

    // 내림차순 확인
    for (let i = 0; i < ratings.length - 1; i++) {
      expect(ratings[i]).toBeGreaterThanOrEqual(ratings[i + 1])
    }
  })

  test('이름순 정렬', async ({ page }) => {
    await page.locator('[data-testid="sort-dropdown"]').click()
    await page.locator('[data-testid="sort-option-name-asc"]').click()

    await expect(page).toHaveURL(/sort=name&order=asc/)

    const names = await page.locator('[data-testid="politician-name"]').allTextContents()

    // 가나다순 확인
    const sortedNames = [...names].sort()
    expect(names).toEqual(sortedNames)
  })
})
```

### 6. 페이지네이션 테스트

```typescript
// tests/e2e/politicians-pagination.spec.ts
import { test, expect } from '@playwright/test'

test.describe('페이지네이션', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/politicians')
  })

  test('다음 페이지 이동', async ({ page }) => {
    // 2페이지로 이동
    await page.locator('[data-testid="pagination-next"]').click()

    // URL 확인
    await expect(page).toHaveURL(/page=2/)

    // 새로운 정치인 목록 로드 확인
    const cards = page.locator('[data-testid="politician-card"]')
    await expect(cards).toHaveCount(10)
  })

  test('특정 페이지 번호 클릭', async ({ page }) => {
    // 3페이지 클릭
    await page.locator('[data-testid="pagination-page-3"]').click()

    await expect(page).toHaveURL(/page=3/)

    // 활성 페이지 표시 확인
    await expect(page.locator('[data-testid="pagination-page-3"]')).toHaveClass(/active/)
  })

  test('첫 페이지/마지막 페이지 버튼', async ({ page }) => {
    // 마지막 페이지로 이동
    await page.locator('[data-testid="pagination-last"]').click()

    // 다음 버튼 비활성화 확인
    await expect(page.locator('[data-testid="pagination-next"]')).toBeDisabled()

    // 첫 페이지로 이동
    await page.locator('[data-testid="pagination-first"]').click()

    await expect(page).toHaveURL(/page=1/)

    // 이전 버튼 비활성화 확인
    await expect(page.locator('[data-testid="pagination-prev"]')).toBeDisabled()
  })
})
```

### 7. 반응형 테스트

```typescript
// tests/e2e/politicians-responsive.spec.ts
import { test, expect, devices } from '@playwright/test'

test.describe('반응형 디자인', () => {
  test('모바일 화면 (375x667)', async ({ page }) => {
    await page.setViewportSize({ width: 375, height: 667 })
    await page.goto('/politicians')

    // 모바일 레이아웃 확인
    const grid = page.locator('[data-testid="politician-grid"]')
    await expect(grid).toHaveCSS('grid-template-columns', /1fr/) // 1열

    // 필터 버튼 확인 (모바일에서는 햄버거 메뉴)
    await expect(page.locator('[data-testid="mobile-filter-button"]')).toBeVisible()
  })

  test('태블릿 화면 (768x1024)', async ({ page }) => {
    await page.setViewportSize({ width: 768, height: 1024 })
    await page.goto('/politicians')

    // 태블릿 레이아웃 확인 (2열)
    const grid = page.locator('[data-testid="politician-grid"]')
    await expect(grid).toHaveCSS('grid-template-columns', /2fr/)
  })

  test('데스크톱 화면 (1920x1080)', async ({ page }) => {
    await page.setViewportSize({ width: 1920, height: 1080 })
    await page.goto('/politicians')

    // 데스크톱 레이아웃 확인 (3-4열)
    const grid = page.locator('[data-testid="politician-grid"]')
    const columns = await grid.evaluate(el => {
      return window.getComputedStyle(el).gridTemplateColumns.split(' ').length
    })

    expect(columns).toBeGreaterThanOrEqual(3)
  })
})
```

### 8. package.json 스크립트

```json
{
  "scripts": {
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "test:e2e:headed": "playwright test --headed",
    "test:e2e:debug": "playwright test --debug",
    "test:e2e:report": "playwright show-report"
  }
}
```

---

## 📝 테스트 실행

### 로컬 실행

```bash
# 모든 E2E 테스트 실행
npm run test:e2e

# UI 모드로 실행 (인터랙티브)
npm run test:e2e:ui

# 헤드리스 모드 OFF (브라우저 보이기)
npm run test:e2e:headed

# 디버그 모드
npm run test:e2e:debug

# 특정 파일만 실행
npx playwright test politicians-list.spec.ts
```

### CI/CD 실행 (GitHub Actions)

```yaml
# .github/workflows/e2e-tests.yml
name: E2E Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright browsers
        run: npx playwright install --with-deps

      - name: Run E2E tests
        run: npm run test:e2e
        env:
          BASE_URL: ${{ secrets.STAGING_URL }}

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: playwright-report
          path: playwright-report/
```

---

## 🔒 보안 고려사항

- 테스트 데이터는 별도 DB 사용 (test 환경)
- 민감 정보는 환경변수로 관리
- Production DB에서 테스트 금지

---

## 📌 참고사항

**작업 완료 일시**: 대기중
**테스트/검토 결과**: 대기
**자동화 방식**: AI-only
**블로커**: 없음
**비고**:
- Playwright는 Chromium, Firefox, WebKit 모두 지원
- 테스트 실패 시 스크린샷 및 비디오 자동 저장
- CI/CD 통합으로 자동화된 회귀 테스트 가능

---

**작성 방법론**: 15DGC-AODM v3.0
**AI-Only 원칙 준수**: ✅
