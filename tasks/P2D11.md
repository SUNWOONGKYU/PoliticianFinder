# P2D11: 데이터베이스 마이그레이션 실행

## 작업 ID
P2D11

## 작업 개요
Supabase 데이터베이스에 P2D1-P2D4 마이그레이션 실행

## 담당 AI
devops-troubleshooter

## 의존 작업
P2D1, P2D2, P2D3, P2D4

## 블로커
Supabase CLI 연결 또는 Dashboard 수동 실행 필요

## 작업 내용

### 방법 1: Supabase Dashboard (권장)
```
1. https://supabase.com/dashboard 접속
2. Project (ooddlafwdpzgxfefgsrx) 선택
3. 좌측 메뉴 "SQL Editor" 클릭
4. "New Query" 버튼 클릭
5. supabase/COMBINED_P2_MIGRATIONS.sql 파일 내용 복사
6. 붙여넣기
7. "Run" 버튼 클릭 (Ctrl+Enter)
8. 에러 없이 완료 확인
```

### 방법 2: Supabase CLI
```bash
cd "G:/내 드라이브/Developement/PoliticianFinder"
npx supabase link --project-ref ooddlafwdpzgxfefgsrx
npx supabase db push
```

### 방법 3: psql 직접 연결
```bash
psql "postgresql://postgres:[PASSWORD]@db.ooddlafwdpzgxfefgsrx.supabase.co:5432/postgres" < supabase/COMBINED_P2_MIGRATIONS.sql
```

## 검증 방법

### 1. 새 테이블 생성 확인
```sql
SELECT table_name FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name IN ('politician_posts', 'politician_score_history', 'connected_services', 'widget_ads');
-- 결과: 4개 테이블
```

### 2. 새 뷰 생성 확인
```sql
SELECT table_name FROM information_schema.views
WHERE table_schema = 'public'
AND table_name LIKE 'v_%';
-- 결과: v_ai_ranking_top10, v_hot_posts_top15, v_politician_posts_recent9 등
```

### 3. 새 함수 생성 확인
```sql
SELECT routine_name FROM information_schema.routines
WHERE routine_schema = 'public'
AND routine_name IN ('calculate_composite_score', 'calculate_hot_score', 'get_sidebar_data');
-- 결과: 3개 함수
```

### 4. AI Scores 컬럼 확인
```sql
SELECT column_name FROM information_schema.columns
WHERE table_name = 'ai_scores'
AND column_name IN ('gpt_score', 'gemini_score', 'grok_score', 'perplexity_score');
-- 결과: 4개 컬럼
```

### 5. Posts 컬럼 확인
```sql
SELECT column_name FROM information_schema.columns
WHERE table_name = 'posts'
AND column_name IN ('hot_score', 'is_hot', 'trending_rank');
-- 결과: 3개 컬럼
```

## 롤백 방법
문제 발생 시 `supabase/EXECUTE_P2_MIGRATIONS.md` 파일의 "롤백 방법" 섹션 참조

## 예상 소요 시간
30분 (수동 실행)

## 완료 조건
- [ ] 마이그레이션 파일 실행 (에러 없이)
- [ ] 4개 테이블 생성 확인
- [ ] 7개 뷰 생성 확인
- [ ] 3개 함수 생성 확인
- [ ] 샘플 데이터 삽입 확인
- [ ] Frontend에서 데이터 로딩 확인

## 상태
⏳ 대기 (사용자 수동 실행 필요)
