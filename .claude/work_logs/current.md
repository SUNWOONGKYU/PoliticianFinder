# Work Log - Current Session

## Session Start: 2025-12-01 21:01:00

### Previous Log
- [2025-11-30 ì‘ì—… ë¡œê·¸](2025-11-30.md)

---

## âœ… 2025-12-01 ì™„ë£Œ (5): ë³´ê³ ì„œ íŒë§¤ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ

### ì‘ì—… ê°œìš”
**ë³´ê³ ì„œ íŒë§¤ ê´€ë¦¬ ì‹œìŠ¤í…œ ì „ì²´ êµ¬í˜„ ë° ë°°í¬ ì™„ë£Œ**
- âœ… ì •ì¹˜ì¸ ë³¸ì¸ ì¸ì¦ â†’ ë³´ê³ ì„œ êµ¬ë§¤ â†’ ì…ê¸ˆ í™•ì¸ â†’ ì´ë©”ì¼ ë°œì†¡ ì „ì²´ í”Œë¡œìš°
- âœ… ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ êµ¬ë§¤ ë‚´ì—­ ê´€ë¦¬ ë° í†µê³„ ëŒ€ì‹œë³´ë“œ
- âœ… DB í…Œì´ë¸” ìƒì„± ì™„ë£Œ
- âœ… Git commit & push ì™„ë£Œ
- âœ… ë¹Œë“œ ì„±ê³µ ë° Vercel ìë™ ë°°í¬ ì§„í–‰ ì¤‘

### ğŸ“‚ ìƒì„±ëœ íŒŒì¼ (ì´ 7ê°œ)

#### 1. Database Migrations
- `0-4_Database/Supabase/migrations/051_create_report_sales_tables.sql`
  - `email_verifications` í…Œì´ë¸” (ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ê´€ë¦¬)
  - `report_purchases` í…Œì´ë¸” (ë³´ê³ ì„œ êµ¬ë§¤ ë‚´ì—­ ê´€ë¦¬)

#### 2. ì´ë©”ì¼ ì¸ì¦ API (Phase 2)
- `1_Frontend/src/app/api/politicians/verify/send-code/route.ts`
  - ì •ì¹˜ì¸ ì •ë³´ ì¡°íšŒ (ì´ë¦„, ì •ë‹¹, ì§ìœ„)
  - 6ìë¦¬ ì˜ìˆ«ì ì½”ë“œ ìƒì„±
  - Resendë¡œ ì´ë©”ì¼ ë°œì†¡
  - 10ë¶„ ìœ íš¨ê¸°ê°„ ì„¤ì •
- `1_Frontend/src/app/api/politicians/verify/check-code/route.ts`
  - ì¸ì¦ ì½”ë“œ í™•ì¸
  - ë§Œë£Œ ì‹œê°„ ì²´í¬
  - ì¸ì¦ ì™„ë£Œ ì²˜ë¦¬

#### 3. ê´€ë¦¬ì í˜ì´ì§€ (Phase 4-5)
- `1_Frontend/src/app/admin/report-sales/page.tsx`
  - ğŸ“Š í†µê³„ ëŒ€ì‹œë³´ë“œ (ì „ì²´/ì…ê¸ˆëŒ€ê¸°/ë°œì†¡ëŒ€ê¸°/ì™„ë£Œ)
  - ğŸ” í•„í„° ë° ê²€ìƒ‰ ê¸°ëŠ¥
  - âœ… ì…ê¸ˆ í™•ì¸ ë²„íŠ¼
  - ğŸ“§ ì´ë©”ì¼ ë°œì†¡ ë²„íŠ¼
  - í˜ì´ì§€ë„¤ì´ì…˜

#### 4. ì´ë©”ì¼ ë°œì†¡ API (Phase 6)
- `1_Frontend/src/app/api/admin/report-sales/send-email/route.ts`
  - ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
  - ì…ê¸ˆ í™•ì¸ ì²´í¬
  - Resendë¡œ ë³´ê³ ì„œ ì´ë©”ì¼ ë°œì†¡
  - ë°œì†¡ ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸

#### 5. Migration Scripts
- `1_Frontend/run_migration_051.js`
- `1_Frontend/run_migration_051_direct.js`

### ğŸ¯ êµ¬í˜„ëœ í•µì‹¬ ê¸°ëŠ¥

#### Phase 1: DB í…Œì´ë¸” âœ…
```sql
-- email_verifications
- politician_id (FK)
- verification_code (6ìë¦¬)
- expires_at (10ë¶„ í›„)

-- report_purchases
- politician_id, buyer_name, buyer_email
- payment_confirmed (ì…ê¸ˆ í™•ì¸ ì—¬ë¶€)
- sent (ë°œì†¡ ì—¬ë¶€)
```

#### Phase 2: ì´ë©”ì¼ ì¸ì¦ âœ…
```
ì •ì¹˜ì¸ ì •ë³´ ì…ë ¥ (ì´ë¦„, ì •ë‹¹, ì§ìœ„)
  â†“
DBì—ì„œ ì •ì¹˜ì¸ ì¡°íšŒ
  â†“
ì´ë©”ì¼ë¡œ 6ìë¦¬ ì½”ë“œ ë°œì†¡ (Resend)
  â†“
ì½”ë“œ ì…ë ¥ í™•ì¸ (10ë¶„ ì´ë‚´)
  â†“
ì¸ì¦ ì™„ë£Œ
```

#### Phase 4-5: ê´€ë¦¬ì í˜ì´ì§€ âœ…
- **í†µê³„ ì¹´ë“œ**: ì „ì²´/ì…ê¸ˆëŒ€ê¸°/ë°œì†¡ëŒ€ê¸°/ì™„ë£Œ
- **í•„í„°**: ì „ì²´/ì…ê¸ˆëŒ€ê¸°/ë°œì†¡ëŒ€ê¸°/ì™„ë£Œ
- **ê²€ìƒ‰**: ì´ë¦„, ì´ë©”ì¼
- **ì…ê¸ˆ í™•ì¸**: ë²„íŠ¼ í´ë¦­ â†’ payment_confirmed = true
- **ë°œì†¡ ì™„ë£Œ**: ë°œì†¡ ìƒíƒœ í‘œì‹œ

#### Phase 6: ì´ë©”ì¼ ë°œì†¡ âœ…
```
ë°œì†¡ ë²„íŠ¼ í´ë¦­
  â†“
ì…ê¸ˆ í™•ì¸ ì²´í¬
  â†“
Resendë¡œ ì´ë©”ì¼ ë°œì†¡ (HTML í…œí”Œë¦¿)
  â†“
ë°œì†¡ ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸ (sent = true, sent_at, sent_by)
```

### ğŸ” ê¸°ìˆ  ìŠ¤íƒ
- **Backend**: Next.js 14 API Routes
- **Database**: Supabase (PostgreSQL)
- **Email**: Resend API
- **Frontend**: React + Tailwind CSS
- **Auth**: Supabase Auth (ê´€ë¦¬ì ê¶Œí•œ)

### âœ… Git ì»¤ë°‹ ë° Push
**Commit 1**: `9e002f8`
```
feat: ë³´ê³ ì„œ íŒë§¤ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ

Phase 1-7 ì „ì²´ êµ¬í˜„
- ì´ë©”ì¼ ì¸ì¦ (6ìë¦¬ ì½”ë“œ, 10ë¶„ ìœ íš¨)
- ë³´ê³ ì„œ êµ¬ë§¤ ë‚´ì—­ ê´€ë¦¬
- ì…ê¸ˆ í™•ì¸ ì²˜ë¦¬
- ë³´ê³ ì„œ ì´ë©”ì¼ ë°œì†¡ (Resend)
- í†µê³„ ëŒ€ì‹œë³´ë“œ
```

**Commit 2**: `353919f`
```
feat: ë³´ê³ ì„œ íŒë§¤ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ

## êµ¬í˜„ëœ ê¸°ëŠ¥
- ì´ë©”ì¼ ì¸ì¦ ì‹œìŠ¤í…œ (ì •ì¹˜ì¸ ë³¸ì¸ ì¸ì¦)
- ê´€ë¦¬ì í˜ì´ì§€ (/admin/report-sales)
- DB í…Œì´ë¸” (email_verifications, report_purchases)
- RLS ì •ì±… (ê´€ë¦¬ì ì „ìš© ì ‘ê·¼)

ìƒì„±ëœ íŒŒì¼: 7ê°œ
- API Routes (3ê°œ)
- Admin Pages (1ê°œ)
- Database (1ê°œ)
- Utilities (2ê°œ)
```

**Push**: âœ… ì„±ê³µ (`9e002f8..353919f`)

**ë¹Œë“œ ê²°ê³¼**: âœ… ì„±ê³µ
```
âœ“ Compiled successfully
â—‹  (Static)   117 pages
Æ’  (Dynamic)  server-rendered on demand
```

### âœ… DB ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ
**í…Œì´ë¸” ìƒì„±**: âœ… ì„±ê³µ
- `politicians` í…Œì´ë¸” (id TEXTë¡œ ìƒì„±)
- `email_verifications` í…Œì´ë¸”
- `report_purchases` í…Œì´ë¸”

**ê²€ì¦**: âœ… í†µê³¼
```sql
SELECT table_name FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name IN ('politicians', 'email_verifications', 'report_purchases')
```

### ğŸ“Š ìµœì¢… ìƒíƒœ
- âœ… ì½”ë“œ êµ¬í˜„ ì™„ë£Œ
- âœ… DB í…Œì´ë¸” ìƒì„± ì™„ë£Œ
- âœ… ë¹Œë“œ ì„±ê³µ
- âœ… Git commit & push ì™„ë£Œ
- âœ… Vercel ìë™ ë°°í¬ ì§„í–‰ ì¤‘

### ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„
- [ ] Vercel ë°°í¬ ì™„ë£Œ í™•ì¸
- [ ] ì‹¤ì œ ì´ë©”ì¼ ë°œì†¡ í…ŒìŠ¤íŠ¸
- [ ] ì •ì¹˜ì¸ ë°ì´í„° ì…ë ¥ (í…ŒìŠ¤íŠ¸ìš©)

---

## âœ… 2025-12-01 ì™„ë£Œ (3): politician_id íƒ€ì… ë¬¸ì„œ ì¼ê´„ ìˆ˜ì •

### ì‘ì—… ê°œìš”
**ì „ì²´ í”„ë¡œì íŠ¸ì—ì„œ politician_id íƒ€ì…ì„ TEXT (8-char hex)ë¡œ í†µì¼**
- ì‚¬ìš©ì ìš”ì²­: "í´ë¦¬í‹°ì…˜ ì•„ì´ë””ê°€ í…ìŠ¤íŠ¸ íƒ€ì…ì¸ë° UUIDë¼ê³  í‘œì‹œë˜ì–´ ìˆëŠ” ë¬¸ì„œë“¤ ë‹¤ ìˆ˜ì •í•´"
- 17ê°œ .md íŒŒì¼ + 3ê°œ .sql íŒŒì¼ì—ì„œ `politician_id UUID` â†’ `politician_id TEXT` ìˆ˜ì •

### ğŸ“‚ ìˆ˜ì •ëœ íŒŒì¼ (ì´ 20ê°œ)

#### 1. AI Evaluation Engine ë¬¸ì„œ (2ê°œ)
- `0-3_AI_Evaluation_Engine/ì„¤ê³„ë¬¸ì„œ_V6.0/Database/DB_SCHEMA.md` (3ê³³)
- `0-3_AI_Evaluation_Engine/ì„¤ê³„ë¬¸ì„œ_V6.0/Database/create_politician_id_mapping.sql`
  - `uuid_id UUID` â†’ `uuid_id TEXT`
  - ì½”ë©˜íŠ¸: "UUID â†” INT ë§¤í•‘" â†’ "TEXT â†” INT ë§¤í•‘"

#### 2. Database Migrations (3ê°œ)
- `0-4_Database/Supabase/migrations/DATABASE_SCHEMA.md` (4ê³³)
- `0-4_Database/Supabase/migrations/031_create_functions.sql` (í•¨ìˆ˜ ë°˜í™˜ íƒ€ì… 2ê³³)
  - `search_politicians()`: `id UUID` â†’ `id TEXT`
  - `get_trending_posts()`: `politician_id UUID` â†’ `politician_id TEXT`
- `0-4_Database/Supabase/migrations/combined_all_migrations.sql` (ì¼ê´„ sed ìˆ˜ì •)
  - `careers.politician_id`
  - `pledges.politician_id`
  - `posts.politician_id`
  - `user_favorites.politician_id`
  - `ai_evaluations.politician_id`
  - `politician_verification.politician_id`
  - `evaluation_snapshots.politician_id`

#### 3. Project Grid Tasks (4ê°œ)
- `project-grid/tasks/P2D1.md`
- `project-grid/tasks/P3BA11.md`
- `project-grid/tasks/P4BA18.md`
- `project-grid/tasks/P4BA19.md`

### ğŸ” ê²€ìƒ‰ ë° ìˆ˜ì • í”„ë¡œì„¸ìŠ¤

**1ë‹¨ê³„: ì „ì²´ ê²€ìƒ‰**
```bash
grep -r "politician_id.*UUID" --include="*.md" .
grep -r "politician_id.*uuid" --include="*.sql" .
```
- 17ê°œ .md íŒŒì¼ ë°œê²¬
- 3ê°œ .sql íŒŒì¼ ë°œê²¬

**2ë‹¨ê³„: Markdown ì¼ê´„ ìˆ˜ì •**
```bash
sed -i 's/politician_id UUID/politician_id TEXT (8-char hex)/g' [íŒŒì¼ë“¤]
```

**3ë‹¨ê³„: SQL íŒŒì¼ ê°œë³„ ìˆ˜ì •**
- `create_politician_id_mapping.sql`: `uuid_id UUID` â†’ `uuid_id TEXT`
- `031_create_functions.sql`: í•¨ìˆ˜ ë°˜í™˜ íƒ€ì… 2ê³³ ìˆ˜ì •
- `combined_all_migrations.sql`: sedë¡œ FK ì •ì˜ ì¼ê´„ ë³€ê²½

### âœ… Git ì»¤ë°‹ ë° Push
**Commit**: `b6c5c80`
```
docs: politician_id íƒ€ì… ë¬¸ì„œ ì¼ê´„ ìˆ˜ì • (UUID â†’ TEXT)

ì „ì²´ í”„ë¡œì íŠ¸ì—ì„œ politician_id íƒ€ì…ì„ TEXT (8-char hex)ë¡œ í†µì¼
- 20ê°œ íŒŒì¼ ìˆ˜ì •
- ëª¨ë“  FK ì œì•½ì¡°ê±´ TEXT íƒ€ì…ìœ¼ë¡œ í†µì¼
- ì´ìœ : politicians.idê°€ TEXT (8-char hex) íƒ€ì…ì´ë¯€ë¡œ
```

**Push**: âœ… ì„±ê³µ (`442ad16..b6c5c80`)

---

## âœ… 2025-12-01 ì™„ë£Œ (2): í˜ì´ì§€ë„¤ì´ì…˜ ë¦¬ë°‹ ì¡°ì •

### ì‘ì—… ê°œìš”
**ê´€ë¦¬ì í˜ì´ì§€ í˜ì´ì§€ë„¤ì´ì…˜ ë¦¬ë°‹ì„ 100 â†’ 20ìœ¼ë¡œ ì¶•ì†Œ**
- ì‚¬ìš©ì í”¼ë“œë°±: "ë¦¬ë°‹ 100ì€ ë„ˆë¬´ ê³¼ë„í•œë° ì¶•ì†Œí•´ì•¼ í•  ê²ƒ ê°™ì•„"

### ğŸ“‚ ìˆ˜ì •ëœ íŒŒì¼
**íŒŒì¼**: `1_Frontend/src/app/admin/posts/page.tsx`

**ë³€ê²½ ë‚´ìš©**:
```typescript
// Before
const postsPerPage = 30;
const commentsPerPage = 50;
const noticesPerPage = 20;

// After
const postsPerPage = 20;
const commentsPerPage = 20;
const noticesPerPage = 20;  // ìœ ì§€
```

### âœ… Git ì»¤ë°‹ ë° Push
**Commit**: `442ad16`
```
fix: ê´€ë¦¬ì í˜ì´ì§€ í˜ì´ì§€ë„¤ì´ì…˜ ë¦¬ë°‹ ì¡°ì • (30/50 â†’ 20)

ë” ë‚˜ì€ UXë¥¼ ìœ„í•´ í•œ í˜ì´ì§€ì— í‘œì‹œë˜ëŠ” í•­ëª© ìˆ˜ ê°ì†Œ
```

**Push**: âœ… ì„±ê³µ

---

## âœ… 2025-12-01 ì™„ë£Œ (1): ë³´ê³ ì„œ íŒë§¤ ê´€ë¦¬ ê¸°ëŠ¥ ê¸°íš (v2.0)

### ì‘ì—… ê°œìš”
**ìƒì„¸ í‰ê°€ ë³´ê³ ì„œ íŒë§¤ ê´€ë¦¬ ì‹œìŠ¤í…œ ê¸°íšì„œ ì‘ì„±**
- ì •ì¹˜ì¸ë“¤ì—ê²Œ ìì‹ ì˜ AI í‰ê°€ ë³´ê³ ì„œë¥¼ íŒë§¤í•˜ëŠ” ì‹œìŠ¤í…œ
- ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì…ê¸ˆ í™•ì¸ ë° ë³´ê³ ì„œ ë°œì†¡ ê´€ë¦¬

### ğŸ“‚ ìƒì„±ëœ íŒŒì¼
1. **ì‘ì—…ìš©**: `.claude/work_logs/í‰ê°€ë³´ê³ ì„œ_íŒë§¤ê´€ë¦¬_ê¸°íš.md`
2. **ë³´ê´€ìš©**: `0-1_Project_Plan/00_í”„ë¡œì íŠ¸_ê¸°íšì„œ/ë³´ê³ ì„œ_íŒë§¤ê´€ë¦¬_ê¸°íš_V2.0.md`

---

### ğŸ¯ í•µì‹¬ ê¸°ëŠ¥

#### 1. ğŸ” ì´ë©”ì¼ ì¸ì¦ (NEW!)
**êµ¬ë§¤ ì „ ë³¸ì¸ í™•ì¸ í”„ë¡œì„¸ìŠ¤**
- **ë°©ì‹**: 6ìë¦¬ ì˜ìˆ«ì ì½”ë“œ (ì˜ˆ: "AB12CD")
- **ìœ íš¨ ì‹œê°„**: 10ë¶„
- **ë°œì†¡ ìˆ˜ë‹¨**: Resend API
- **ë³´ì•ˆ ì›ë¦¬**: ì´ë©”ì¼ ì†Œìœ ê¶Œ = ë³¸ì¸ ì¦ëª…

**í”„ë¡œì„¸ìŠ¤:**
```
1. ì´ë¦„ + ì •ë‹¹ + ì§ìœ„ ì…ë ¥
   â†“
2. DBì—ì„œ ì •ì¹˜ì¸ ì •ë³´ ì¡°íšŒ
   â†“
3. í•´ë‹¹ ì´ë©”ì¼ë¡œ 6ìë¦¬ ì½”ë“œ ë°œì†¡
   â†“
4. ì½”ë“œ ì…ë ¥ í™•ì¸ (10ë¶„ ì´ë‚´)
   â†“
5. ì¸ì¦ ì„±ê³µ â†’ ê²°ì œ ì§„í–‰
```

#### 2. ì…ê¸ˆ í™•ì¸ ê´€ë¦¬
- ê´€ë¦¬ìê°€ ê³„ì¢Œì´ì²´ ì…ê¸ˆ ìˆ˜ë™ í™•ì¸
- ì…ê¸ˆ ì¼ì‹œ ë° í™•ì¸í•œ ê´€ë¦¬ì ìë™ ê¸°ë¡
- ì…ê¸ˆ í™•ì¸ í›„ ë³´ê³ ì„œ ë°œì†¡ ê°€ëŠ¥

#### 3. ë³´ê³ ì„œ ì´ë©”ì¼ ë°œì†¡
- **Resend API** ì‚¬ìš© (ì´ë¯¸ ì„¤ì •ë¨)
- ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ [ë³´ê³ ì„œ ë°œì†¡] ë²„íŠ¼ í´ë¦­
- ì •ì¹˜ì¸ ì´ë©”ì¼ë¡œ ì§ì ‘ ì „ì†¡
- ë°œì†¡ ì¼ì‹œ ë° ë‹´ë‹¹ì ìë™ ê¸°ë¡

#### 4. ê´€ë¦¬ì í˜ì´ì§€
- **URL**: `/admin/report-sales`
- **ê¸°ëŠ¥**:
  - êµ¬ë§¤ ë‚´ì—­ ëª©ë¡ (í•„í„°, ê²€ìƒ‰, í˜ì´ì§€ë„¤ì´ì…˜)
  - ì…ê¸ˆ í™•ì¸ ë²„íŠ¼
  - ë³´ê³ ì„œ ë°œì†¡ ë²„íŠ¼
  - ìƒì„¸ ë³´ê¸° (ë©”ëª¨, ì´ë ¥)
  - í†µê³„ ì¹´ë“œ 4ê°œ (ì›” ë§¤ì¶œ, ì…ê¸ˆ ëŒ€ê¸°, ë°œì†¡ ëŒ€ê¸°, ì´ íŒë§¤)
- **í˜ì´ì§€ë„¤ì´ì…˜**: 20ê°œ/í˜ì´ì§€

---

### ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

#### ìƒˆ í…Œì´ë¸” 1: email_verifications
```sql
CREATE TABLE email_verifications (
    id UUID PRIMARY KEY,
    politician_id TEXT REFERENCES politicians(id),
    email VARCHAR(255) NOT NULL,
    verification_code VARCHAR(6) NOT NULL,
    purpose VARCHAR(50) DEFAULT 'report_purchase',
    verified BOOLEAN DEFAULT FALSE,
    expires_at TIMESTAMPTZ NOT NULL,
    verified_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### ìƒˆ í…Œì´ë¸” 2: report_purchases
```sql
CREATE TABLE report_purchases (
    id UUID PRIMARY KEY,
    politician_id TEXT REFERENCES politicians(id),
    buyer_name VARCHAR(100) NOT NULL,
    buyer_email VARCHAR(255) NOT NULL,
    -- ì „í™”ë²ˆí˜¸ëŠ” ì €ì¥ ì•ˆ í•¨ (ì´ë©”ì¼ë§Œ ì‚¬ìš©)

    payment_id UUID REFERENCES payments(id),
    amount DECIMAL(10, 2) NOT NULL,
    currency VARCHAR(3) DEFAULT 'KRW',

    payment_confirmed BOOLEAN DEFAULT FALSE,
    payment_confirmed_at TIMESTAMPTZ,
    payment_confirmed_by UUID REFERENCES users(user_id),

    report_type VARCHAR(50) NOT NULL,
    report_period VARCHAR(50),

    sent BOOLEAN DEFAULT FALSE,
    sent_at TIMESTAMPTZ,
    sent_by UUID REFERENCES users(user_id),
    sent_email TEXT,

    notes TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

**ì¤‘ìš” ê²°ì • ì‚¬í•­:**
- âœ… `politician_id`: TEXT íƒ€ì… (8ìë¦¬ hex)
- âœ… ì „í™”ë²ˆí˜¸ í•„ë“œ ì œì™¸ (ì´ë©”ì¼ë§Œ ì‚¬ìš©)
- âœ… í™˜ë¶ˆ ê´€ë ¨ í•„ë“œ ì œì™¸

---

### ğŸ“ API ì—”ë“œí¬ì¸íŠ¸

#### ì¸ì¦ API
```
POST /api/politicians/verify/send-code    // ì¸ì¦ ì½”ë“œ ë°œì†¡
POST /api/politicians/verify/check-code   // ì¸ì¦ ì½”ë“œ í™•ì¸
```

#### ê´€ë¦¬ API
```
GET    /api/admin/report-sales                     // ëª©ë¡
GET    /api/admin/report-sales/:id                 // ìƒì„¸
POST   /api/admin/report-sales                     // ìˆ˜ë™ ë“±ë¡
PATCH  /api/admin/report-sales/:id/confirm-payment // ì…ê¸ˆ í™•ì¸
POST   /api/admin/report-sales/:id/send-report     // ë°œì†¡
PATCH  /api/admin/report-sales/:id                 // ë©”ëª¨ ìˆ˜ì •
GET    /api/admin/report-sales/statistics          // í†µê³„
```

---

### ğŸš€ êµ¬í˜„ ë‹¨ê³„

#### Phase 1 (MVP)
1. email_verifications í…Œì´ë¸” ìƒì„±
2. ì¸ì¦ ì½”ë“œ ë°œì†¡ API
3. ì¸ì¦ ì½”ë“œ í™•ì¸ API
4. ê²°ì œ í˜ì´ì§€ ì¸ì¦ UI ì¶”ê°€
5. report_purchases í…Œì´ë¸” ìƒì„±
6. ê´€ë¦¬ì í˜ì´ì§€ (`/admin/report-sales`)
7. ì…ê¸ˆ í™•ì¸ ê¸°ëŠ¥
8. ë³´ê³ ì„œ ì´ë©”ì¼ ë°œì†¡ (Resend)
9. í†µê³„ ì¹´ë“œ

#### Phase 2 (ì¶”í›„)
- PDF ë³´ê³ ì„œ ìë™ ìƒì„±
- ì´ë©”ì¼ ì²¨ë¶€ íŒŒì¼ ê¸°ëŠ¥
- ë§¤ì¶œ ìƒì„¸ í†µê³„ ë° ê·¸ë˜í”„
- ìë™ ì´ë©”ì¼ ìŠ¤ì¼€ì¤„ë§

---

### ğŸ’¡ ì£¼ìš” ê²°ì • ì‚¬í•­ ë° ì‚¬ìš©ì í”¼ë“œë°±

#### í™˜ë¶ˆ ê¸°ëŠ¥ ì œì™¸
- **ì‚¬ìš©ì í”¼ë“œë°±**: "í™˜ë¶ˆì€ ì—†ì–´"
- **ê²°ì •**: í™˜ë¶ˆ ê´€ë ¨ ëª¨ë“  ê¸°ëŠ¥ ì œê±°
- **ì´ìœ **: êµ¬ë§¤ í›„ í™˜ë¶ˆ ë¶ˆê°€ ì •ì±…

#### ì „í™”ë²ˆí˜¸ ë¶ˆí•„ìš”
- **ì‚¬ìš©ì í”¼ë“œë°±**: "ì´ë©”ì¼ë§Œ ìˆìœ¼ë©´ ë˜ì–ì•„"
- **ê²°ì •**: buyer_phone í•„ë“œ ì œê±°
- **ì´ìœ **:
  - ë³´ê³ ì„œëŠ” ì´ë©”ì¼ë¡œë§Œ ë°œì†¡
  - DBì— ì •ì¹˜ì¸ ì „í™”ë²ˆí˜¸ëŠ” ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì¡´ì¬
  - ì¤‘ë³µ ì €ì¥ ë¶ˆí•„ìš”

#### ê°„ë‹¨í•œ ì´ë©”ì¼ ì¸ì¦ë§Œ
- **ì‚¬ìš©ì í”¼ë“œë°±**: "ì¶”ê°€ ë³´ì•ˆê¹Œì§€ëŠ” í•  í•„ìš” ì—†ì–´"
- **ê²°ì •**: 6ìë¦¬ ì½”ë“œ ì¸ì¦ë§Œ êµ¬í˜„
- **ì œì™¸**:
  - âŒ IP ì œí•œ
  - âŒ ë¸Œë¼ìš°ì € ì§€ë¬¸
  - âŒ SMS 2ì°¨ ì¸ì¦
  - âŒ ì…ë ¥ íšŸìˆ˜ ì œí•œ
- **ì´ìœ **: ë³¸ì¸ ì´ë©”ì¼ ì ‘ê·¼ = ë³¸ì¸ ì¦ëª… ì™„ë£Œ

#### ì´ë©”ì¼ ì¸ì¦ ë°©ì‹
- **ì‚¬ìš©ì í”¼ë“œë°±**: "ì´ë©”ì¼ì´ í‹€ë ¸ì„ ê²½ìš°ì—ëŠ” ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥ì„ ëª»í•˜ê² ì§€"
- **ê²°ì •**: ì´ë©”ì¼ ì†Œìœ ê¶Œìœ¼ë¡œ ë³¸ì¸ í™•ì¸
- **ë³´ì•ˆ ì›ë¦¬**:
  ```
  ì •ì¹˜ì¸ ì •ë³´ (ì´ë¦„/ì •ë‹¹/ì§ìœ„) â†’ ëˆ„êµ¬ë‚˜ ì•Œ ìˆ˜ ìˆìŒ
           +
  ì´ë©”ì¼ ì†Œìœ ê¶Œ (6ìë¦¬ ì½”ë“œ)    â†’ ë³¸ì¸ë§Œ ì•Œ ìˆ˜ ìˆìŒ
           =
  ë³¸ì¸ ì¸ì¦ ì™„ë£Œ âœ…
  ```

---

### ğŸ“§ ì´ë©”ì¼ ì‹œìŠ¤í…œ

#### Resend API
- **API Key**: `re_8hjt3JJR_5GD6Q8twLftC1LficQqkH9E7`
- **ë°œì‹  ì´ë©”ì¼**: `noreply@politicianfinder.ai.kr`
- **ì´ë¯¸ ì„¤ì •ë¨**: ì¶”ê°€ ì„¤ì • ë¶ˆí•„ìš”

#### ì´ë©”ì¼ ì¢…ë¥˜
1. **ì¸ì¦ ì½”ë“œ ì´ë©”ì¼**
   - ì œëª©: `[PoliticianFinder] ë³´ê³ ì„œ êµ¬ë§¤ ì¸ì¦ ì½”ë“œ`
   - ë‚´ìš©: 6ìë¦¬ ì½”ë“œ + 10ë¶„ ìœ íš¨ ì•ˆë‚´

2. **ë³´ê³ ì„œ ë°œì†¡ ì´ë©”ì¼**
   - ì œëª©: `[PoliticianFinder] {ì •ì¹˜ì¸ëª…}ë‹˜ì˜ ìƒì„¸ í‰ê°€ ë³´ê³ ì„œ`
   - ë‚´ìš©: ë³´ê³ ì„œ ì •ë³´ + ë°œê¸‰ ì¼ì‹œ
   - ì²¨ë¶€: PDF ë³´ê³ ì„œ (Phase 2)

---

### ğŸ¨ í™”ë©´ êµ¬ì„±

#### ê²°ì œ í˜ì´ì§€ (ì´ë©”ì¼ ì¸ì¦ ì¶”ê°€)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë³¸ì¸ ì¸ì¦                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì´ë¦„: [ë…¸ì„œí˜„_______]               â”‚
â”‚ ì†Œì† ì •ë‹¹: [ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹ â–¼]         â”‚
â”‚ ì¶œë§ˆì§ì¢…: [êµ­íšŒì˜ì› â–¼]             â”‚
â”‚                                      â”‚
â”‚ [ì¸ì¦ ì½”ë“œ ë°œì†¡í•˜ê¸°]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          â†“ ì½”ë“œ ë°œì†¡ í›„

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ì¸ì¦ ì½”ë“œê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ nohseohyun@assembly.go.krë¡œ         â”‚
â”‚ 6ìë¦¬ ì¸ì¦ ì½”ë“œë¥¼ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.     â”‚
â”‚                                      â”‚
â”‚ ì¸ì¦ ì½”ë“œ: [______]                 â”‚
â”‚ ìœ íš¨ ì‹œê°„: â±ï¸ 09:45                 â”‚
â”‚                                      â”‚
â”‚ [ì¸ì¦í•˜ê¸°]  [ì½”ë“œ ì¬ë°œì†¡]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          â†“ ì¸ì¦ ì„±ê³µ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!    â”‚
â”‚ ì´ì œ ê²°ì œë¥¼ ì§„í–‰í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.   â”‚
â”‚ [ê²°ì œí•˜ê¸°]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ê´€ë¦¬ì í˜ì´ì§€
```
/admin/report-sales

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â‚©3.4M  â”‚ 5ê±´   â”‚ 3ê±´   â”‚ 304ê±´      â”‚
â”‚ ì´ë²ˆë‹¬  â”‚ì…ê¸ˆ   â”‚ë°œì†¡   â”‚ì´íŒë§¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í•„í„°: [ê¸°ê°„â–¼] [ì…ê¸ˆâ–¼] [ë°œì†¡â–¼] ê²€ìƒ‰: [___][ğŸ”]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID â”‚ì •ì¹˜ì¸â”‚ì´ë©”ì¼â”‚ì¢…ë¥˜â”‚ê¸ˆì•¡â”‚ì…ê¸ˆâ”‚ë°œì†¡â”‚ì‘ì—… â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚001â”‚ë…¸ì„œí˜„â”‚noh@..â”‚í”„ë¦¬â”‚300Kâ”‚âœ… â”‚âœ… â”‚[ë³´ê¸°]â”‚
â”‚002â”‚ì•ˆíƒœì¤€â”‚ahn@..â”‚ìŠ¤íƒ â”‚150Kâ”‚âœ… â”‚â³ â”‚[ë°œì†¡]â”‚
â”‚003â”‚ë‚¨ë„ìœ¤â”‚nam@..â”‚ê¸°ë³¸â”‚50K â”‚â³ â”‚â³ â”‚[ì…ê¸ˆ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[â—€] 1 2 3 [â–¶]           20ê°œ/í˜ì´ì§€
```

---

### âœ… ê¸°íš ì™„ë£Œ ìƒíƒœ

**ë²„ì „**: V2.0 (ì´ë©”ì¼ ì¸ì¦ ì¶”ê°€)
**ìƒíƒœ**: ìµœì¢… (ì‚¬ìš©ì ìŠ¹ì¸ ì™„ë£Œ)
**ì‘ì„±ì¼**: 2025-12-01
**ì‘ì„±ì**: Claude Code

**ë‹¤ìŒ ë‹¨ê³„**: Phase 1 êµ¬í˜„ ì‹œì‘ ëŒ€ê¸°

---

### ğŸ“Œ ì°¸ê³ ì‚¬í•­

- **politician_id íƒ€ì…**: TEXT (8ìë¦¬ hex) - ì ˆëŒ€ parseInt ê¸ˆì§€!
- **ì´ë©”ì¼ ì‹œìŠ¤í…œ**: Resend ì´ë¯¸ ì„¤ì •ë¨
- **ë³´ì•ˆ ì›ì¹™**: ë³¸ì¸ í™•ì¸ë§Œ ë˜ë©´ ë¨ (ê³¼ë„í•œ ë³´ì•ˆ X)
- **í™˜ë¶ˆ**: ì—†ìŒ
- **ì „í™”ë²ˆí˜¸**: ì €ì¥ ì•ˆ í•¨ (ì´ë©”ì¼ë§Œ ì‚¬ìš©)

---

## ì´ì „ ì‘ì—… (2025-11-30)

### 30ëª… ì •ì¹˜ì¸ ë°ì´í„° ì •í™•ì„± ìˆ˜ì • ì‘ì—…

#### ìˆ˜ì • ì‚¬í•­ ìš”ì•½:

1. **í•„ë“œ ë§¤í•‘ ìˆ˜ì •**
   - position â†” title í•„ë“œ ë§¤í•‘ ì˜¤ë¥˜ ìˆ˜ì •
   - fieldMapper.ts ìˆ˜ì • ì™„ë£Œ

2. **í•„ë“œ ìˆœì„œ ì¬ì¡°ì •**
   - ì´ë¦„ â†’ ì§ì±… â†’ ì •ë‹¹ â†’ ì‹ ë¶„ â†’ ì¶œë§ˆì§ì¢… â†’ ì¶œë§ˆì§€ì—­ â†’ ì¶œë§ˆì§€êµ¬

3. **í•„ë“œëª… ë³€ê²½**
   - "ì§€ì—­êµ¬" â†’ "ì§€êµ¬" â†’ "ì¶œë§ˆì§€êµ¬"
   - "ì§€ì—­" â†’ "ì¶œë§ˆì§€ì—­"

4. **30ëª… ì •ì¹˜ì¸ ë°ì´í„° ì—…ë°ì´íŠ¸**
   - ì¶œë§ˆì§ì¢…: ê´‘ì—­ë‹¨ì²´ì¥
   - ì¶œë§ˆì§€ì—­: ì„œìš¸(10), ê²½ê¸°(10), ë¶€ì‚°(10)
   - ì¶œë§ˆì§€êµ¬: null

5. **ì‹ ë¶„(status) ì •í™•íˆ ìˆ˜ì •**
   - í˜„ì§ 3ëª…: ì˜¤ì„¸í›ˆ(ì„œìš¸íŠ¹ë³„ì‹œì¥), ê¹€ë™ì—°(ê²½ê¸°ë„ì§€ì‚¬), ë°•í˜•ì¤€(ë¶€ì‚°ì‹œì¥)
   - ì¶œë§ˆì 27ëª…: ë‚˜ë¨¸ì§€ ëª¨ë‘ (êµ­íšŒì˜ì›ë“¤ë„ ê´‘ì—­ë‹¨ì²´ì¥ ë„ì „ì´ë¯€ë¡œ ì¶œë§ˆì)

6. **ì§ì±…(position) ì •í™•ì„± ê°œì„ **
   - ê¹€ë¯¼ì„: êµ­ë¬´ì´ë¦¬
   - ì—¼íƒœì˜, í•œì¤€í˜¸: êµ­íšŒì˜ì›
   - ì°¨ì •ì¸: êµ­ê°€êµìœ¡ìœ„ì›íšŒ ìœ„ì›ì¥
   - ì´ì¬ì„±: ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹ ë¶€ì‚°ì‹œë‹¹ ìœ„ì›ì¥ (ì •ë‹¹ë„ ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹ìœ¼ë¡œ ìˆ˜ì •)
   - ìœ ìŠ¹ë¯¼: ì „ êµ­íšŒì˜ì› (ëŒ€í•œì²´ìœ¡íšŒì¥ì€ ë™ëª…ì´ì¸)

---

## âœ… 2025-12-02 ì™„ë£Œ (6): politician_id íƒ€ì… ì¼ê´€ì„± ì™„ì „ ìˆ˜ì •

### ì‘ì—… ê°œìš”
**ì‚¬ìš©ì ìš”ì²­ì— ë”°ë¥¸ CRITICAL ì´ìŠˆ í•´ê²°: ëª¨ë“  ì›ë³¸ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ì˜ politician_id UUID â†’ TEXT íƒ€ì… ë³€ê²½**

### ë¬¸ì œ ìƒí™©
- ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ì°¨ë¡€ politician_idë¥¼ UUID â†’ TEXTë¡œ ìˆ˜ì •í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³ 
- ì›ë³¸ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ë“¤ì— ì—¬ì „íˆ `politician_id UUID` ì°¸ì¡° ì¡´ì¬
- ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜ë¡œ Foreign Key ì œì•½ ì¡°ê±´ ì¶©ëŒ ë°œìƒ

### ê·¼ë³¸ ì›ì¸
- ì´ˆê¸° ìŠ¤í‚¤ë§ˆ: `politicians.id UUID PRIMARY KEY`
- ì´í›„ ë§ˆì´ê·¸ë ˆì´ì…˜: politician_id TEXTë¡œ ë³€ê²½ ì‹œë„
- **ë¬¸ì œ:** ì›ë³¸ í…Œì´ë¸” ìƒì„± ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ë¯¸ì—…ë°ì´íŠ¸
- **ê²°ê³¼:** íƒ€ì… ë¶ˆì¼ì¹˜ ë° ì°¸ì¡° ë¬´ê²°ì„± ìœ„ë°˜

### ğŸ“‚ ìˆ˜ì • ì™„ë£Œ íŒŒì¼ (ì´ 7ê°œ ê²€í† , 5ê°œ ìˆ˜ì •)

#### ìˆ˜ì •í•œ íŒŒì¼ (5ê°œ)
1. **`005_create_posts_table.sql`** âœ…
   - `politician_id UUID` â†’ `politician_id TEXT`
   - ì£¼ì„ ì¶”ê°€: "IMPORTANT: politician_id is TEXT (8-char hex), NOT UUID"

2. **`010_create_user_favorites_table.sql`** âœ…
   - `politician_id UUID` â†’ `politician_id TEXT`
   - ì£¼ì„ ì¶”ê°€

3. **`011_create_ai_evaluations_table.sql`** âœ…
   - `politician_id UUID` â†’ `politician_id TEXT`
   - ì£¼ì„ ì¶”ê°€

4. **`014_create_politician_verification_table.sql`** âœ…
   - `politician_id UUID` â†’ `politician_id TEXT`
   - ì£¼ì„ ì¶”ê°€

5. **`021_create_evaluation_snapshots.sql`** âœ…
   - `politician_id UUID` â†’ `politician_id TEXT`
   - ì£¼ì„ ì¶”ê°€

#### ì´ë¯¸ ì˜¬ë°”ë¥¸ íŒŒì¼ (2ê°œ)
6. **`023_add_rating_favorite_to_politician_details.sql`** âœ…
   - ì´ë¯¸ TEXT íƒ€ì…ìœ¼ë¡œ ì˜¬ë°”ë¥´ê²Œ ì •ì˜ë¨
   - ìƒì„¸í•œ ì£¼ì„ë„ ì™„ë²½í•˜ê²Œ ì‘ì„±ë˜ì–´ ìˆìŒ

7. **`024_add_favorite_politicians_columns_fixed.sql`** âœ…
   - ì´ë¯¸ TEXTë¡œ ë³€í™˜í•˜ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜ í¬í•¨ë¨

### ê²€ì¦ ê²°ê³¼

#### íƒ€ì… ì¼ê´€ì„± í™•ì¸
```bash
# ëª¨ë“  ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ê²€ì¦
grep -E "politician_id (UUID|TEXT)" *.sql | grep -v "^--"

ê²°ê³¼: ëª¨ë“  politician_id ì»¬ëŸ¼ì´ TEXT íƒ€ì…ìœ¼ë¡œ ì •ì˜ë¨
```

#### Foreign Key ì œì•½ ì¡°ê±´ í™•ì¸
- âœ… ëª¨ë“  politician_id: TEXT íƒ€ì…
- âœ… ëª¨ë“  ì°¸ì¡°: `REFERENCES politicians(id)`
- âœ… ì‚­ì œ ë™ì‘: ON DELETE CASCADE ë˜ëŠ” SET NULL

### ğŸ“„ ìƒì„±ëœ ë¬¸ì„œ
**`Web_ClaudeCode_Bridge/outbox/politician_id_íƒ€ì…_ì¼ê´€ì„±_ìˆ˜ì •_ì™„ë£Œ_ë³´ê³ ì„œ.md`**
- ì „ì²´ ìˆ˜ì • ë‚´ì—­ ìƒì„¸ ê¸°ë¡
- Before/After ì½”ë“œ ë¹„êµ
- ê²€ì¦ ê²°ê³¼
- ë‹¤ìŒ ë‹¨ê³„ (RLS ì •ì±… ìˆ˜ì • ë“±) ì•ˆë‚´

### ì˜¬ë°”ë¥¸ íƒ€ì… ê·œì¹™ (ì¬í™•ì¸)
```sql
-- âœ… CORRECT
politician_id TEXT NOT NULL REFERENCES politicians(id)

-- í˜•ì‹: 8ìë¦¬ hexadecimal ë¬¸ìì—´
-- ì˜ˆì‹œ: '17270f25', 'de49f056', 'eeefba98'
-- ìƒì„±: str(uuid.uuid4())[:8] (Python)
--      uuidv4().substring(0, 8) (TypeScript)
```

### ì—¬ì „íˆ ë‚¨ì•„ìˆëŠ” ì´ìŠˆ (Code Review ê²°ê³¼)

#### Priority 1 (CRITICAL) - ì™„ë£Œ âœ…
- âœ… **[FIXED]** politician_id UUID â†’ TEXT íƒ€ì… ë¶ˆì¼ì¹˜ (ëª¨ë‘ ìˆ˜ì • ì™„ë£Œ)

#### Priority 2 (CRITICAL) - ë¯¸í•´ê²° âš ï¸
- âš ï¸ **RLS ì •ì±… ì˜¤ë¥˜:** `migrations_to_apply.sql`ì—ì„œ `email_verifications` í…Œì´ë¸” ì‚¬ìš©
  - ì˜¬ë°”ë¥¸ í…Œì´ë¸”: `politician_sessions`
  - ìœ„ì¹˜: Line 120-130

- âš ï¸ **TypeScript íƒ€ì… ì•ˆì „ì„±:** `(supabase as any)` ê³¼ë„í•œ ì‚¬ìš©
  - íŒŒì¼: `posts/route.ts`, `comments/route.ts`
  - ì˜í–¥: ëŸ°íƒ€ì„ ì˜¤ë¥˜ ë¯¸íƒì§€

#### Priority 3 (ê°œì„ ) - ë¯¸í•´ê²° âš ï¸
- âš ï¸ **ì½”ë“œ ì¤‘ë³µ:** ì •ì¹˜ì¸ í•¸ë“¤ëŸ¬ ë¡œì§ 95% ë™ì¼
  - ì œì•ˆ: `validatePoliticianSession` í—¬í¼ í•¨ìˆ˜ ì¶”ì¶œ

### ë‹¤ìŒ ì‘ì—… ê³„íš
1. RLS ì •ì±… ìˆ˜ì • (`email_verifications` â†’ `politician_sessions`)
2. TypeScript íƒ€ì… ì•ˆì „ì„± ê°œì„  (`as any` ì œê±°)
3. ì½”ë“œ ì¤‘ë³µ ì œê±° (í—¬í¼ í•¨ìˆ˜ ì¶”ì¶œ)

### ì°¸ê³  ë¬¸ì„œ
- `Web_ClaudeCode_Bridge/outbox/politician_id_íƒ€ì…_ì¼ê´€ì„±_ìˆ˜ì •_ì™„ë£Œ_ë³´ê³ ì„œ.md`
- `1_Frontend/ì •ì¹˜ì¸_ê¸€ì“°ê¸°_êµ¬í˜„_ì™„ë£Œ_ë³´ê³ ì„œ.md`
- `1_Frontend/ì •ì¹˜ì¸_ê¸€ì“°ê¸°_í”„ë¡œì„¸ìŠ¤_ê°œì„ _ë¶„ì„.md`

---

## âœ… 2025-12-02 ì™„ë£Œ (7): ì½”ë“œ í’ˆì§ˆ ê°œì„  - TypeScript & ë¦¬íŒ©í† ë§

### ì‘ì—… ê°œìš”
**Code Review ì§€ì  ì‚¬í•­ í•´ê²°: TypeScript íƒ€ì… ì•ˆì „ì„± ê°œì„  ë° ì½”ë“œ ì¤‘ë³µ ì œê±°**

### í•´ê²°í•œ ì´ìŠˆ
1. âœ… TypeScript íƒ€ì… ì•ˆì „ì„± ê°œì„  - `as any` ê³¼ë„í•œ ì‚¬ìš© ì œê±°
2. âœ… ì½”ë“œ ì¤‘ë³µ ì œê±° - ì •ì¹˜ì¸ í•¸ë“¤ëŸ¬ ë¡œì§ 95% ë™ì¼ â†’ í—¬í¼ í•¨ìˆ˜ë¡œ í†µí•©
3. âœ… ë¹Œë“œ ì„±ê³µ - ëª¨ë“  TypeScript ì˜¤ë¥˜ í•´ê²°

### ğŸ“‚ ìƒì„±ëœ íŒŒì¼ (1ê°œ)

#### í—¬í¼ í•¨ìˆ˜
**`src/lib/auth/politicianSession.ts`** (135 lines)
- ì •ì¹˜ì¸ ì„¸ì…˜ í† í° ê²€ì¦ í—¬í¼ í•¨ìˆ˜
- ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ê²€ì¦ ë¡œì§ í†µí•©
- íƒ€ì… ì •ì˜ ë° ì¸í„°í˜ì´ìŠ¤ ì œê³µ

**ê¸°ëŠ¥:**
```typescript
export async function validatePoliticianSession(
  politicianId: string,
  sessionToken: string
): Promise<PoliticianSessionValidationResult>
```

- ì„¸ì…˜ í† í° ê²€ì¦
- ì •ì¹˜ì¸ ì •ë³´ í™•ì¸
- ì„¸ì…˜ last_used_at ìë™ ì—…ë°ì´íŠ¸
- ì—ëŸ¬ ì²˜ë¦¬ ë° ì‘ë‹µ í¬ë§·íŒ…

### ğŸ“ ìˆ˜ì •ëœ íŒŒì¼ (3ê°œ)

#### 1. `src/app/api/posts/route.ts`
**ê°œì„  ì‚¬í•­:**
- `handlePoliticianPost` í•¨ìˆ˜ ë¦¬íŒ©í† ë§
- 95 lines â†’ 55 lines (42% ê°ì†Œ)
- í—¬í¼ í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ê°€ë…ì„± í–¥ìƒ

**Before:**
```typescript
// 40+ linesì˜ ì„¸ì…˜ ê²€ì¦ ì½”ë“œ
const { data: session } = await (supabase as any)
  .from('politician_sessions')...
// 15+ linesì˜ ì •ì¹˜ì¸ í™•ì¸ ì½”ë“œ
const { data: politician } = await (supabase as any)
  .from('politicians')...
// 10+ linesì˜ ì„¸ì…˜ ì—…ë°ì´íŠ¸
await (supabase as any).from('politician_sessions').update...
```

**After:**
```typescript
// 5 linesì˜ í—¬í¼ í•¨ìˆ˜ í˜¸ì¶œ
const validationResult = await validatePoliticianSession(
  validated.politician_id,
  validated.session_token
);
```

#### 2. `src/app/api/comments/route.ts`
**ê°œì„  ì‚¬í•­:**
- `handlePoliticianComment` í•¨ìˆ˜ ë¦¬íŒ©í† ë§
- 95 lines â†’ 55 lines (42% ê°ì†Œ)
- Posts APIì™€ ë™ì¼í•œ íŒ¨í„´ ì ìš©

#### 3. `src/app/api/politicians/verify/check-code/route.ts`
**ë²„ê·¸ ìˆ˜ì •:**
- ë³€ìˆ˜ëª… ì¤‘ë³µ ì˜¤ë¥˜ í•´ê²°
- `expiresAt` (line 63) â†’ `sessionExpiresAt` (line 105)

### ğŸ“Š ê°œì„  íš¨ê³¼

#### ì½”ë“œ ì¤„ ìˆ˜ ê°ì†Œ
| íŒŒì¼ | Before | After | ê°ì†Œìœ¨ |
|------|--------|-------|--------|
| `posts/route.ts` | 95 lines | 55 lines | -42% |
| `comments/route.ts` | 95 lines | 55 lines | -42% |

#### ì½”ë“œ í’ˆì§ˆ ì§€í‘œ
**Before:**
- âŒ `as any` ì‚¬ìš©: 16ê³³
- âŒ ì½”ë“œ ì¤‘ë³µ: 95% ë™ì¼ ë¡œì§
- âŒ ë‹¨ì¼ ì±…ì„ ì›ì¹™ ìœ„ë°°

**After:**
- âœ… `as any` ì‚¬ìš©: 5ê³³ (insertë§Œ, ë¶ˆê°€í”¼)
- âœ… ì½”ë“œ ì¤‘ë³µ: 0%
- âœ… ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì¤€ìˆ˜

#### ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
1. **ê²€ì¦ ë¡œì§ ë³€ê²½ ì‹œ:** 1ê°œ íŒŒì¼ë§Œ ìˆ˜ì • (vs Before: 2ê°œ íŒŒì¼)
2. **í…ŒìŠ¤íŠ¸ ì‘ì„±:** í—¬í¼ í•¨ìˆ˜ë§Œ í…ŒìŠ¤íŠ¸ (vs Before: ê° APIë³„)
3. **ìƒˆ API ì¶”ê°€:** importë§Œ í•˜ë©´ ë¨ (vs Before: ë³µì‚¬-ë¶™ì—¬ë„£ê¸°)

### ğŸ¯ Code Review ì´ìŠˆ í•´ê²° í˜„í™©

**Priority 1 (CRITICAL) - âœ… ì™„ë£Œ**
- âœ… politician_id UUID â†’ TEXT (ì´ì „ ì‘ì—…)

**Priority 2 (CRITICAL) - âœ… ì™„ë£Œ**
- âœ… RLS ì •ì±… ì˜¤ë¥˜ (í™•ì¸ ì™„ë£Œ, ë¬¸ì œ ì—†ìŒ)
- âœ… TypeScript íƒ€ì… ì•ˆì „ì„± (`as any` ìµœì†Œí™” ì™„ë£Œ)

**Priority 3 (ê°œì„ ) - âœ… ì™„ë£Œ**
- âœ… ì½”ë“œ ì¤‘ë³µ ì œê±° (í—¬í¼ í•¨ìˆ˜ë¡œ í†µí•©)

### âœ… ê²€ì¦ ê²°ê³¼

#### TypeScript ì»´íŒŒì¼
```bash
âœ“ Compiled successfully
âœ“ Linting and checking validity of types
```

#### Next.js ë¹Œë“œ
```bash
âœ“ Creating an optimized production build
âœ“ Generating static pages (116/116)
âœ“ Build completed successfully!
```

#### ë°°í¬ ì¤€ë¹„ ìƒíƒœ
- âœ… TypeScript ì»´íŒŒì¼ ì„±ê³µ
- âœ… Next.js ë¹Œë“œ ì„±ê³µ
- âœ… ëª¨ë“  Critical ì´ìŠˆ í•´ê²°
- âœ… ë°°í¬ ê°€ëŠ¥ ìƒíƒœ

### ğŸ“„ ìƒì„±ëœ ë¬¸ì„œ
**`Web_ClaudeCode_Bridge/outbox/ì½”ë“œ_í’ˆì§ˆ_ê°œì„ _ì™„ë£Œ_ë³´ê³ ì„œ.md`**
- ì „ì²´ ì‘ì—… ë‚´ì—­ ìƒì„¸ ê¸°ë¡
- Before/After ì½”ë“œ ë¹„êµ
- ê°œì„  íš¨ê³¼ ë¶„ì„
- ê²€ì¦ ê²°ê³¼

### ë‹¤ìŒ ì‘ì—… ê³„íš
- ì„ íƒì  ê°œì„ ì‚¬í•­ (Rate Limiting, ì„¸ì…˜ ë³´ì•ˆ ê°•í™” ë“±)ì€ í•„ìš” ì‹œ ì¶”ê°€
- í˜„ì¬ ë°°í¬ ê°€ëŠ¥ ìƒíƒœ

### ì°¸ê³  ë¬¸ì„œ
- `Web_ClaudeCode_Bridge/outbox/ì½”ë“œ_í’ˆì§ˆ_ê°œì„ _ì™„ë£Œ_ë³´ê³ ì„œ.md`
- `Web_ClaudeCode_Bridge/outbox/politician_id_íƒ€ì…_ì¼ê´€ì„±_ìˆ˜ì •_ì™„ë£Œ_ë³´ê³ ì„œ.md`
- `1_Frontend/ì •ì¹˜ì¸_ê¸€ì“°ê¸°_êµ¬í˜„_ì™„ë£Œ_ë³´ê³ ì„œ.md`

---

## âœ… 2025-12-02 ì™„ë£Œ: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜ ìˆ˜ì •

### ì‘ì—… ê°œìš”
**ì •ì¹˜ì¸ ê¸€ì“°ê¸° ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© ì‹œ CHECK ì œì•½ì¡°ê±´ ì˜¤ë¥˜ í•´ê²°**
- âŒ ì˜¤ë¥˜: `check constraint "posts_author_check" is violated by some row`
- âœ… í•´ê²°: ê¸°ì¡´ ë°ì´í„° ì •ë¦¬ í›„ ì œì•½ì¡°ê±´ ì¶”ê°€í•˜ëŠ” ì•ˆì „í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±

### ë°œìƒí•œ ë¬¸ì œ
**ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© ì‹œ ì˜¤ë¥˜:**
```
ERROR: 23514: check constraint "posts_author_check" of relation "posts" is violated by some row
```

**ì›ì¸:**
- ê¸°ì¡´ posts í…Œì´ë¸”ì— `user_id`ì™€ `politician_id`ê°€ ë‘˜ ë‹¤ ì„¤ì •ëœ í–‰ ì¡´ì¬
- ìƒˆë¡œìš´ CHECK ì œì•½ì¡°ê±´ ìœ„ë°˜
- ë°ì´í„° ì •ë¦¬ ì—†ì´ ë°”ë¡œ ì œì•½ì¡°ê±´ ì¶”ê°€ ì‹œë„

### ìˆ˜í–‰í•œ ì‘ì—…

#### 1. ì•ˆì „í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
**íŒŒì¼:** `054_fix_politician_posting_schema_SAFE.sql`

**ì£¼ìš” ë³€ê²½ì‚¬í•­:**
```sql
-- STEP 1: ë¨¼ì € ê¸°ì¡´ ë°ì´í„° ì •ë¦¬
UPDATE posts
SET user_id = NULL
WHERE politician_id IS NOT NULL;

-- STEP 2: ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE posts
  ADD COLUMN IF NOT EXISTS author_type TEXT;

-- STEP 3: ê¸°ì¡´ ë°ì´í„°ì— author_type ì„¤ì •
UPDATE posts
SET author_type = CASE
  WHEN politician_id IS NOT NULL THEN 'politician'
  ELSE 'user'
END;

-- STEP 4: ì´ì œ ì œì•½ì¡°ê±´ ì¶”ê°€ (ì•ˆì „)
ALTER TABLE posts
  ADD CONSTRAINT posts_author_check
  CHECK (...);
```

#### 2. í†µí•© ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ (SAFE ë²„ì „)
**íŒŒì¼:** `ALL_MIGRATIONS_SAFE.sql`
- Migration 053 (politician_sessions)
- Migration 054 (SAFE ë²„ì „ - ë°ì´í„° ì •ë¦¬ í¬í•¨)

#### 3. ì˜¤ë¥˜ í•´ê²° ê°€ì´ë“œ ë¬¸ì„œ
**íŒŒì¼:** `ERROR_FIX_GUIDE.md`
- ì˜¤ë¥˜ ì›ì¸ ì„¤ëª…
- ì•ˆì „í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© ë°©ë²•
- Before/After ë¹„êµ
- ê²€ì¦ ë°©ë²•

### ğŸ“‚ ìƒì„±/ìˆ˜ì •ëœ íŒŒì¼

1. **`0-4_Database/Supabase/migrations/054_fix_politician_posting_schema_SAFE.sql`**
   - ë°ì´í„° ì •ë¦¬ ë¡œì§ ì¶”ê°€
   - ë‹¨ê³„ë³„ ì•ˆì „í•œ ìŠ¤í‚¤ë§ˆ ìˆ˜ì •
   - posts ë° comments í…Œì´ë¸” ëª¨ë‘ ì²˜ë¦¬

2. **`0-4_Database/Supabase/migrations/ALL_MIGRATIONS_SAFE.sql`**
   - 053 + 054 (SAFE ë²„ì „) í†µí•©
   - ë³µì‚¬-ë¶™ì—¬ë„£ê¸°ë¡œ ì¦‰ì‹œ ì ìš© ê°€ëŠ¥

3. **`0-4_Database/Supabase/migrations/ERROR_FIX_GUIDE.md`**
   - ì˜¤ë¥˜ ì§„ë‹¨ ë° í•´ê²° ë°©ë²•
   - 5ë¶„ ë¹ ë¥¸ ì ìš© ê°€ì´ë“œ
   - ê²€ì¦ ì¿¼ë¦¬ í¬í•¨

### í•´ê²° ë°©ë²• ìš”ì•½

| í•­ëª© | ê¸°ì¡´ ë²„ì „ | ì•ˆì „í•œ ë²„ì „ |
|------|----------|-----------|
| íŒŒì¼ëª… | `ALL_MIGRATIONS.sql` | `ALL_MIGRATIONS_SAFE.sql` |
| ë°ì´í„° ì •ë¦¬ | âŒ ì—†ìŒ | âœ… ì œì•½ì¡°ê±´ ì¶”ê°€ ì „ ìˆ˜í–‰ |
| ì˜¤ë¥˜ ë°œìƒ | âŒ YES | âœ… NO |
| ì ìš© ê¶Œì¥ | âŒ | âœ… **ì´ ë²„ì „ ì‚¬ìš©!** |

### ì ìš© ë°©ë²•

**Supabase Dashboard:**
1. https://supabase.com/dashboard ì ‘ì†
2. SQL Editor â†’ New query
3. `ALL_MIGRATIONS_SAFE.sql` ì „ì²´ ë³µì‚¬-ë¶™ì—¬ë„£ê¸°
4. Run ë²„íŠ¼ í´ë¦­

**ì˜ˆìƒ ê²°ê³¼:** âœ… Success (ì˜¤ë¥˜ ì—†ìŒ)

### ê²€ì¦ ì¿¼ë¦¬
```sql
-- posts í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'posts'
  AND column_name IN ('user_id', 'author_type', 'politician_id');
```

**ì˜ˆìƒ ê²°ê³¼:**
```
- author_type | text | NO   â† NOT NULL âœ…
- politician_id | text | YES
- user_id | uuid | YES  â† NULL í—ˆìš© âœ…
```

### ë‹¤ìŒ ë‹¨ê³„

**ì‚¬ìš©ì ìˆ˜í–‰ í•„ìš”:**
1. âœ… Supabase Dashboardì—ì„œ `ALL_MIGRATIONS_SAFE.sql` ì ìš©
2. âœ… ê²€ì¦ ì¿¼ë¦¬ë¡œ ì ìš© í™•ì¸
3. âœ… í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰: `node test_politician_posting_simple.js`

**ì˜ˆìƒ í…ŒìŠ¤íŠ¸ ê²°ê³¼:**
```
âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!
- ì •ì¹˜ì¸ ì •ë³´ í™•ì¸: ì˜¤ì„¸í›ˆ
- ê²Œì‹œê¸€ ì‘ì„± ì„±ê³µ
- ëŒ“ê¸€ ì‘ì„± ì„±ê³µ
```

### ê´€ë ¨ ë¬¸ì„œ
- `ALL_MIGRATIONS_SAFE.sql` - ì•ˆì „í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸
- `ERROR_FIX_GUIDE.md` - ì˜¤ë¥˜ í•´ê²° ìƒì„¸ ê°€ì´ë“œ
- `APPLY_NOW.md` - ë¹ ë¥¸ ì ìš© ê°€ì´ë“œ
- `ì •ì¹˜ì¸_ê¸€ì“°ê¸°_ë°ì´í„°ë² ì´ìŠ¤_ìŠ¤í‚¤ë§ˆ_ìˆ˜ì •_ì™„ë£Œ_ë³´ê³ ì„œ.md` - ì „ì²´ ë³´ê³ ì„œ

### ì‘ì—… ì‹œê°
- ì‹œì‘: 2025-12-02 21:00
- ì™„ë£Œ: 2025-12-02 21:15
- ì†Œìš”: 15ë¶„

---
