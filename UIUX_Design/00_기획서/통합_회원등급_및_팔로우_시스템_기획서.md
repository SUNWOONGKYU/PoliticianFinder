# 통합 회원 등급 및 팔로우 시스템 기획서

**문서 버전**: v2.0
**최종 수정일**: 2025년 10월 30일
**구현 상태**: ✅ 프론트엔드 UI 구현 완료
**프로젝트**: PoliticianFinder
**작성자**: 개발팀

---

## 📋 목차

1. [개요](#1-개요)
2. [회원 등급 체계](#2-회원-등급-체계)
3. [팔로우 시스템](#3-팔로우-시스템)
4. [UI/UX 설계](#4-uiux-설계)
5. [데이터베이스 설계](#5-데이터베이스-설계)
6. [구현 우선순위](#6-구현-우선순위)

---

## 1. 개요

### 1.1 목적
PoliticianFinder 플랫폼에 이중 등급 체계를 도입하여:
- **활동 등급**: 사용자의 플랫폼 참여도를 측정하고 혜택 제공
- **영향력 등급**: 지역 커뮤니티 내 영향력을 가시화하여 경쟁 유도

### 1.2 핵심 개념
- 두 등급은 **독립적이면서도 병렬로** 운영
- 활동 등급은 **실질적 혜택** 제공
- 영향력 등급은 **명예/위신만** 제공 (별도 기능적 혜택 없음)
- 팔로우 기능을 통한 사용자 간 네트워크 형성
- **실시간 등급 변화**로 재미 극대화

---

## 2. 회원 등급 체계

### 2.1 활동 등급 (Activity Grade)

#### 등급 구조
- **명칭**: ML1 ~ ML10 (Member Level 1~10)
- **기준**: 누적 활동 포인트
- **목적**: 플랫폼 활동 촉진, 실질적 혜택 제공

#### 등급표

| 등급 | 필요 포인트 | 예상 달성 기간 | 특징 |
|------|------------|--------------|------|
| ML1  | 0-99       | 신규 가입    | 시작 단계 |
| ML2  | 100-299    | 1주          | 초보 활동 |
| ML3  | 300-599    | 2주          | 기본 활동 |
| ML4  | 600-999    | 1개월        | 적극 활동 |
| ML5  | 1,000-1,999 | 2개월       | 중급 회원 |
| ML6  | 2,000-3,999 | 4개월       | 숙련 회원 |
| ML7  | 4,000-7,999 | 8개월       | 고급 회원 |
| ML8  | 8,000-15,999| 1년         | 베테랑 |
| ML9  | 16,000-31,999| 2년        | 엘리트 |
| ML10 | 32,000+    | 3년+         | 전설 |

#### 포인트 획득 방법

| 활동 | 획득 포인트 | 비고 |
|------|-----------|------|
| 게시글 작성 | +50p | 일일 제한 있음 |
| 댓글 작성 | +10p | 일일 제한 있음 |
| 정치인 평가 | +30p | - |
| 출석 체크 | +5p/일 | 연속 출석 보너스 |
| 팔로워 획득 | +20p/명 | **NEW** 실시간 지급 |
| 게시글 추천받기 | +5p/개 | - |
| 베스트 글 선정 | +100p | - |

#### 등급별 혜택 (예시)

| 등급 범위 | 기능적 권한 | 시각적 요소 |
|----------|-----------|-----------|
| ML1-ML2 | 게시글 1일 3개, 댓글 1일 10개 | 기본 프로필 |
| ML3-ML4 | 게시글 1일 5개, 이미지 첨부 | 프로필 커스터마이징 |
| ML5-ML6 | 게시글 무제한, 투표 생성 | 특수 이모지, 배경 변경 |
| ML7-ML8 | 예약 발행, 통계 대시보드 | 프로필 프레임, 닉네임 색상 |
| ML9-ML10 | 운영 건의 우선권, 베타 접근 | 전설 배지, 애니메이션 |

---

### 2.2 영향력 등급 (Influence Grade)

#### 등급 구조
- **명칭**: 서양 중세 귀족 칭호 기반
- **기준**: 지역구 내 팔로워 수 순위
- **목적**: 지역 커뮤니티 활성화, 명예 경쟁 유도
- **특징**: **별도 기능적 혜택 없음** (위신 자체가 보상)
- **갱신**: ⚡ **실시간 즉시 갱신** (재미 극대화)

#### 등급표

| 칭호 | 한글명 | 이모지 | 기준 | 추가 조건 |
|------|--------|--------|------|----------|
| Wanderer | 방랑자 | 🚶 | 팔로워 < 10명 | - |
| Knight | 기사 | ⚔️ | 팔로워 ≥ 10명 | - |
| Lord | 영주 | 🏰 | 지역구 내 상위 20% | 팔로워 ≥ 50명 |
| Duke | 공작 | 👑 | 지역구 내 상위 5% | 팔로워 ≥ 200명 |
| Monarch | 군주 | 🌟 | 지역구 내 1위 | 팔로워 ≥ 500명 |

#### 실시간 등급 갱신 시스템 ⚡

**갱신 트리거:**
1. 사용자 A가 사용자 B를 팔로우
2. 즉시 B의 팔로워 수 +1
3. 즉시 B의 지역구 내 순위 재계산
4. 등급 변동 시 즉시 B에게 알림 발송
5. B의 프로필 페이지에서 실시간 업데이트 확인

**재미 요소:**
```
팔로워 획득 시:
┌─────────────────────────────┐
│  🎉 축하합니다!              │
│                              │
│  새로운 팔로워가 생겼습니다! │
│  팔로워: 326명 → 327명       │
│  +20 포인트 획득!           │
└─────────────────────────────┘

등급 승급 시:
┌─────────────────────────────┐
│  🎊 등급 승급!               │
│                              │
│  ⚔️ 기사 → 🏰 영주           │
│                              │
│  지역 순위: 상위 18% → 15%  │
│  계속해서 팔로워를 모아보세요!│
└─────────────────────────────┘
```

#### 등급별 시각적 표현

| 칭호 | 프로필 테두리 | 칭호 배지 | 애니메이션 |
|------|-------------|----------|-----------|
| 방랑자 | 없음 | 🚶 | 없음 |
| 기사 | 실버 | ⚔️ 기사 문장 | 없음 |
| 영주 | 골드 | 🏰 영주 문장 | 없음 |
| 공작 | 플래티넘 | 👑 공작 왕관 | 반짝임 |
| 군주 | 다이아몬드 | 🌟 군주 휘장 | 빛나는 효과 |

---

## 3. 팔로우 시스템

### 3.1 개념
- 사용자 간 팔로우 관계 형성
- 팔로워 수가 **영향력 등급**의 핵심 지표
- 팔로우한 사용자의 활동을 피드에서 우선 표시
- **실시간 반영**으로 즉각적인 피드백

### 3.2 팔로우 버튼 설치 위치

#### 📍 1순위 (필수 구현)

**1) 커뮤니티 게시글 - 작성자 정보 영역**
```
위치: community.html, 게시글 카드 상단
예시: [프로필사진] 민주시민 ML5 🏰  [+ 팔로우]

디자인:
  - 작성자 이름 오른쪽에 배치
  - 크기: 중간 (px-4 py-2, text-sm)
  - 스타일: 보라색 테두리 버튼

상태:
  - 미팔로우: [+ 팔로우] (보라색 테두리)
  - 팔로우 중: [✓ 팔로잉] (회색 배경)
  - 본인 글: 버튼 숨김
```

**2) 게시글 상세 - 댓글 작성자**
```
위치: post-detail.html, 각 댓글 상단
예시: 민주시민 ML5 🏰  [+ 팔로우]  · 2시간 전

디자인:
  - 댓글 작성자 이름 옆
  - 크기: 작음 (px-3 py-1, text-xs)
  - 작은 버튼 (게시글보다 작게)

상태:
  - 본인 댓글: 버튼 숨김
```

**3) 다른 사용자 마이페이지 - 프로필 카드**
```
위치: mypage.html (다른 사용자 방문 시)
예시:
  ┌─────────────────────┐
  │  [프로필 사진]      │
  │  민주시민           │
  │  ML5 🏰영주         │
  │                     │
  │ [+ 팔로우] (큰 버튼)│
  │                     │
  │ 게시글 24 | 팔로워 327 | 팔로잉 145
  └─────────────────────┘

디자인:
  - 프로필 사진 아래, 통계 위
  - 크기: 큼 (전체 너비, px-6 py-3)
  - 가장 눈에 띄는 위치
```

#### 📍 2순위 (추가 고려)

**4) 정치인 상세 페이지**
```
위치: politician-detail.html
목적: 정치인 소식 알림 구독
예시: [정치인 사진] 홍길동 의원  [정치인 팔로우]
```

**5) 사용자 검색 결과**
```
위치: 사용자 검색 페이지
목적: 빠른 팔로우
```

### 3.3 팔로우 버튼 디자인 상세

#### 상태별 디자인

**미팔로우 상태**
```css
배경: transparent
테두리: 2px solid #8b5cf6 (보라색)
텍스트: #8b5cf6 (보라색)
아이콘: + (플러스)
호버: 배경 #f3f4f6 (연회색)
클릭: 0.2초 펄스 애니메이션
```

**팔로우 중 상태**
```css
배경: #e5e7eb (회색)
테두리: 없음
텍스트: #6b7280 (진회색)
아이콘: ✓ (체크)
호버: 배경 #fecaca (연빨강) + 텍스트 "언팔로우"
클릭: 확인 모달 (정말 언팔로우 하시겠습니까?)
```

#### 크기 변형

| 위치 | 크기 클래스 | 패딩 | 폰트 크기 | 높이 |
|------|-----------|------|---------|------|
| 게시글 | medium | px-4 py-2 | text-sm | h-8 |
| 댓글 | small | px-3 py-1 | text-xs | h-6 |
| 프로필 | large | px-6 py-3 | text-base | h-12 |

#### 클릭 시 애니메이션

**팔로우 성공 시:**
```javascript
1. 버튼 0.2초 펄스 효과
2. [+ 팔로우] → [✓ 팔로잉] 전환
3. 우측 상단 토스트 알림:
   "민주시민님을 팔로우했습니다 (+20p)"
4. 해당 사용자 팔로워 수 카운터 +1 (애니메이션)
```

**언팔로우 성공 시:**
```javascript
1. [✓ 팔로잉] → [+ 팔로우] 전환
2. 우측 상단 토스트 알림:
   "민주시민님 팔로우를 취소했습니다"
3. 해당 사용자 팔로워 수 카운터 -1
```

### 3.4 팔로우 기능 명세

#### API 엔드포인트
```
POST   /api/v1/follow/{userId}      # 팔로우
DELETE /api/v1/follow/{userId}      # 언팔로우
GET    /api/v1/followers            # 내 팔로워 목록
GET    /api/v1/following            # 내가 팔로우한 목록
GET    /api/v1/users/{userId}/followers     # 특정 사용자 팔로워
GET    /api/v1/users/{userId}/follower-stats # 실시간 통계
```

#### 실시간 데이터 흐름 ⚡

**팔로우 발생 시:**
```
1. 사용자 A가 [+ 팔로우] 버튼 클릭 (대상: 사용자 B)
2. POST /api/v1/follow/{B의ID}
3. 서버 처리:
   ├─ follows 테이블에 관계 생성
   ├─ A의 following_count +1
   ├─ B의 follower_count +1
   ├─ B에게 포인트 +20p 즉시 지급
   ├─ B의 지역구 내 순위 즉시 재계산
   ├─ 등급 변동 시 B에게 알림 발송
   └─ WebSocket으로 B에게 실시간 업데이트 전송
4. 프론트엔드 즉시 업데이트:
   ├─ A 화면: [+ 팔로우] → [✓ 팔로잉]
   ├─ B 화면 (접속 중이면): 팔로워 수 +1 애니메이션
   └─ 토스트 알림 표시
```

**언팔로우 발생 시:**
```
1. 사용자 A가 [✓ 팔로잉] 호버 → "언팔로우" 표시
2. 클릭 → 확인 모달: "정말 언팔로우 하시겠습니까?"
3. 확인 클릭 → DELETE /api/v1/follow/{B의ID}
4. 서버 처리:
   ├─ follows 테이블에서 관계 삭제
   ├─ A의 following_count -1
   ├─ B의 follower_count -1
   ├─ B의 지역구 내 순위 즉시 재계산
   └─ 등급 변동 시 B에게 알림 발송
5. 프론트엔드 즉시 업데이트
```

---

## 4. UI/UX 설계

### 4.1 마이페이지 - 활동 내역 탭 (구현 완료 ✅)

#### 레이아웃 구조
```
┌─────────────────────────────────────────┐
│  [내 게시글] [내 댓글] [활동 내역]      │
├─────────────────────────────────────────┤
│  🏰 영향력 등급                         │
│  지역구 내 팔로워 순위 기반 (명예 칭호) │
│  ┌───────────────────────────────────┐ │
│  │ 🏰 영주 (Lord)                    │ │
│  │ 📍 서울 강남구 갑                  │ │
│  │                                   │ │
│  │ 팔로워: 327명 (▲12 이번주)        │ │
│  │ 지역순위: 상위 15% (1,247명 중 187위)│
│  │                                   │ │
│  │ 🎯 다음 등급: 공작 (Duke)         │ │
│  │    상위 5% 진입 시                │ │
│  └───────────────────────────────────┘ │
│  ※ 영향력 등급은 실시간으로 갱신됩니다 │
│                                         │
│  📊 활동 등급 - 포인트 현황             │
│  ┌───────────────────────────────────┐ │
│  │ 연간: 1,248p (ML5) | 월간: 187p  │ │
│  │ ████████░░ 62%                    │ │
│  │ ML5 → ML6 (752p 남음)             │ │
│  └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

**구현 완료 내용:**
- ✅ 영향력 등급 카드 추가
- ✅ 그라데이션 배경 (보라→인디고)
- ✅ 현재 칭호 및 지역 표시
- ✅ 팔로워 수 및 지역 순위 표시
- ✅ 다음 등급 안내
- ✅ 실시간 갱신 안내 문구

### 4.2 커뮤니티 게시글 카드 (작업 대기)

#### Before (기존)
```html
<div class="게시글 카드">
  <div class="작성자 정보">
    <img src="프로필사진" />
    <span>민주시민</span>
    <span class="text-gray-400">· 2025-01-24</span>
  </div>
  <h3>게시글 제목</h3>
  <p>게시글 내용...</p>
</div>
```

#### After (개선안)
```html
<div class="게시글 카드">
  <div class="작성자 정보 flex items-center">
    <img src="프로필사진" class="w-10 h-10 rounded-full" />
    <div class="ml-3 flex-1 flex items-center">
      <span class="font-medium">민주시민</span>
      <span class="ml-2 text-xs text-gray-500">ML5</span>
      <span class="ml-1 text-lg">🏰</span>

      <!-- 팔로우 버튼 (본인 글 아닐 때만) -->
      <button class="ml-3 px-4 py-2 border-2 border-purple-500 text-purple-600 rounded-md text-sm hover:bg-gray-50 transition">
        + 팔로우
      </button>

      <span class="ml-auto text-sm text-gray-400">2025-01-24</span>
    </div>
  </div>
  <h3 class="mt-3">게시글 제목</h3>
  <p>게시글 내용...</p>
</div>
```

### 4.3 댓글 영역 (작업 대기)

```html
<div class="댓글">
  <div class="flex items-center mb-2">
    <img src="프로필사진" class="w-8 h-8 rounded-full" />
    <span class="ml-2 font-medium">민주시민</span>
    <span class="ml-2 text-xs text-gray-500">ML5</span>
    <span class="ml-1">🏰</span>

    <!-- 작은 팔로우 버튼 -->
    <button class="ml-2 px-3 py-1 border border-purple-500 text-purple-600 rounded text-xs hover:bg-gray-50">
      + 팔로우
    </button>

    <span class="ml-auto text-xs text-gray-400">2시간 전</span>
  </div>
  <p class="ml-10 text-sm">댓글 내용...</p>
</div>
```

### 4.4 등급 승급 알림 모달

```html
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg p-8 max-w-md text-center animate-bounce-in">
    <div class="text-6xl mb-4">🎊</div>
    <h2 class="text-2xl font-bold text-gray-900 mb-2">등급 승급!</h2>

    <div class="flex items-center justify-center gap-4 my-6">
      <div class="text-4xl">⚔️</div>
      <div class="text-3xl text-gray-400">→</div>
      <div class="text-5xl">🏰</div>
    </div>

    <p class="text-xl font-bold text-purple-700 mb-2">
      기사 → 영주
    </p>

    <p class="text-gray-600 mb-6">
      지역 순위: 상위 18% → 15%<br/>
      계속해서 팔로워를 모아보세요!
    </p>

    <button class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700">
      확인
    </button>
  </div>
</div>
```

### 4.5 색상 체계 (✅ 최종 확정)

#### 활동 등급 (ML)
- **표시 색상**: `#111827` (gray-900, 검정)
- **이유**: 가독성 최우선, 이름보다 눈에 띄지 않아야 함
- **배경**: `#f9fafb` (secondary-50)

#### 영향력 등급 (Nobility) ✨
- **주색상**: `#064E3B` (emerald-900) ⭐ **AI 평가 색상과 통일**
- **이유**: 영향력 등급도 AI가 부여한 가상의 칭호이므로 동일한 초록색 계열 사용
- **배경**: `#ecfdf5` (emerald-50)
- **테두리**: `#6ee7b7` (emerald-200)

#### 회원 이름 색상
- **회원 링크**: `#9333ea` (purple-600) → hover: `#7e22ce` (purple-700)
- **정치인 링크**: `#ea580c` (primary-600) → hover: `#c2410c` (primary-700)

#### 팔로우 버튼
- **미팔로우**:
  - 테두리: `#064E3B` (emerald-700)
  - 텍스트: `#064E3B` (emerald-900)
  - 호버: `bg: #f9fafb`
- **팔로잉**:
  - 배경: `#e5e7eb` (gray-200)
  - 텍스트: `#6b7280` (gray-600)
  - 호버: `bg: #fecaca` (red-100), `text: #dc2626` (red-600)

#### 텍스트 크기 체계 ✅
- **회원 이름**: `text-sm` 또는 `text-base` (기본 크기)
- **활동 등급 (ML5)**: `text-[10px]` + `font-medium`
- **영향력 등급 (🏰 영주)**: `text-[10px]` + `font-medium`
- **이유**: 등급은 부가 정보이므로 이름보다 작게 표시하여 시각적 계층 구조 형성

---

## 5. 데이터베이스 설계

### 5.1 사용자 테이블 확장

```sql
-- users 테이블에 추가 컬럼
ALTER TABLE users ADD COLUMN (
  activity_points INT DEFAULT 0,           -- 누적 활동 포인트
  activity_grade VARCHAR(10) DEFAULT 'ML1', -- 활동 등급 (ML1~ML10)
  influence_grade VARCHAR(20) DEFAULT 'Wanderer', -- 영향력 등급
  follower_count INT DEFAULT 0,            -- 팔로워 수 (캐시)
  following_count INT DEFAULT 0,           -- 팔로잉 수 (캐시)
  preferred_district VARCHAR(100),         -- 관심 지역구
  district_rank INT DEFAULT 0,             -- 지역구 내 순위
  district_percentile DECIMAL(5,2),        -- 상위 퍼센트 (예: 15.50)
  last_grade_check TIMESTAMP DEFAULT NOW() -- 마지막 등급 확인 시간
);

-- 인덱스 추가
CREATE INDEX idx_users_district ON users(preferred_district, follower_count DESC);
CREATE INDEX idx_users_activity ON users(activity_points DESC);
```

### 5.2 팔로우 관계 테이블

```sql
CREATE TABLE follows (
  id BIGSERIAL PRIMARY KEY,
  follower_id BIGINT NOT NULL,             -- 팔로우하는 사람
  following_id BIGINT NOT NULL,            -- 팔로우당하는 사람
  created_at TIMESTAMP DEFAULT NOW(),
  FOREIGN KEY (follower_id) REFERENCES users(id) ON DELETE CASCADE,
  FOREIGN KEY (following_id) REFERENCES users(id) ON DELETE CASCADE,
  UNIQUE(follower_id, following_id),       -- 중복 팔로우 방지
  CHECK (follower_id != following_id)      -- 셀프 팔로우 금지
);

-- 인덱스
CREATE INDEX idx_follows_follower ON follows(follower_id);
CREATE INDEX idx_follows_following ON follows(following_id);
CREATE INDEX idx_follows_created ON follows(created_at);
```

### 5.3 활동 포인트 히스토리 테이블

```sql
CREATE TABLE activity_points_history (
  id BIGSERIAL PRIMARY KEY,
  user_id BIGINT NOT NULL,
  action_type VARCHAR(50) NOT NULL,        -- 'post', 'comment', 'follow_gained', etc.
  points INT NOT NULL,
  description TEXT,
  reference_id BIGINT,                     -- 관련 게시글/댓글 ID
  created_at TIMESTAMP DEFAULT NOW(),
  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE INDEX idx_points_history_user ON activity_points_history(user_id);
CREATE INDEX idx_points_history_date ON activity_points_history(created_at);
```

### 5.4 실시간 순위 계산 로직

```sql
-- 특정 지역구 내 사용자 순위 계산 함수
CREATE OR REPLACE FUNCTION calculate_district_rank(
  p_user_id BIGINT,
  p_district VARCHAR(100)
) RETURNS TABLE(
  rank INT,
  total_users INT,
  percentile DECIMAL(5,2),
  grade VARCHAR(20)
) AS $$
DECLARE
  v_follower_count INT;
  v_rank INT;
  v_total INT;
  v_percentile DECIMAL(5,2);
  v_grade VARCHAR(20);
BEGIN
  -- 해당 사용자의 팔로워 수
  SELECT follower_count INTO v_follower_count
  FROM users WHERE id = p_user_id;

  -- 지역구 내 순위 계산
  SELECT COUNT(*) + 1 INTO v_rank
  FROM users
  WHERE preferred_district = p_district
    AND follower_count > v_follower_count;

  -- 지역구 총 사용자 수
  SELECT COUNT(*) INTO v_total
  FROM users
  WHERE preferred_district = p_district;

  -- 상위 퍼센트 계산
  v_percentile := (v_rank::DECIMAL / v_total) * 100;

  -- 등급 결정
  IF v_rank = 1 AND v_follower_count >= 500 THEN
    v_grade := 'Monarch';
  ELSIF v_percentile <= 5 AND v_follower_count >= 200 THEN
    v_grade := 'Duke';
  ELSIF v_percentile <= 20 AND v_follower_count >= 50 THEN
    v_grade := 'Lord';
  ELSIF v_follower_count >= 10 THEN
    v_grade := 'Knight';
  ELSE
    v_grade := 'Wanderer';
  END IF;

  RETURN QUERY SELECT v_rank, v_total, v_percentile, v_grade;
END;
$$ LANGUAGE plpgsql;
```

---

## 6. 구현 우선순위

### Phase 1: 기반 구축 (1-2주)
- [ ] 데이터베이스 스키마 구현
  - [ ] users 테이블 확장
  - [ ] follows 테이블 생성
  - [ ] activity_points_history 테이블 생성
  - [ ] calculate_district_rank() 함수 생성
- [ ] 백엔드 API 개발
  - [ ] POST /api/v1/follow/{userId} - 팔로우
  - [ ] DELETE /api/v1/follow/{userId} - 언팔로우
  - [ ] GET /api/v1/followers - 팔로워 목록
  - [ ] GET /api/v1/following - 팔로잉 목록
  - [ ] 실시간 순위 계산 로직
  - [ ] 등급 승급 알림 시스템
  - [ ] WebSocket 실시간 업데이트

### Phase 2: 프론트엔드 UI ✅ **완료**
- [x] **mypage.html 업데이트** ✅
  - [x] 영향력 등급 카드 추가 완료
  - [x] 카드 순서 조정 (영향력 등급 하단 배치)
  - [x] 게시글 카테고리 배지 삭제 (깔끔한 UI)
  - [ ] 팔로워/팔로잉 목록 탭 추가 (백엔드 필요)
- [x] **index.html 업데이트** ✅
  - [x] "나의 활동" 섹션 추가
  - [x] 활동 등급 표시
  - [x] 보유 포인트 표시 (연간 통합)
  - [x] 영향력 등급 카드 추가
  - [x] 모든 항목 간 간격 통일 (space-y-1)
- [x] **팔로우 버튼 구현** ✅
  - [x] community.html: 게시글 카드에 팔로우 버튼 추가
  - [x] post-detail_member.html: 댓글에 팔로우 버튼 추가
  - [x] post-detail_politician.html: 댓글에 팔로우 버튼 추가
  - [x] 팔로우/언팔로우 JavaScript 로직 구현
  - [x] 토스트 알림 시스템 구현
  - [x] 호버 상태 변화 (언팔로우 표시)
- [x] **등급 표시** ✅
  - [x] 모든 사용자 이름 옆에 ML 레벨 표시
  - [x] 영향력 칭호 이모지 + 텍스트 표시 (예: 🏰 영주)
  - [x] 색상 체계 최종 확정 (emerald-900)
  - [x] 텍스트 크기 조정 (text-[10px])

### Phase 3: 실시간 기능 (2주)
- [ ] **실시간 갱신 구현**
  - [ ] WebSocket 연결
  - [ ] 팔로워 수 실시간 업데이트
  - [ ] 등급 변동 즉시 반영
- [ ] **알림 시스템**
  - [ ] 등급 승급 모달
  - [ ] 팔로워 획득 토스트
  - [ ] 포인트 획득 애니메이션
- [ ] **포인트 자동 지급**
  - [ ] 팔로워 획득 시 +20p
  - [ ] 게시글 작성 시 +50p
  - [ ] 댓글 작성 시 +10p

### Phase 4: 테스트 및 최적화 (1주)
- [ ] 통합 테스트
  - [ ] 팔로우/언팔로우 동작 확인
  - [ ] 순위 계산 정확성 검증
  - [ ] 실시간 갱신 성능 테스트
- [ ] UX 개선
  - [ ] 버튼 애니메이션 조정
  - [ ] 로딩 상태 표시
  - [ ] 에러 핸들링

---

## 7. 실시간 갱신 시스템 상세 설계

### 7.1 갱신 흐름

```
사용자 A가 사용자 B를 팔로우 → 실시간 처리
│
├─ [1] 프론트엔드
│   ├─ 버튼 클릭 → API 호출
│   ├─ 버튼 상태 즉시 변경 (Optimistic Update)
│   └─ WebSocket 리스너 대기
│
├─ [2] 백엔드
│   ├─ follows 테이블 INSERT
│   ├─ B.follower_count += 1 (원자적 연산)
│   ├─ A.following_count += 1
│   ├─ B에게 포인트 +20p 지급
│   ├─ calculate_district_rank(B, district) 호출
│   ├─ B.district_rank, percentile, grade 업데이트
│   ├─ 등급 변동 확인
│   └─ WebSocket 브로드캐스트
│
└─ [3] 실시간 알림
    ├─ B가 접속 중이면:
    │   ├─ 팔로워 수 카운터 애니메이션
    │   ├─ 토스트: "새 팔로워가 생겼습니다!"
    │   └─ 등급 변동 시 모달 표시
    └─ B가 오프라인이면:
        └─ 알림 큐에 저장 (다음 로그인 시 표시)
```

### 7.2 성능 최적화

#### 캐싱 전략
- `follower_count`, `following_count`: users 테이블에 캐시 (JOIN 방지)
- `district_rank`, `district_percentile`: 실시간 계산 후 즉시 저장
- Redis 캐싱: 지역구별 순위 리스트 (TTL 5분)

#### 배치 vs 실시간
- **실시간 계산**: 팔로우/언팔로우 발생 시 해당 지역구만 재계산
- **주기적 정리**: 매일 새벽 3시 전체 순위 재정렬 (데이터 정합성 보장)

### 7.3 보안 및 남용 방지
- **팔로우 제한**: 하루 최대 50명 팔로우
- **스팸 방지**: 1분 내 동일 사용자 3회 팔로우/언팔로우 시 일시 차단
- **셀프 팔로우 금지**: DB 제약조건으로 방지
- **봇 탐지**: 5분 내 10명 이상 팔로우 시 CAPTCHA

---

## 8. 디자인 산출물

### 8.1 완료된 파일 ✅
- [x] `index.html` - "나의 활동" 섹션 추가 및 영향력 등급 표시 ✅
- [x] `mypage.html` - 영향력 등급 카드 추가, 카테고리 배지 삭제 ✅
- [x] `community.html` - 팔로우 버튼 및 등급 표시 추가 ✅
- [x] `post-detail_member.html` - 댓글에 팔로우 버튼 및 등급 표시 추가 ✅
- [x] `post-detail_politician.html` - 댓글에 팔로우 버튼 및 등급 표시 추가 ✅

### 8.2 구현 완료 스크립트
- [x] `add_influence_grade.py` - 영향력 등급 카드 추가 ✅
- [x] `add_follow_button_community.py` - 커뮤니티 팔로우 버튼 추가 ✅
- [x] `add_follow_button_comments.py` - 댓글 팔로우 버튼 추가 ✅
- [x] `add_grade_text.py` - 등급 텍스트 표시 추가 ✅
- [x] `change_influence_color_to_green.py` - 색상 변경 ✅
- [x] `fix_influence_colors_final.py` - 색상 최종 수정 ✅
- [x] `reduce_grade_text_size.py` - 텍스트 크기 조정 ✅
- [x] `fix_points_display.py` - 포인트 표시 통일 ✅
- [x] `final_cleanup_my_activity.py` - 나의 활동 섹션 최종 정리 ✅
- [x] `remove_category_badges.py` - 카테고리 배지 삭제 ✅
- [x] `통합_회원등급_및_팔로우_시스템_기획서.md` - 본 문서 v2.0 ✅

### 8.3 백엔드 구현 대기 기능
- [ ] `followers-list.html` - 팔로워 목록 페이지 (백엔드 API 필요)
- [ ] `following-list.html` - 팔로잉 목록 페이지 (백엔드 API 필요)
- [ ] `grade-upgrade-modal.html` - 등급 승급 모달 컴포넌트 (WebSocket 필요)
- [ ] 실시간 팔로워 수 업데이트 기능
- [ ] 등급 자동 계산 및 갱신 시스템

---

## 9. 핵심 요약

### ✅ 확정 사항

**1. 등급 명칭**
- **활동 등급 (ML1~ML10)**: 포인트 기반, 실질적 혜택 제공
- **영향력 등급 (방랑자~군주)**: 팔로워 순위 기반, **명예만** (별도 혜택 없음)

**2. 영향력 등급 갱신**
- ⚡ **실시간 즉시 갱신** (일주일 주기 ❌)
- 팔로우/언팔로우 발생 시 즉시 순위 재계산
- 등급 변동 시 즉시 알림 발송

**3. 팔로우 버튼 위치**
1. **커뮤니티 게시글**: 작성자 이름 옆 (중간 크기)
2. **댓글**: 작성자 이름 옆 (작은 크기)
3. **사용자 프로필**: 프로필 카드 상단 (큰 크기)

**4. 재미 요소**
- 실시간 팔로워 수 증가 애니메이션
- 등급 승급 시 🎊 축하 모달
- 팔로워 획득 시 토스트 알림 + 포인트 지급

---

**문서 종료**

**다음 단계:**
1. 백엔드 API 개발
2. community.html 팔로우 버튼 추가
3. 실시간 WebSocket 구현

---

## 10. 구현 완료 내역 ✅

### 10.1 완료된 기능 (2025-10-30)

#### ✅ 1. 이중 등급 시스템 UI 구현
- **활동 등급 (ML1-ML10)**: 모든 페이지에서 회원 이름 옆에 표시
- **영향력 등급 (방랑자~군주)**: 이모지 + 한글명 표시 (예: 🏰 영주)
- **색상 최종 확정**:
  - 활동 등급: gray-900 (검정)
  - 영향력 등급: emerald-900 (#064E3B - AI 평가 색상과 통일)
  - 회원 이름: purple-600
- **텍스트 크기**: 등급은 text-[10px]로 이름보다 작게 표시

#### ✅ 2. 팔로우 버튼 시스템
- **구현 위치**:
  - community.html: 게시글 작성자 옆
  - post-detail 페이지들: 댓글 작성자 옆
- **상태 관리**:
  - 미팔로우: [+ 팔로우] (emerald 테두리)
  - 팔로우 중: [✓ 팔로잉] (회색 배경)
  - 호버 시: "언팔로우" 표시 (빨간색)
- **JavaScript 기능**:
  - toggleFollow() 함수 구현
  - 토스트 알림 시스템 (우측 상단)
  - Optimistic UI 업데이트

#### ✅ 3. 나의 활동 섹션 (index.html)
- **구조**:
  1. 활동 등급 (ML5)
  2. 보유 포인트 (연간 통합)
  3. 영향력 등급 (🏰 영주 + 팔로워 통계)
- **디자인**:
  - 모든 항목 간 간격 통일 (space-y-1)
  - emerald 배경으로 영향력 등급 강조
  - 깔끔한 레이아웃

#### ✅ 4. 마이페이지 최적화
- 영향력 등급 카드 추가
- 카드 순서 조정 (영향력을 하단에 배치)
- 게시글 카테고리 배지 삭제 (UI 정리)

#### ✅ 5. 코드베이스 정리
- git clone으로 잘못 들어온 파일 삭제 (83개 파일)
- HTML 파일 연결 관계 확인
- pages 폴더 구조 정리

### 10.2 남은 작업 (백엔드 구현 필요)

#### 🔄 1. API 엔드포인트 개발
```
POST   /api/v1/follow/{userId}      # 팔로우
DELETE /api/v1/follow/{userId}      # 언팔로우
GET    /api/v1/followers            # 팔로워 목록
GET    /api/v1/following            # 팔로잉 목록
GET    /api/v1/users/{userId}/stats # 실시간 통계
```

#### 🔄 2. 실시간 갱신 시스템
- WebSocket 연결 구현
- 팔로워 수 실시간 업데이트
- 등급 변동 즉시 알림

#### 🔄 3. 데이터베이스 구현
- users 테이블 확장 (활동/영향력 등급 컬럼)
- follows 테이블 생성
- activity_points_history 테이블 생성
- calculate_district_rank() 함수 구현

#### 🔄 4. 포인트 자동 지급 시스템
- 팔로워 획득 시 +20p
- 게시글 작성 시 +50p
- 댓글 작성 시 +10p

### 10.3 프론트엔드 → 백엔드 연동 가이드

현재 JavaScript 코드에서 `// TODO: API call` 주석이 있는 부분:
1. `followUser()` 함수 - POST /api/v1/follow 호출 필요
2. `unfollowUser()` 함수 - DELETE /api/v1/follow 호출 필요
3. 팔로워 수 카운터 - 실시간 업데이트 WebSocket 연결 필요

