# -*- coding: utf-8 -*-
"""
ì¹´í…Œê³ ë¦¬ íŒŒì¼ì— ì¤‘ë³µ ë°©ì§€ ì „ëµ ì„¹ì…˜ ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸
"""
import os
import sys
import re

# UTF-8 ì¶œë ¥ ì„¤ì •
if sys.platform == 'win32':
    import io
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
    sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8')

DUPLICATE_STRATEGY_SECTION = """---

## 3. ì¤‘ë³µ ë°©ì§€ ì „ëµ âœ¨

### ğŸ”¥ ê³ ê¸‰ ì¤‘ë³µ ê²€ì‚¬ (URL + ì œëª©)

```
V40 URL + ì œëª© ì´ì¤‘ ê²€ì‚¬ë¡œ ê°•í™”!
```

### 3.1 URL ì •ê·œí™”

**íŒŒë¼ë¯¸í„°, ì•µì»¤ ì œê±°ë¡œ ê°™ì€ í˜ì´ì§€ ì‹ë³„**

```
ì˜ˆì‹œ:
âœ… ì¤‘ë³µìœ¼ë¡œ ê°ì§€ (ê°™ì€ í˜ì´ì§€):
- https://namu.wiki/w/ê¹€ë¯¼ì„/ë¹„íŒ%20ë°%20ë…¼ë€
- https://namu.wiki/w/ê¹€ë¯¼ì„/ë¹„íŒ%20ë°%20ë…¼ë€?rev=456
- https://namu.wiki/w/ê¹€ë¯¼ì„/ë¹„íŒ%20ë°%20ë…¼ë€#s-1
- https://namu.wiki/w/ê¹€ë¯¼ì„/ë¹„íŒ%20ë°%20ë…¼ë€?from=search

â†’ ëª¨ë‘ https://namu.wiki/w/ê¹€ë¯¼ì„/ë¹„íŒ%20ë°%20ë…¼ë€ ë¡œ ì •ê·œí™”
â†’ 1ê°œë§Œ ìˆ˜ì§‘, ë‚˜ë¨¸ì§€ëŠ” ì¤‘ë³µìœ¼ë¡œ ìŠ¤í‚µ
```

### 3.2 ì œëª© ìœ ì‚¬ë„ ê²€ì‚¬

**95% ì´ìƒ ìœ ì‚¬í•œ ì œëª© = ì¤‘ë³µ**

```
ì˜ˆì‹œ:
âœ… ì¤‘ë³µìœ¼ë¡œ ê°ì§€ (95% ì´ìƒ ìœ ì‚¬):
- "ê¹€ë¯¼ì„/ë¹„íŒ ë° ë…¼ë€/êµ­ë¬´ì´ë¦¬ í›„ë³´ì - ë‚˜ë¬´ìœ„í‚¤"
- "ê¹€ë¯¼ì„ / ë¹„íŒ ë° ë…¼ë€ / êµ­ë¬´ì´ë¦¬ í›„ë³´ì - ë‚˜ë¬´ìœ„í‚¤"
- "ê¹€ë¯¼ì„/ë¹„íŒ ë° ë…¼ë€/êµ­ë¬´ì´ë¦¬ í›„ë³´ì"

â†’ ì œëª© ì •ê·œí™” í›„ ë¹„êµ
â†’ 1ê°œë§Œ ìˆ˜ì§‘, ë‚˜ë¨¸ì§€ëŠ” ì¤‘ë³µìœ¼ë¡œ ìŠ¤í‚µ
```

### 3.3 ì¤‘ë³µ íŒë‹¨ ê·œì¹™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê°™ì€ AIê°€ ìˆ˜ì§‘í•œ ë°ì´í„° ì¤‘ë³µ ì²´í¬        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ì¡°ê±´ 1] URL ì •ê·œí™” í›„ ì¼ì¹˜             â”‚
â”‚    â†’ ì¤‘ë³µìœ¼ë¡œ íŒë‹¨, ìŠ¤í‚µ                â”‚
â”‚                                         â”‚
â”‚ [ì¡°ê±´ 2] ì œëª© 95% ì´ìƒ ìœ ì‚¬             â”‚
â”‚    â†’ ì¤‘ë³µìœ¼ë¡œ íŒë‹¨, ìŠ¤í‚µ                â”‚
â”‚                                         â”‚
â”‚ [ì¡°ê±´ 3] ë‹¤ë¥¸ AIê°€ ê°™ì€ ë°ì´í„° ìˆ˜ì§‘     â”‚
â”‚    â†’ ì¤‘ë³µ ì•„ë‹˜, ëª¨ë‘ ì €ì¥ (ìì—° ê°€ì¤‘ì¹˜) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 AIì—ê²Œ ì§€ì‹œì‚¬í•­

**ğŸ“Œ ìˆ˜ì§‘ AIì—ê²Œ (Gemini, Naver):**

```
âš ï¸ ì¤‘ë³µ ë°©ì§€ í•„ìˆ˜:
1. ê°™ì€ ì†ŒìŠ¤ì˜ ë‹¤ë¥¸ ë²„ì „/ì„¹ì…˜ ìˆ˜ì§‘ ê¸ˆì§€
   âŒ ë‚˜ë¬´ìœ„í‚¤ ê°™ì€ í˜ì´ì§€ì˜ ë‹¤ë¥¸ ì„¹ì…˜
   âŒ ë‰´ìŠ¤ ê°™ì€ ê¸°ì‚¬ì˜ ë‹¤ë¥¸ ë²„ì „

2. ì´ë¯¸ ìˆ˜ì§‘í•œ ì œëª©ê³¼ 95% ì´ìƒ ìœ ì‚¬í•˜ë©´ ìˆ˜ì§‘ ê¸ˆì§€
   âŒ "ê¹€ë¯¼ì„ ì˜í˜¹ ë…¼ë€" vs "ê¹€ë¯¼ì„ ë…¼ë€ ì˜í˜¹"
   âŒ "ê¹€ë¯¼ì„/ë¹„íŒ" vs "ê¹€ë¯¼ì„ / ë¹„íŒ"

3. ë‹¤ì–‘í•œ ì†ŒìŠ¤ì—ì„œ ìˆ˜ì§‘ (ê°™ì€ ì†ŒìŠ¤ ë°˜ë³µ ê¸ˆì§€)
   âœ… ë‚˜ë¬´ìœ„í‚¤ 1ê°œ, ë‰´ìŠ¤ 1ê°œ, ë¸”ë¡œê·¸ 1ê°œ
   âŒ ë‚˜ë¬´ìœ„í‚¤ 10ê°œ (ë‹¤ë¥¸ ì„¹ì…˜)
```

---

## 4. í‰ê°€ ë²”ìœ„ - êµ¬ì²´ì  10ê°œ í•­ëª©"""


def process_file(filepath):
    """íŒŒì¼ ì²˜ë¦¬: ì¤‘ë³µ ë°©ì§€ ì „ëµ ì¶”ê°€ + ì„¹ì…˜ ë²ˆí˜¸ ì¡°ì •"""
    print(f"\nì²˜ë¦¬ ì¤‘: {os.path.basename(filepath)}")

    # íŒŒì¼ ì½ê¸°
    try:
        with open(filepath, 'r', encoding='utf-8') as f:
            content = f.read()
    except Exception as e:
        print(f"  âŒ íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: {e}")
        return False

    # ì´ë¯¸ ì¤‘ë³µ ë°©ì§€ ì „ëµì´ ìˆëŠ”ì§€ í™•ì¸
    if "## 3. ì¤‘ë³µ ë°©ì§€ ì „ëµ" in content:
        print(f"  â­ï¸ ì´ë¯¸ ì¤‘ë³µ ë°©ì§€ ì „ëµ ìˆìŒ, ìŠ¤í‚µ")
        return True

    # "## 3. í‰ê°€ ë²”ìœ„" ì°¾ê¸°
    pattern = r'---\n\n## 3\. í‰ê°€ ë²”ìœ„'
    match = re.search(pattern, content)

    if not match:
        print(f"  âŒ '## 3. í‰ê°€ ë²”ìœ„' ì„¹ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ")
        return False

    # ì¤‘ë³µ ë°©ì§€ ì „ëµ ì‚½ì…
    insert_pos = match.start()
    new_content = content[:insert_pos] + DUPLICATE_STRATEGY_SECTION + content[match.end():]

    # ì„¹ì…˜ ë²ˆí˜¸ ì¡°ì • (4 â†’ 5, 5 â†’ 6, 6 â†’ 7, 7 â†’ 8, 8 â†’ 9, 9 â†’ 10)
    # ì—­ìˆœìœ¼ë¡œ ì¹˜í™˜ (9 â†’ 10ë¶€í„° ì‹œì‘)
    replacements = [
        (r'^## 9\. ', '## 10. '),
        (r'^## 8\. ', '## 9. '),
        (r'^## 7\. ', '## 8. '),
        (r'^## 6\. ', '## 7. '),
        (r'^## 5\. ', '## 6. '),
        (r'^## 4\. V40 ê¸°ê°„ ì œí•œ', '## 5. V40 ê¸°ê°„ ì œí•œ'),
    ]

    for pattern, replacement in replacements:
        new_content = re.sub(pattern, replacement, new_content, flags=re.MULTILINE)

    # íŒŒì¼ ì“°ê¸°
    try:
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(new_content)
        print(f"  âœ… ì™„ë£Œ")
        return True
    except Exception as e:
        print(f"  âŒ íŒŒì¼ ì“°ê¸° ì‹¤íŒ¨: {e}")
        return False


def main():
    # ì¹´í…Œê³ ë¦¬ íŒŒì¼ ëª©ë¡
    categories = [
        'cat02_leadership.md',
        'cat03_vision.md',
        'cat05_ethics.md',
        'cat06_accountability.md',
        'cat07_transparency.md',
        'cat08_communication.md',
        'cat09_responsiveness.md',
        'cat10_publicinterest.md',
    ]

    base_dir = os.path.join('..', 'instructions', '2_collect')

    print("="*60)
    print("ì¹´í…Œê³ ë¦¬ íŒŒì¼ ì¤‘ë³µ ë°©ì§€ ì „ëµ ìë™ ì¶”ê°€")
    print("="*60)

    success_count = 0
    total_count = len(categories)

    for cat_file in categories:
        filepath = os.path.join(base_dir, cat_file)
        if os.path.exists(filepath):
            if process_file(filepath):
                success_count += 1
        else:
            print(f"\nì²˜ë¦¬ ì¤‘: {cat_file}")
            print(f"  âŒ íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ: {filepath}")

    print("\n" + "="*60)
    print(f"ì™„ë£Œ: {success_count}/{total_count}ê°œ íŒŒì¼ ì„±ê³µ")
    print("="*60)


if __name__ == "__main__":
    main()
