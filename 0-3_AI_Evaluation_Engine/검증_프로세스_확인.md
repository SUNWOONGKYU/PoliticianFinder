# V30 검증 프로세스 확인 결과

## ✅ 검증 → 삭제 → 재수집 프로세스 이미 구현됨!

### 현재 validate_v30.py의 프로세스

```python
def run_validation_pipeline():
    """검증 + 재수집 파이프라인"""
    
    for iteration in range(1, max_iterations + 1):
        
        # 1단계: 검증
        result = validate_collected_data(politician_id, politician_name, ai_name)
        
        if result['invalid'] == 0:
            print("✅ 모든 데이터 유효! 검증 완료.")
            break
        
        # 2단계: 무효 항목 삭제
        delete_invalid_items(result['invalid_items'])
        
        # 3단계: 재수집
        recollect_invalid(politician_id, politician_name, result['invalid_items'])
        
        # 4단계: 재검증 (다음 반복에서)
```

---

## 검증 항목 (현재)

### 1. 필수 필드 검증
- title, content, source_url 존재 여부

### 2. URL 존재 검증
- HTTP HEAD/GET 요청으로 실제 존재 확인
- 404, 403, 500 등 오류 코드 체크

### 3. source_type 검증
- OFFICIAL vs PUBLIC 도메인 매칭

### 4. 기간 제한 검증 (published_date 기준)
- OFFICIAL: 4년 이내
- PUBLIC: 2년 이내

### 5. 중복 검증
- 같은 AI + 같은 URL → 자동 삭제
- 제목 95% 유사도 → 자동 삭제

---

## ⚠️ 추가 필요: 사건 발생 시점 검증

### 현재 문제

```
Title: "검찰, 김민석 불법 정치자금 혐의 재조명..."
Published Date: 2025-01-15 (최근 ✅)
Content: "...2002년 SK그룹으로부터 불법 정치자금..."

→ published_date 검증: 통과 ✅ (2025년)
→ event_year 검증: 없음 ❌ (2002년 사건!)
→ 결과: 잘못 통과!
```

### 해결 방법

validate_item() 함수에 사건 발생 시점 검증 추가:

```python
def validate_item(item):
    """단일 항목 종합 검증"""
    
    # 1. 필수 필드 검증
    # 2. URL 존재 검증
    # 3. source_type 검증
    # 4. 기간 검증 (published_date)
    
    # 5. 사건 발생 시점 검증 (신규 추가!)
    from validate_event_date import validate_event_date
    valid, code, details = validate_event_date(item)
    if not valid:
        return False, code  # EVENT_OUT_OF_RANGE
    
    # 6. 중복 검증
    return True, "VALID"
```

---

## 실행 방법

### 전체 자동 실행 (검증 + 재수집)

```bash
python validate_v30.py \
  --politician_id=f9e00370 \
  --politician_name="김민석" \
  --mode=all
```

### 검증만

```bash
python validate_v30.py \
  --politician_id=f9e00370 \
  --politician_name="김민석" \
  --mode=validate
```

### 재수집만

```bash
python validate_v30.py \
  --politician_id=f9e00370 \
  --politician_name="김민석" \
  --mode=recollect
```

---

## 다음 단계

1. **validate_v30.py에 사건 발생 시점 검증 통합**
   - validate_event_date.py 임포트
   - validate_item() 함수에 5단계 추가

2. **김민석 청렴성 재검증 실행**
   ```bash
   python validate_v30.py \
     --politician_id=f9e00370 \
     --politician_name="김민석" \
     --mode=all
   ```

3. **예상 결과**
   - 68개 중 4~7개 삭제 (2002년 불법 정치자금)
   - 자동 재수집
   - 점수 상승: 57.6점 → 62~65점

---

## 결론

✅ 검증 → 삭제 → 재수집 프로세스: **이미 구현됨!**
⏳ 사건 발생 시점 검증: **통합 필요!**
