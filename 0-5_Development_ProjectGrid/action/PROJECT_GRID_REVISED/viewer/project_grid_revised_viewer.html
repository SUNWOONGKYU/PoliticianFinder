<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROJECT GRID REVISED - 36 Tasks Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ========== í†µê³„ ì„¹ì…˜ ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 3em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 1.1em;
            font-weight: 600;
        }

        /* ========== Phase Gate ì„¹ì…˜ ========== */
        .phase-gates-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #e9ecef;
        }

        .phase-gate-item {
            padding: 20px;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .phase-gate-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .gate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .gate-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .gate-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .gate-status.ëŒ€ê¸° { background: #fff3cd; color: #856404; }
        .gate-status.ê²€ì¦ì¤‘ { background: #cce5ff; color: #004085; }
        .gate-status.í†µê³¼ { background: #d4edda; color: #155724; }

        .gate-criteria {
            color: #666;
            line-height: 1.8;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-top: 10px;
        }

        /* ========== Phaseë³„ Task ì„¹ì…˜ ========== */
        .phase-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .phase-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .phase-header:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }

        .phase-title {
            font-size: 1.5em;
            font-weight: 600;
        }

        .phase-stats {
            font-size: 1.1em;
        }

        .phase-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            padding: 10px;
        }

        /* ========== Task ì¹´ë“œ ========== */
        .task-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid #667eea;
            transition: all 0.3s;
            position: relative;
        }

        .task-card:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-3px);
        }

        .task-card.completed { border-left-color: #28a745; }
        .task-card.in-progress { border-left-color: #ffc107; }
        .task-card.pending { border-left-color: #6c757d; }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #dee2e6;
        }

        .task-id {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
        }

        .task-status {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-ì™„ë£Œ, .status-completed { background: #d4edda; color: #155724; }
        .status-ì§„í–‰, .status-in-progress { background: #fff3cd; color: #856404; }
        .status-ëŒ€ê¸°, .status-pending { background: #e2e3e5; color: #383d41; }

        .task-name {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .task-detail {
            display: grid;
            gap: 10px;
            font-size: 0.9em;
        }

        .detail-row {
            display: flex;
            gap: 10px;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }

        .detail-label {
            font-weight: 600;
            color: #667eea;
            min-width: 80px;
        }

        .detail-value {
            color: #555;
            flex: 1;
        }

        /* ========== ë¡œë”©/ì—ëŸ¬ ========== */
        .loading, .error {
            text-align: center;
            padding: 100px 20px;
            font-size: 1.5em;
            color: white;
        }

        .error {
            background: #dc3545;
            border-radius: 15px;
            margin: 20px;
        }

        /* ========== ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ========== */
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s;
            z-index: 1000;
        }

        .refresh-btn:hover {
            transform: scale(1.1) rotate(180deg);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ¯ PROJECT GRID REVISED</h1>
        <div class="subtitle">36 Tasks Â· 6 Phase Gates Â· Real-time Dashboard</div>
    </header>

    <div class="container">
        <!-- í†µê³„ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalTasks">-</div>
                <div class="stat-label">ì „ì²´ ì‘ì—…</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedTasks">-</div>
                <div class="stat-label">ì™„ë£Œëœ ì‘ì—…</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="inProgressTasks">-</div>
                <div class="stat-label">ì§„í–‰ì¤‘ ì‘ì—…</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="phaseGatesPassed">-</div>
                <div class="stat-label">í†µê³¼í•œ ê²Œì´íŠ¸</div>
            </div>
        </div>

        <!-- Phase Gates -->
        <div class="phase-gates-section">
            <div class="section-title">ğŸšª Phase Gate í†µê³¼ ì¡°ê±´</div>
            <div id="phaseGatesContainer">ë¡œë”©ì¤‘...</div>
        </div>

        <!-- Tasks by Phase -->
        <div id="tasksContainer">ë¡œë”©ì¤‘...</div>
    </div>

    <button class="refresh-btn" onclick="loadData()" title="ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>

    <script>
        // Supabase ì„¤ì •
        const SUPABASE_URL = 'https://ooddlafwdpzgxfefgsrx.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vZGRsYWZ3ZHB6Z3hmZWZnc3J4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1OTI0MzQsImV4cCI6MjA3NjE2ODQzNH0.knUt4zhH7Ld8c0GxaiLgcQp5m_tGnjt5djcetJgd-k8';

        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let allTasks = [];
        let allGates = [];

        // ë°ì´í„° ë¡œë“œ
        async function loadData() {
            try {
                // Tasks ë¡œë“œ
                const { data: tasks, error: tasksError } = await supabase
                    .from('project_grid_tasks_revised')
                    .select('*')
                    .order('phase', { ascending: true })
                    .order('task_id', { ascending: true });

                if (tasksError) throw tasksError;
                allTasks = tasks || [];

                // Phase Gates ë¡œë“œ
                const { data: gates, error: gatesError } = await supabase
                    .from('phase_gates')
                    .select('*')
                    .order('phase', { ascending: true });

                if (gatesError) throw gatesError;
                allGates = gates || [];

                // ë Œë”ë§
                renderStats();
                renderPhaseGates();
                renderTasksByPhase();

            } catch (error) {
                console.error('Error loading data:', error);
                document.querySelector('.container').innerHTML = `
                    <div class="error">
                        âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨<br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        // í†µê³„ ë Œë”ë§
        function renderStats() {
            const total = allTasks.length;
            const completed = allTasks.filter(t => t.status === 'ì™„ë£Œ' || t.status === 'completed').length;
            const inProgress = allTasks.filter(t => t.status === 'ì§„í–‰ì¤‘' || t.status === 'in-progress').length;
            const gatesPassed = allGates.filter(g => g.status === 'í†µê³¼').length;

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('inProgressTasks').textContent = inProgress;
            document.getElementById('phaseGatesPassed').textContent = `${gatesPassed}/6`;
        }

        // Phase Gates ë Œë”ë§
        function renderPhaseGates() {
            const html = allGates.map(gate => `
                <div class="phase-gate-item">
                    <div class="gate-header">
                        <div class="gate-name">Phase ${gate.phase}: ${gate.gate_name}</div>
                        <div class="gate-status ${gate.status}">${gate.status}</div>
                    </div>
                    <div class="gate-criteria">${gate.criteria}</div>
                </div>
            `).join('');

            document.getElementById('phaseGatesContainer').innerHTML = html || '<div>No phase gates found</div>';
        }

        // Phaseë³„ Task ë Œë”ë§
        function renderTasksByPhase() {
            const phases = [...new Set(allTasks.map(t => t.phase))].sort((a, b) => a - b);

            const html = phases.map(phase => {
                const phaseTasks = allTasks.filter(t => t.phase === phase);
                const completed = phaseTasks.filter(t => t.status === 'ì™„ë£Œ' || t.status === 'completed').length;

                return `
                    <div class="phase-section">
                        <div class="phase-header" onclick="togglePhase(${phase})">
                            <div class="phase-title">ğŸ“Œ Phase ${phase}</div>
                            <div class="phase-stats">ì „ì²´: ${phaseTasks.length}ê°œ | ì™„ë£Œ: ${completed}ê°œ</div>
                        </div>
                        <div class="phase-content" id="phase-${phase}">
                            ${phaseTasks.map(task => renderTaskCard(task)).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('tasksContainer').innerHTML = html;
        }

        // Task ì¹´ë“œ ë Œë”ë§
        function renderTaskCard(task) {
            const statusClass = task.status === 'ì™„ë£Œ' || task.status === 'completed' ? 'completed' :
                               task.status === 'ì§„í–‰ì¤‘' || task.status === 'in-progress' ? 'in-progress' : 'pending';

            return `
                <div class="task-card ${statusClass}">
                    <div class="task-header">
                        <div class="task-id">${task.task_id}</div>
                        <div class="task-status status-${statusClass}">${task.status}</div>
                    </div>
                    <div class="task-name">${task.task_name}</div>
                    <div class="task-detail">
                        <div class="detail-row">
                            <div class="detail-label">ì—ì´ì „íŠ¸:</div>
                            <div class="detail-value">${task.assigned_agent || '-'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">ì‚¬ìš©ë„êµ¬:</div>
                            <div class="detail-value">${task.tools || '-'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">ì˜ì¡´ì„±:</div>
                            <div class="detail-value">${task.dependency_chain || 'ì—†ìŒ'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">ì§„í–‰ë¥ :</div>
                            <div class="detail-value">${task.progress || 0}%</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">ìƒì„±íŒŒì¼:</div>
                            <div class="detail-value" style="word-break: break-word;">${task.generated_files || '-'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">ë¹Œë“œ:</div>
                            <div class="detail-value">${task.build_result || 'â³ ëŒ€ê¸°'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">ì‘ì—…ì§€ì‹œì„œ:</div>
                            <div class="detail-value">${task.instruction_file || '-'}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Phase í† ê¸€
        function togglePhase(phase) {
            const content = document.getElementById(`phase-${phase}`);
            content.style.display = content.style.display === 'none' ? 'grid' : 'none';
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ë°ì´í„° ë¡œë“œ
        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
